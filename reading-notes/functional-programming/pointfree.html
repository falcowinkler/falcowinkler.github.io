<!doctype html>
<html lang="en">
<head>
<title></title>
<!-- 2022-03-13 Sun 10:20 -->
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="generator" content="Org-mode">
<meta name="author" content="Falco Winkler">

<link  href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.5/css/bootstrap.min.css" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.5/js/bootstrap.min.js"></script>
<style>
/* org mode styles on top of twbs */

html {
    position: relative;
    min-height: 100%;
}

body {
    font-size: 18px;
    margin-bottom: 105px;
}

footer {
    position: absolute;
    bottom: 0;
    width: 100%;
    height: 101px;
    background-color: #f5f5f5;
}

footer > div {
    padding: 10px;
}

footer p {
    margin: 0 0 5px;
    text-align: center;
    font-size: 16px;
}

#table-of-contents {
    margin-top: 20px;
    margin-bottom: 20px;
}

blockquote p {
    font-size: 18px;
}

pre {
    font-size: 16px;
}

.footpara {
    display: inline-block;
}

figcaption {
  font-size: 16px;
  color: #666;
  font-style: italic;
  padding-bottom: 15px;
}

/* from twbs docs */

.bs-docs-sidebar.affix {
    position: static;
}
@media (min-width: 768px) {
    .bs-docs-sidebar {
        padding-left: 20px;
    }
}

/* All levels of nav */
.bs-docs-sidebar .nav > li > a {
    display: block;
    padding: 4px 20px;
    font-size: 14px;
    font-weight: 500;
    color: #999;
}
.bs-docs-sidebar .nav > li > a:hover,
.bs-docs-sidebar .nav > li > a:focus {
    padding-left: 19px;
    color: #A1283B;
    text-decoration: none;
    background-color: transparent;
    border-left: 1px solid #A1283B;
}
.bs-docs-sidebar .nav > .active > a,
.bs-docs-sidebar .nav > .active:hover > a,
.bs-docs-sidebar .nav > .active:focus > a {
    padding-left: 18px;
    font-weight: bold;
    color: #A1283B;
    background-color: transparent;
    border-left: 2px solid #A1283B;
}

/* Nav: second level (shown on .active) */
.bs-docs-sidebar .nav .nav {
    display: none; /* Hide by default, but at >768px, show it */
    padding-bottom: 10px;
}
.bs-docs-sidebar .nav .nav > li > a {
    padding-top: 1px;
    padding-bottom: 1px;
    padding-left: 30px;
    font-size: 12px;
    font-weight: normal;
}
.bs-docs-sidebar .nav .nav > li > a:hover,
.bs-docs-sidebar .nav .nav > li > a:focus {
    padding-left: 29px;
}
.bs-docs-sidebar .nav .nav > .active > a,
.bs-docs-sidebar .nav .nav > .active:hover > a,
.bs-docs-sidebar .nav .nav > .active:focus > a {
    padding-left: 28px;
    font-weight: 500;
}

/* Nav: third level (shown on .active) */
.bs-docs-sidebar .nav .nav .nav {
    padding-bottom: 10px;
}
.bs-docs-sidebar .nav .nav .nav > li > a {
    padding-top: 1px;
    padding-bottom: 1px;
    padding-left: 40px;
    font-size: 12px;
    font-weight: normal;
}
.bs-docs-sidebar .nav .nav .nav > li > a:hover,
.bs-docs-sidebar .nav .nav .nav > li > a:focus {
    padding-left: 39px;
}
.bs-docs-sidebar .nav .nav .nav > .active > a,
.bs-docs-sidebar .nav .nav .nav > .active:hover > a,
.bs-docs-sidebar .nav .nav .nav > .active:focus > a {
    padding-left: 38px;
    font-weight: 500;
}

/* Show and affix the side nav when space allows it */
@media (min-width: 992px) {
    .bs-docs-sidebar .nav > .active > ul {
        display: block;
    }
    /* Widen the fixed sidebar */
    .bs-docs-sidebar.affix,
    .bs-docs-sidebar.affix-bottom {
        width: 213px;
    }
    .bs-docs-sidebar.affix {
        position: fixed; /* Undo the static from mobile first approach */
        top: 20px;
    }
    .bs-docs-sidebar.affix-bottom {
        position: absolute; /* Undo the static from mobile first approach */
    }
    .bs-docs-sidebar.affix .bs-docs-sidenav,.bs-docs-sidebar.affix-bottom .bs-docs-sidenav {
        margin-top: 0;
        margin-bottom: 0
    }
}
@media (min-width: 1200px) {
    /* Widen the fixed sidebar again */
    .bs-docs-sidebar.affix-bottom,
    .bs-docs-sidebar.affix {
        width: 263px;
    }
}
</style>
<style>body { margin-bottom: 0px; }</style><script>
$(function() {
    'use strict';

    $('.bs-docs-sidebar li').first().addClass('active');

    $(document.body).scrollspy({target: '.bs-docs-sidebar'});

    $('.bs-docs-sidebar').affix();
});
</script><link rel="stylesheet" type="text/css" href="css/python_course.css">

<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  displayAlign: "center",
  displayIndent: "2em",
  messageStyle: "none",
  "HTML-CSS": {
    scale: 100,
    styles: {
      ".MathJax_Display": {
        "font-size": "100%"
      }
    }
  },
  "SVG": {
    scale: 100,
    styles: {
      ".MathJax_SVG_Display": {
        "font-size": "100%",
        "margin-left": "-2.281em"
      }
    }
  }
});
</script>
<script src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS_SVG"></script>
</head>
<body>
<div id="content" class="container">
<div class="row"><div class="col-md-3 col-md-push-9"><nav id="table-of-contents">
<div id="text-table-of-contents" class="bs-docs-sidebar">
<ul class="nav">
<li><a href="#sec-1">1. Functions</a></li>
<li><a href="#sec-2">2. Side effects</a></li>
<li><a href="#sec-3">3. Algebraic data types</a>
<ul class="nav">
<li><a href="#sec-3-1">3.1. Exercises</a></li>
</ul>
</li>
<li><a href="#sec-4">4. Higher order functions</a>
<ul class="nav">
<li><a href="#sec-4-1">4.1. Exercises</a></li>
</ul>
</li>
<li><a href="#sec-5">5. Functional setters</a>
<ul class="nav">
<li><a href="#sec-5-1">5.1. Exercises</a></li>
</ul>
</li>
<li><a href="#sec-6">6. Setters and key paths</a>
<ul class="nav">
<li><a href="#sec-6-1">6.1. Exercises</a></li>
</ul>
</li>
<li><a href="#sec-7">7. Getters and key paths</a>
<ul class="nav">
<li><a href="#sec-7-1">7.1. Exercises</a></li>
</ul>
</li>
<li><a href="#sec-8">8. Algebraic Data Types: Exponents</a>
<ul class="nav">
<li><a href="#sec-8-1">8.1. Exercises</a></li>
</ul>
</li>
<li><a href="#sec-9">9. A tale of two flat maps</a>
<ul class="nav">
<li><a href="#sec-9-1">9.1. Exercises</a></li>
</ul>
</li>
<li><a href="#sec-10">10. Composition without operators</a>
<ul class="nav">
<li><a href="#sec-10-1">10.1. Exercises</a></li>
</ul>
</li>
<li><a href="#sec-11">11. Tagged</a>
<ul class="nav">
<li><a href="#sec-11-1">11.1. Exercises</a></li>
</ul>
</li>
<li><a href="#sec-12">12. Dependency Injection made easy</a>
<ul class="nav">
<li><a href="#sec-12-1">12.1. Exercises</a></li>
</ul>
</li>
<li><a href="#sec-13">13. Dependency Injection Made Comfortable</a>
<ul class="nav">
<li><a href="#sec-13-1">13.1. Exercises</a></li>
</ul>
</li>
<li><a href="#sec-14">14. Playground Driven Development</a></li>
<li><a href="#sec-15">15. Dependency Injection Made Composable</a></li>
<li><a href="#sec-16">16. A Tour of the Composable Architecture: Part 1</a></li>
<li><a href="#sec-17">17. A Tour of the Composable Architecture: Part 2</a></li>
<li><a href="#sec-18">18. A Tour of the Composable Architecture: Part 3</a></li>
<li><a href="#sec-19">19. A Tour of the Composable Architecture: Part 4</a></li>
<li><a href="#sec-20">20. Designing Dependenciecs: The problem</a></li>
<li><a href="#sec-21">21. Designing Dependencies: Modularization</a></li>
<li><a href="#sec-22">22. Designing Dependencies: Reachability</a></li>
<li><a href="#sec-23">23. Designing Dependencies: Core Location</a></li>
<li><a href="#sec-24">24. Designing Dependencies: The point</a></li>
<li><a href="#sec-25">25. Redacted SwiftUI: The problem</a></li>
<li><a href="#sec-26">26. Redacted SwiftUI: The Composable Architecture</a></li>
<li><a href="#sec-27">27. The Point of Redacted SwiftUI: Part 1</a>
<ul class="nav">
<li><a href="#sec-27-1">27.1. Exercises</a></li>
</ul>
</li>
<li><a href="#sec-28">28. The Point of Redacted SwiftUI: Part 2</a></li>
<li><a href="#sec-29">29. Concise Forms: SwiftUI</a></li>
<li><a href="#sec-30">30. Concise Forms: Composable Architecture</a>
<ul class="nav">
<li><a href="#sec-30-1">30.1. Exercises</a></li>
</ul>
</li>
<li><a href="#sec-31">31. Concise Forms: Bye Bye Boilerplate</a>
<ul class="nav">
<li><a href="#sec-31-1">31.1. Exercises:</a></li>
</ul>
</li>
<li><a href="#sec-32">32. Concise Forms: The Point</a></li>
<li><a href="#sec-33">33. SwiftUI Animation: The Basics</a>
<ul class="nav">
<li><a href="#sec-33-1">33.1. Exercises</a></li>
</ul>
</li>
<li><a href="#sec-34">34. Better Test Dependencies: Exhaustivity</a>
<ul class="nav">
<li><a href="#sec-34-1">34.1. Exercises</a></li>
</ul>
</li>
<li><a href="#sec-35">35. Better Test Dependencies: Failability</a></li>
<li><a href="#sec-36">36. A Tour of Isowords: Part 1</a></li>
<li><a href="#sec-37">37. A Tour of Isowords: Part 2</a></li>
<li><a href="#sec-38">38. Async Refreshable: SwiftUI</a></li>
<li><a href="#sec-39">39. Async Refreshable: ComposableArchitecture</a>
<ul class="nav">
<li><a href="#sec-39-1">39.1. Exercises</a></li>
</ul>
</li>
<li><a href="#sec-40">40. Safer, Conciser Forms: Part 1</a></li>
<li><a href="#sec-41">41. Safer, Conciser Forms: Part 2</a></li>
</ul>
</div>
</nav>
</div><div class="col-md-9 col-md-pull-3"><h1 class="title"></h1>
<p>
key takeaways for <a href="https://www.pointfree.co/">https://www.pointfree.co/</a>
</p>
<div id="outline-container-sec-1" class="outline-2">
<h2 id="sec-1"><span class="section-number-2">1</span> Functions</h2>
<div class="outline-text-2" id="text-1">
<p>
Introduces operator <code>|&gt;</code> (forward application) and <code>&gt;&gt;&gt;</code> (forward composition).
</p>
<div class="org-src-container">

<pre class="src src-swift">  <span style="color: #a45bad;">2</span> |&gt; incr <span style="color: #2aa1ae; background-color: #292e34;">// </span><span style="color: #2aa1ae; background-color: #292e34;">== incr(2)</span>
  <span style="color: #4f97d7;">(</span>incr &gt;&gt;&gt; square<span style="color: #4f97d7;">)(</span><span style="color: #a45bad;">2</span><span style="color: #4f97d7;">)</span> <span style="color: #2aa1ae; background-color: #292e34;">// </span><span style="color: #2aa1ae; background-color: #292e34;">9</span>
</pre>
</div>
<ul class="org-ul">
<li>Forward composition is the oposite of haskells <code>.</code> composition operator (<code>(b-&gt;c)-&gt;(a-&gt;b)-&gt;(a-&gt;c)</code>)
</li>
<li>Use precedencegroups to avoid writing brackets
</li>
<li>Use operators with care.
</li>
<li>Tooling suffers from Free functions + operators (no autocomplete)
</li>
<li>Methods don't compose as well, because they have to be associated with a value all the time
</li>
<li>Pointfree: never refer to the value you are processing, focus on functions and compositions
</li>
</ul>
</div>
</div>
<div id="outline-container-sec-2" class="outline-2">
<h2 id="sec-2"><span class="section-number-2">2</span> Side effects</h2>
<div class="outline-text-2" id="text-2">
<p>
Side effects break composability, eg <code>map $ map f</code> can have
different side effects than <code>map (f . f)</code>, but the same return value.
</p>

<p>
Take for example writing logs.
We can fix the problem of returning logs alongside the computation (<code>(_ x: Int) -&gt; (Int, [String])</code>).
But for this kind of function/operator we need a new <code>compose</code> function that appends the logs from both function executions.
</p>

<div class="org-src-container">

<pre class="src src-swift">  <span style="color: #4f97d7; font-weight: bold;">func</span> &gt;=&gt; &lt;A, B, C&gt;<span style="color: #4f97d7;">(</span>
    _ f: <span style="color: #4f97d7; font-weight: bold;">@escaping</span> <span style="color: #bc6ec5;">(</span>A<span style="color: #bc6ec5;">)</span> -&gt; B?,
    _ g: <span style="color: #4f97d7; font-weight: bold;">@escaping</span> <span style="color: #bc6ec5;">(</span>B<span style="color: #bc6ec5;">)</span> -&gt; C?
    <span style="color: #4f97d7;">)</span> -&gt; <span style="color: #4f97d7;">(</span><span style="color: #bc6ec5;">(</span>A<span style="color: #bc6ec5;">)</span> -&gt; C?<span style="color: #4f97d7;">)</span> <span style="color: #4f97d7;">{</span>
  
    <span style="color: #4f97d7; font-weight: bold;">return</span> <span style="color: #bc6ec5;">{</span> a <span style="color: #4f97d7; font-weight: bold;">in</span>
        <span style="color: #2aa1ae; background-color: #292e34;">// </span><span style="color: #2aa1ae; background-color: #292e34;">same for lists and optionals:</span>
        <span style="color: #bc6ec5; font-weight: bold;">f</span><span style="color: #2d9574;">(</span>a<span style="color: #2d9574;">)</span>.<span style="color: #4f97d7;">flatMap</span><span style="color: #2d9574;">(</span>g<span style="color: #2d9574;">)</span>
    <span style="color: #bc6ec5;">}</span>
  <span style="color: #4f97d7;">}</span>
</pre>
</div>
<p>
In haskell, it has type <code>(&gt;=&gt;) :: Monad m =&gt; (a -&gt; m b) -&gt; (b -&gt; m c) -&gt; a -&gt; m c</code>,
forward composition for monadic functions.
</p>

<p>
We can avoid having inputs from side effects with currying.
<code>&lt;&gt;</code> is then defined as function composition for functions that return the input type.
(In haskell this is more generally defined on semigroups, namely: <code>(&lt;&gt;) :: Semigroup a =&gt; a -&gt; a -&gt; a</code>.
</p>
</div>
</div>
<div id="outline-container-sec-3" class="outline-2">
<h2 id="sec-3"><span class="section-number-2">3</span> Algebraic data types</h2>
<div class="outline-text-2" id="text-3">
<p>
Composite types can also be called <i>algebraic data types</i>, because we can do algebra with them.
E.g. if an enum has cases for type A and B we can construct \(A + B\) values from it, where in this notation,
\(A\) and \(B\) denote the number of values that can be constructed in the respective type. For pairs that's \(A * B\).
<code>Void</code> has 1 value and <code>Never</code> 0.
</p>
</div>
<div id="outline-container-sec-3-1" class="outline-3">
<h3 id="sec-3-1"><span class="section-number-3">3.1</span> Exercises</h3>
<div class="outline-text-3" id="text-3-1">
<ol class="org-ol">
<li>Exponential. So for \(A->B\), it has \(B^A\) types. Because we choose a value from set \(B\) \(A\) times.
</li>
<li><code>List&lt;A&gt; = 1 + A * List&lt;A&gt;</code>
</li>
<li><code>Optional&lt;Either&lt;A, B&gt;&gt; = 1 + A + B</code>
<code>!= (A + 1) + (B + 1) = Either&lt;Optional&lt;A&gt;, Optional&lt;B&gt;&gt;</code>.
In the second type there is <code>Left nil</code> and <code>Right nil</code> whereas in the first there is just <code>nil</code> for the absence of values.
</li>
<li><code>Either&lt;Optional&lt;A&gt;, B&gt; = 1+A+B = Optional&lt;Either&lt;A, B&gt;&gt;</code>. They are equivalent.
</li>
<li>Using the previous definitions for Pair and Either:
<div class="org-src-container">

<pre class="src src-swift">        <span style="color: #4f97d7; font-weight: bold;">func</span> * &lt;A, B&gt;<span style="color: #4f97d7;">(</span>lhs: A.<span style="color: #4f97d7; font-weight: bold;">Type</span>, rhs: B.<span style="color: #4f97d7; font-weight: bold;">Type</span><span style="color: #4f97d7;">)</span> -&gt; Pair&lt;A, B&gt;.<span style="color: #4f97d7; font-weight: bold;">Type</span> <span style="color: #4f97d7;">{</span>
          <span style="color: #4f97d7; font-weight: bold;">return</span> Pair&lt;A, B&gt;.<span style="color: #4f97d7; font-weight: bold;">self</span>
        <span style="color: #4f97d7;">}</span>
        
        <span style="color: #4f97d7; font-weight: bold;">func</span> + &lt;A, B&gt;<span style="color: #4f97d7;">(</span>lhs: A.<span style="color: #4f97d7; font-weight: bold;">Type</span>, rhs: B.<span style="color: #4f97d7; font-weight: bold;">Type</span><span style="color: #4f97d7;">)</span> -&gt; Either&lt;A, B&gt;.<span style="color: #4f97d7; font-weight: bold;">Type</span> <span style="color: #4f97d7;">{</span>
          <span style="color: #4f97d7; font-weight: bold;">return</span> Either&lt;A, B&gt;.<span style="color: #4f97d7; font-weight: bold;">self</span>
        <span style="color: #4f97d7;">}</span>
</pre>
</div>
</li>
</ol>
</div>
</div>
</div>
<div id="outline-container-sec-4" class="outline-2">
<h2 id="sec-4"><span class="section-number-2">4</span> Higher order functions</h2>
<div class="outline-text-2" id="text-4">
<p>
How can we fit functions that we work with every day into our composition?
We can define functions that manipulate functions such as <code>curry</code> and <code>flip</code> (equivalent to haskell).
</p>

<p>
How do we deal with methods?
Every method secretly defines a static function, which is already curried in the way that i'ts signature is always
<code>Self -&gt; Arguments -&gt; ReturnType</code>
<i>Zero argument functions</i> can be a problem, because you have these empty parathesis flying around.
Solution: Zurry (zero argument curry).
</p>
<div class="org-src-container">

<pre class="src src-swift">  <span style="color: #4f97d7; font-weight: bold;">func</span> <span style="color: #bc6ec5; font-weight: bold;">zurry</span>&lt;A&gt;<span style="color: #4f97d7;">(</span>_ f: <span style="color: #bc6ec5;">()</span> -&gt; A<span style="color: #4f97d7;">)</span> -&gt; A <span style="color: #4f97d7;">{</span>
    <span style="color: #4f97d7; font-weight: bold;">return</span> <span style="color: #bc6ec5; font-weight: bold;">f</span><span style="color: #bc6ec5;">()</span>
  <span style="color: #4f97d7;">}</span>
</pre>
</div>

<p>
Generic and <code>throws</code> functions are problematic, but we can redefine functions such as <code>map</code> and <code>filter</code> to free, curried functions.
</p>
<div class="org-src-container">

<pre class="src src-swift">  <span style="color: #4f97d7; font-weight: bold;">func</span> <span style="color: #bc6ec5; font-weight: bold;">map</span>&lt;A, B&gt;<span style="color: #4f97d7;">(</span>_ f: <span style="color: #4f97d7; font-weight: bold;">@escaping</span> <span style="color: #bc6ec5;">(</span>A<span style="color: #bc6ec5;">)</span> -&gt; B<span style="color: #4f97d7;">)</span> -&gt; <span style="color: #4f97d7;">(</span><span style="color: #bc6ec5;">[</span>A<span style="color: #bc6ec5;">]</span><span style="color: #4f97d7;">)</span> -&gt; <span style="color: #4f97d7;">[</span>B<span style="color: #4f97d7;">]</span> <span style="color: #4f97d7;">{</span>
    <span style="color: #4f97d7; font-weight: bold;">return</span> <span style="color: #bc6ec5;">{</span> $0.<span style="color: #4f97d7;">map</span><span style="color: #2d9574;">(</span>f<span style="color: #2d9574;">)</span> <span style="color: #bc6ec5;">}</span>
  <span style="color: #4f97d7;">}</span>
</pre>
</div>

<p>
What's the point? "When they work, they work really well, saving us a lot of boilerplate. 
When they don’t work, we’re still using the concepts and building intuitions for them."
</p>
</div>
<div id="outline-container-sec-4-1" class="outline-3">
<h3 id="sec-4-1"><span class="section-number-3">4.1</span> Exercises</h3>
<div class="outline-text-3" id="text-4-1">
<ol class="org-ol">
<li>3 argument curry
</li>
</ol>
<div class="org-src-container">

<pre class="src src-swift">     <span style="color: #4f97d7; font-weight: bold;">func</span> <span style="color: #bc6ec5; font-weight: bold;">curry</span>&lt;A, B, C, D&gt;<span style="color: #4f97d7;">(</span>_ f: <span style="color: #4f97d7; font-weight: bold;">@escaping</span> <span style="color: #bc6ec5;">(</span>A, B, C<span style="color: #bc6ec5;">)</span> -&gt; D<span style="color: #4f97d7;">)</span> -&gt; <span style="color: #4f97d7;">(</span>A<span style="color: #4f97d7;">)</span> -&gt; <span style="color: #4f97d7;">(</span>B<span style="color: #4f97d7;">)</span> -&gt; <span style="color: #4f97d7;">(</span>C<span style="color: #4f97d7;">)</span> -&gt; D <span style="color: #4f97d7;">{</span>
         <span style="color: #4f97d7; font-weight: bold;">return</span> <span style="color: #bc6ec5;">{</span> a <span style="color: #4f97d7; font-weight: bold;">in</span> <span style="color: #2d9574;">{</span> b <span style="color: #4f97d7; font-weight: bold;">in</span> <span style="color: #67b11d;">{</span> c <span style="color: #4f97d7; font-weight: bold;">in</span> <span style="color: #bc6ec5; font-weight: bold;">f</span><span style="color: #b1951d;">(</span>a, b, c<span style="color: #b1951d;">)</span> <span style="color: #67b11d;">}</span> <span style="color: #2d9574;">}</span> <span style="color: #bc6ec5;">}</span>
     <span style="color: #4f97d7;">}</span>
</pre>
</div>
<ol class="org-ol">
<li>With e.g. URL.appendingPathComponent these tricks don't work, because you can not disambiguate the overloads.
</li>
</ol>
<div class="org-src-container">

<pre class="src src-swift">     <span style="color: #4f97d7; font-weight: bold;">let</span> urlForPath = <span style="color: #bc6ec5; font-weight: bold;">flip</span><span style="color: #4f97d7;">(</span><span style="color: #bc6ec5; font-weight: bold;">curry</span><span style="color: #bc6ec5;">(</span><span style="color: #4f97d7;">URL</span>.<span style="color: #4f97d7; font-weight: bold;">init</span><span style="color: #2d9574;">(</span>fileURLWithPath:isDirectory:<span style="color: #2d9574;">)</span><span style="color: #bc6ec5;">)</span><span style="color: #4f97d7;">)(</span><span style="color: #a45bad;">true</span><span style="color: #4f97d7;">)</span>
</pre>
</div>
<ol class="org-ol">
<li>As we know from haskell, it's only right associative.
</li>
</ol>
<div class="org-src-container">

<pre class="src src-haskell">     <span style="color: #ce537a; font-weight: bold;">A</span><span style="color: #7590db;">-&gt;</span><span style="color: #ce537a; font-weight: bold;">B</span><span style="color: #7590db;">-&gt;</span><span style="color: #ce537a; font-weight: bold;">C</span><span style="color: #7590db;">-&gt;</span><span style="color: #ce537a; font-weight: bold;">D</span> <span style="color: #2aa1ae; background-color: #292e34;">-- </span><span style="color: #2aa1ae; background-color: #292e34;">(A-&gt;(B-&gt;(C-&gt;D)))</span>
</pre>
</div>
<ol class="org-ol">
<li>uncurry
</li>
</ol>
<div class="org-src-container">

<pre class="src src-swift">     <span style="color: #4f97d7; font-weight: bold;">func</span> <span style="color: #bc6ec5; font-weight: bold;">uncurry</span>&lt;A, B, C&gt;<span style="color: #4f97d7;">(</span>_ f: <span style="color: #4f97d7; font-weight: bold;">@escaping</span> <span style="color: #bc6ec5;">(</span>A<span style="color: #bc6ec5;">)</span> -&gt; <span style="color: #bc6ec5;">(</span>B<span style="color: #bc6ec5;">)</span> -&gt; C<span style="color: #4f97d7;">)</span> -&gt; <span style="color: #4f97d7;">(</span>A, B<span style="color: #4f97d7;">)</span> -&gt; C <span style="color: #4f97d7;">{</span>
         <span style="color: #4f97d7; font-weight: bold;">return</span> <span style="color: #bc6ec5;">{</span> <span style="color: #2d9574;">(</span>a, b<span style="color: #2d9574;">)</span> <span style="color: #4f97d7; font-weight: bold;">in</span> <span style="color: #bc6ec5; font-weight: bold;">f</span><span style="color: #2d9574;">(</span>a<span style="color: #2d9574;">)(</span>b<span style="color: #2d9574;">)</span> <span style="color: #bc6ec5;">}</span>
     <span style="color: #4f97d7;">}</span>
</pre>
</div>
<ol class="org-ol">
<li>reduce
</li>
</ol>
<div class="org-src-container">

<pre class="src src-swift">     <span style="color: #4f97d7; font-weight: bold;">func</span> <span style="color: #bc6ec5; font-weight: bold;">reduce</span>&lt;A,E&gt;<span style="color: #4f97d7;">(</span>f: <span style="color: #4f97d7; font-weight: bold;">@escaping</span><span style="color: #bc6ec5;">(</span>A,E<span style="color: #bc6ec5;">)</span> -&gt; A<span style="color: #4f97d7;">)</span> -&gt; <span style="color: #4f97d7;">(</span><span style="color: #bc6ec5;">[</span>E<span style="color: #bc6ec5;">]</span><span style="color: #4f97d7;">)</span> -&gt; <span style="color: #4f97d7;">(</span>A<span style="color: #4f97d7;">)</span> -&gt; A <span style="color: #4f97d7;">{</span>
         <span style="color: #4f97d7; font-weight: bold;">return</span> <span style="color: #bc6ec5;">{</span> l <span style="color: #4f97d7; font-weight: bold;">in</span> <span style="color: #2d9574;">{</span> i <span style="color: #4f97d7; font-weight: bold;">in</span>
                        l.<span style="color: #4f97d7;">reduce</span><span style="color: #67b11d;">(</span>i, f<span style="color: #67b11d;">)</span>
         <span style="color: #2d9574;">}</span><span style="color: #bc6ec5;">}</span>
     <span style="color: #4f97d7;">}</span>
</pre>
</div>
<ol class="org-ol">
<li>pseudoEither:
</li>
</ol>
<div class="org-src-container">

<pre class="src src-swift">     <span style="color: #4f97d7; font-weight: bold;">struct</span> <span style="color: #bc6ec5; font-weight: bold;">PseudoEither</span>&lt;A, B&gt; <span style="color: #4f97d7;">{</span>
         <span style="color: #4f97d7; font-weight: bold;">let</span> <span style="color: #4f97d7; font-weight: bold;">left</span>: A?
         <span style="color: #4f97d7; font-weight: bold;">let</span> <span style="color: #4f97d7; font-weight: bold;">right</span>: B?
     <span style="color: #4f97d7;">}</span>
     
     <span style="color: #4f97d7; font-weight: bold;">func</span> <span style="color: #4f97d7; font-weight: bold;">left</span>&lt;A, B&gt;<span style="color: #4f97d7;">(</span>a: A<span style="color: #4f97d7;">)</span> -&gt; PseudoEither&lt;A, B&gt; <span style="color: #4f97d7;">{</span>
         <span style="color: #bc6ec5; font-weight: bold;">PseudoEither</span><span style="color: #bc6ec5;">(</span><span style="color: #4f97d7; font-weight: bold;">left</span>: a, <span style="color: #4f97d7; font-weight: bold;">right</span>: <span style="color: #a45bad;">nil</span><span style="color: #bc6ec5;">)</span>
     <span style="color: #4f97d7;">}</span>
     
     <span style="color: #4f97d7; font-weight: bold;">func</span> <span style="color: #4f97d7; font-weight: bold;">right</span>&lt;A, B&gt;<span style="color: #4f97d7;">(</span>b: B<span style="color: #4f97d7;">)</span>-&gt; PseudoEither&lt;A, B&gt; <span style="color: #4f97d7;">{</span>
         <span style="color: #bc6ec5; font-weight: bold;">PseudoEither</span><span style="color: #bc6ec5;">(</span><span style="color: #4f97d7; font-weight: bold;">left</span>: <span style="color: #a45bad;">nil</span>, <span style="color: #4f97d7; font-weight: bold;">right</span>: b<span style="color: #bc6ec5;">)</span>
     <span style="color: #4f97d7;">}</span>
     
     <span style="color: #4f97d7; font-weight: bold;">let</span> x: PseudoEither&lt;<span style="color: #4f97d7;">String</span>, <span style="color: #4f97d7;">Int</span>&gt; = <span style="color: #4f97d7; font-weight: bold;">left</span><span style="color: #4f97d7;">(</span>a: <span style="color: #2d9574;">"wuff"</span><span style="color: #4f97d7;">)</span>
     <span style="color: #4f97d7; font-weight: bold;">let</span> y: PseudoEither&lt;<span style="color: #4f97d7;">String</span>, <span style="color: #4f97d7;">Int</span>&gt; = <span style="color: #4f97d7; font-weight: bold;">right</span><span style="color: #4f97d7;">(</span>b: <span style="color: #a45bad;">42</span><span style="color: #4f97d7;">)</span>
</pre>
</div>
<ol class="org-ol">
<li>nested map
</li>
</ol>
<div class="org-src-container">

<pre class="src src-swift">     <span style="color: #4f97d7; font-weight: bold;">let</span> arr = <span style="color: #4f97d7;">[</span><span style="color: #bc6ec5;">[</span><span style="color: #a45bad;">1</span>, <span style="color: #a45bad;">2</span><span style="color: #bc6ec5;">]</span>, <span style="color: #bc6ec5;">[</span><span style="color: #a45bad;">3</span>, <span style="color: #a45bad;">4</span><span style="color: #bc6ec5;">]</span><span style="color: #4f97d7;">]</span>
     <span style="color: #4f97d7;">(</span><span style="color: #bc6ec5;">(</span>map &gt;&gt;&gt; map<span style="color: #bc6ec5;">)</span> <span style="color: #bc6ec5;">{</span> $0 + <span style="color: #a45bad;">1</span> <span style="color: #bc6ec5;">}</span><span style="color: #4f97d7;">)</span> <span style="color: #4f97d7;">(</span>arr<span style="color: #4f97d7;">)</span> <span style="color: #2aa1ae; background-color: #292e34;">// </span><span style="color: #2aa1ae; background-color: #292e34;">[[2, 3], [4, 5]]</span>
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-sec-5" class="outline-2">
<h2 id="sec-5"><span class="section-number-2">5</span> Functional setters</h2>
<div class="outline-text-2" id="text-5">
<p>
If you modify data structures (by returning a copy), you will end up repeating a lot of code for transforming just one value.
Solution: Define generic functions for applying a function on a property.
This reduces boilerplate especially when types are modified, because you need a new copy everytime the type changes.
</p>
<div class="org-src-container">

<pre class="src src-swift">pair
  |&gt; <span style="color: #bc6ec5; font-weight: bold;">first</span><span style="color: #4f97d7;">(</span>incr<span style="color: #4f97d7;">)</span>
  |&gt; <span style="color: #bc6ec5; font-weight: bold;">first</span><span style="color: #4f97d7;">(</span><span style="color: #4f97d7;">String</span>.<span style="color: #4f97d7; font-weight: bold;">init</span><span style="color: #4f97d7;">)</span>
  |&gt; <span style="color: #bc6ec5; font-weight: bold;">second</span><span style="color: #4f97d7;">(</span><span style="color: #bc6ec5; font-weight: bold;">zurry</span><span style="color: #bc6ec5;">(</span><span style="color: #bc6ec5; font-weight: bold;">flip</span><span style="color: #2d9574;">(</span><span style="color: #4f97d7;">String</span>.<span style="color: #4f97d7;">uppercased</span><span style="color: #2d9574;">)</span><span style="color: #bc6ec5;">)</span><span style="color: #4f97d7;">)</span>
<span style="color: #2aa1ae; background-color: #292e34;">// </span><span style="color: #2aa1ae; background-color: #292e34;">("43", "SWIFT")</span>
</pre>
</div>
<p>
To compose functions within setters, we need to take care that it is done in the correct order.
E.g.
</p>
<div class="org-src-container">

<pre class="src src-swift">  <span style="color: #4f97d7; font-weight: bold;">let</span> nested = <span style="color: #4f97d7;">(</span><span style="color: #bc6ec5;">(</span><span style="color: #a45bad;">1</span>, <span style="color: #a45bad;">true</span><span style="color: #bc6ec5;">)</span>, <span style="color: #2d9574;">"Swift"</span><span style="color: #4f97d7;">)</span>
  nested
  |&gt; <span style="color: #4f97d7;">(</span>second &gt;&gt;&gt; first<span style="color: #4f97d7;">)</span> <span style="color: #4f97d7;">{</span> <span style="color: #a45bad;">!</span>$0 <span style="color: #4f97d7;">}</span>
<span style="color: #2aa1ae; background-color: #292e34;">// </span><span style="color: #2aa1ae; background-color: #292e34;">((1, false), "Swift")</span>
</pre>
</div>
<p>
Setter composition <i>composes backwards</i>.
Setters <i>lift</i> a transformation on an individual value into a function operating
on the surrounding datatype.
</p>
</div>
<div id="outline-container-sec-5-1" class="outline-3">
<h3 id="sec-5-1"><span class="section-number-3">5.1</span> Exercises</h3>
<div class="outline-text-3" id="text-5-1">
<ol class="org-ol">
<li>optional setters
</li>
</ol>
<div class="org-src-container">

<pre class="src src-swift">     <span style="color: #4f97d7; font-weight: bold;">func</span> <span style="color: #bc6ec5; font-weight: bold;">map</span>&lt;A&gt;<span style="color: #4f97d7;">(</span>f: <span style="color: #4f97d7; font-weight: bold;">@escaping</span> <span style="color: #bc6ec5;">(</span><span style="color: #2d9574;">(</span>A<span style="color: #2d9574;">)</span>-&gt;A<span style="color: #bc6ec5;">)</span><span style="color: #4f97d7;">)</span> -&gt; <span style="color: #4f97d7;">(</span>A?<span style="color: #4f97d7;">)</span> -&gt; A? <span style="color: #4f97d7;">{</span>
         <span style="color: #bc6ec5;">{</span> <span style="color: #4f97d7; font-weight: bold;">optional</span> <span style="color: #4f97d7; font-weight: bold;">in</span>
             <span style="color: #4f97d7; font-weight: bold;">optional</span>.<span style="color: #4f97d7;">flatMap</span><span style="color: #2d9574;">(</span>f<span style="color: #2d9574;">)</span>
         <span style="color: #bc6ec5;">}</span>
     <span style="color: #4f97d7;">}</span>
     <span style="color: #4f97d7; font-weight: bold;">struct</span> <span style="color: #bc6ec5; font-weight: bold;">Dog</span> <span style="color: #4f97d7;">{</span>
         <span style="color: #4f97d7; font-weight: bold;">let</span> age: <span style="color: #4f97d7;">Int</span>?
         <span style="color: #4f97d7; font-weight: bold;">let</span> name: <span style="color: #4f97d7;">String</span>
     <span style="color: #4f97d7;">}</span>
     
     <span style="color: #4f97d7; font-weight: bold;">func</span> <span style="color: #bc6ec5; font-weight: bold;">propDogAge</span><span style="color: #4f97d7;">(</span>f: <span style="color: #4f97d7; font-weight: bold;">@escaping</span> <span style="color: #bc6ec5;">(</span><span style="color: #4f97d7;">Int</span><span style="color: #bc6ec5;">)</span> -&gt; <span style="color: #4f97d7;">Int</span><span style="color: #4f97d7;">)</span> -&gt; <span style="color: #4f97d7;">(</span>Dog<span style="color: #4f97d7;">)</span> -&gt; Dog <span style="color: #4f97d7;">{</span>
         <span style="color: #bc6ec5;">{</span> dog <span style="color: #4f97d7; font-weight: bold;">in</span>
             <span style="color: #bc6ec5; font-weight: bold;">Dog</span><span style="color: #2d9574;">(</span>age: <span style="color: #bc6ec5; font-weight: bold;">map</span><span style="color: #67b11d;">(</span>f: f<span style="color: #67b11d;">)(</span>dog.<span style="color: #4f97d7;">age</span><span style="color: #67b11d;">)</span>, name: dog.<span style="color: #4f97d7;">name</span><span style="color: #2d9574;">)</span>
         <span style="color: #bc6ec5;">}</span>
     <span style="color: #4f97d7;">}</span>
     
     <span style="color: #4f97d7; font-weight: bold;">let</span> snoopy = <span style="color: #bc6ec5; font-weight: bold;">Dog</span><span style="color: #4f97d7;">(</span>age: <span style="color: #a45bad;">1</span>, name: <span style="color: #2d9574;">"snoopy"</span><span style="color: #4f97d7;">)</span>
     
     snoopy |&gt;
       <span style="color: #bc6ec5; font-weight: bold;">propDogAge</span><span style="color: #4f97d7;">(</span>f: <span style="color: #bc6ec5;">{</span> n <span style="color: #4f97d7; font-weight: bold;">in</span> n+<span style="color: #a45bad;">1</span> <span style="color: #bc6ec5;">}</span><span style="color: #4f97d7;">)</span>
</pre>
</div>
<ol class="org-ol">
<li>For the <code>Dog</code> struct above:
</li>
</ol>
<div class="org-src-container">

<pre class="src src-swift">     <span style="color: #4f97d7; font-weight: bold;">func</span> <span style="color: #bc6ec5; font-weight: bold;">propDogName</span><span style="color: #4f97d7;">(</span>f: <span style="color: #4f97d7; font-weight: bold;">@escaping</span> <span style="color: #bc6ec5;">(</span><span style="color: #4f97d7;">String</span><span style="color: #bc6ec5;">)</span> -&gt; <span style="color: #4f97d7;">String</span><span style="color: #4f97d7;">)</span> -&gt; <span style="color: #4f97d7;">(</span>Dog<span style="color: #4f97d7;">)</span> -&gt; Dog <span style="color: #4f97d7;">{</span>
         <span style="color: #bc6ec5;">{</span> dog <span style="color: #4f97d7; font-weight: bold;">in</span>
             <span style="color: #bc6ec5; font-weight: bold;">Dog</span><span style="color: #2d9574;">(</span>age: dog.<span style="color: #4f97d7;">age</span>, name: <span style="color: #bc6ec5; font-weight: bold;">f</span><span style="color: #67b11d;">(</span>dog.<span style="color: #4f97d7;">name</span><span style="color: #67b11d;">)</span><span style="color: #2d9574;">)</span>
         <span style="color: #bc6ec5;">}</span>
     <span style="color: #4f97d7;">}</span>
</pre>
</div>
<p>
Problems: Setters are a lot of boilerplate, and it doesn't scale well with many properties
</p>
<ol class="org-ol">
<li></li>
</ol>
<div class="org-src-container">

<pre class="src src-swift">     <span style="color: #4f97d7; font-weight: bold;">struct</span> <span style="color: #bc6ec5; font-weight: bold;">Dog</span> <span style="color: #4f97d7;">{</span>
         <span style="color: #4f97d7; font-weight: bold;">let</span> name: <span style="color: #4f97d7;">String</span>
         <span style="color: #4f97d7; font-weight: bold;">let</span> location: Location
     <span style="color: #4f97d7;">}</span>
     
     <span style="color: #4f97d7; font-weight: bold;">struct</span> <span style="color: #bc6ec5; font-weight: bold;">Location</span> <span style="color: #4f97d7;">{</span>
         <span style="color: #4f97d7; font-weight: bold;">let</span> name: <span style="color: #4f97d7;">String</span>
     <span style="color: #4f97d7;">}</span>
     
     <span style="color: #4f97d7; font-weight: bold;">func</span> <span style="color: #bc6ec5; font-weight: bold;">dogLocationName</span><span style="color: #4f97d7;">(</span>f: <span style="color: #4f97d7; font-weight: bold;">@escaping</span> <span style="color: #bc6ec5;">(</span><span style="color: #4f97d7;">String</span><span style="color: #bc6ec5;">)</span> -&gt; <span style="color: #4f97d7;">String</span><span style="color: #4f97d7;">)</span> -&gt; <span style="color: #4f97d7;">(</span>Dog<span style="color: #4f97d7;">)</span> -&gt; Dog <span style="color: #4f97d7;">{</span>
         <span style="color: #bc6ec5;">{</span> dog <span style="color: #4f97d7; font-weight: bold;">in</span>
             <span style="color: #bc6ec5; font-weight: bold;">Dog</span><span style="color: #2d9574;">(</span>name: <span style="color: #bc6ec5; font-weight: bold;">f</span><span style="color: #67b11d;">(</span>dog.<span style="color: #4f97d7;">name</span><span style="color: #67b11d;">)</span>, location: <span style="color: #bc6ec5; font-weight: bold;">Location</span><span style="color: #67b11d;">(</span>name: <span style="color: #bc6ec5; font-weight: bold;">f</span><span style="color: #b1951d;">(</span>dog.<span style="color: #7590db;">location</span>.<span style="color: #4f97d7;">name</span><span style="color: #b1951d;">)</span><span style="color: #67b11d;">)</span><span style="color: #2d9574;">)</span>
         <span style="color: #bc6ec5;">}</span>
     <span style="color: #4f97d7;">}</span>
     
     <span style="color: #4f97d7; font-weight: bold;">func</span> <span style="color: #bc6ec5; font-weight: bold;">dogLocation</span><span style="color: #4f97d7;">(</span>f: <span style="color: #4f97d7; font-weight: bold;">@escaping</span> <span style="color: #bc6ec5;">(</span>Location<span style="color: #bc6ec5;">)</span> -&gt; Location<span style="color: #4f97d7;">)</span> -&gt; <span style="color: #4f97d7;">(</span>Dog<span style="color: #4f97d7;">)</span> -&gt; Dog <span style="color: #4f97d7;">{</span>
         <span style="color: #bc6ec5;">{</span> dog <span style="color: #4f97d7; font-weight: bold;">in</span>
             <span style="color: #bc6ec5; font-weight: bold;">Dog</span><span style="color: #2d9574;">(</span>name: dog.<span style="color: #4f97d7;">name</span>, location: <span style="color: #bc6ec5; font-weight: bold;">f</span><span style="color: #67b11d;">(</span>dog.<span style="color: #7590db;">location</span><span style="color: #67b11d;">)</span><span style="color: #2d9574;">)</span>
         <span style="color: #bc6ec5;">}</span>
     <span style="color: #4f97d7;">}</span>
     
     <span style="color: #4f97d7; font-weight: bold;">func</span> <span style="color: #bc6ec5; font-weight: bold;">locationName</span><span style="color: #4f97d7;">(</span>f: <span style="color: #4f97d7; font-weight: bold;">@escaping</span> <span style="color: #bc6ec5;">(</span><span style="color: #4f97d7;">String</span><span style="color: #bc6ec5;">)</span> -&gt; <span style="color: #4f97d7;">String</span><span style="color: #4f97d7;">)</span> -&gt; <span style="color: #4f97d7;">(</span>Location<span style="color: #4f97d7;">)</span> -&gt; Location <span style="color: #4f97d7;">{</span>
         <span style="color: #bc6ec5;">{</span> location <span style="color: #4f97d7; font-weight: bold;">in</span>
             <span style="color: #bc6ec5; font-weight: bold;">Location</span><span style="color: #2d9574;">(</span>name: <span style="color: #bc6ec5; font-weight: bold;">f</span><span style="color: #67b11d;">(</span>location.<span style="color: #4f97d7;">name</span><span style="color: #67b11d;">)</span><span style="color: #2d9574;">)</span>
         <span style="color: #bc6ec5;">}</span>
     <span style="color: #4f97d7;">}</span>
     
     <span style="color: #4f97d7; font-weight: bold;">let</span> snoopy = <span style="color: #bc6ec5; font-weight: bold;">Dog</span><span style="color: #4f97d7;">(</span>name: <span style="color: #2d9574;">"snoopy"</span>, location: <span style="color: #bc6ec5; font-weight: bold;">Location</span><span style="color: #bc6ec5;">(</span>name: <span style="color: #2d9574;">"central park"</span><span style="color: #bc6ec5;">)</span><span style="color: #4f97d7;">)</span>
     
     snoopy |&gt; dogLocationName <span style="color: #4f97d7;">{</span> $0 + <span style="color: #2d9574;">"!"</span> <span style="color: #4f97d7;">}</span>
     snoopy |&gt; <span style="color: #4f97d7;">(</span>locationName &gt;&gt;&gt; dogLocation<span style="color: #4f97d7;">)</span> <span style="color: #4f97d7;">{</span> $0 + <span style="color: #2d9574;">"!"</span> <span style="color: #4f97d7;">}</span>
     snoopy |&gt; <span style="color: #4f97d7;">(</span>dogLocation &lt;&lt;&lt; locationName<span style="color: #4f97d7;">)</span> <span style="color: #4f97d7;">{</span> $0 + <span style="color: #2d9574;">"!"</span> <span style="color: #4f97d7;">}</span>
</pre>
</div>
<ol class="org-ol">
<li>Yes we can, but for each tuple type you have to write these functions again.
</li>
<li>and 6.
</li>
</ol>
<div class="org-src-container">

<pre class="src src-swift">     <span style="color: #4f97d7; font-weight: bold;">func</span> <span style="color: #bc6ec5; font-weight: bold;">setKey</span>&lt;K, V&gt;<span style="color: #4f97d7;">(</span>f: <span style="color: #4f97d7; font-weight: bold;">@escaping</span> <span style="color: #bc6ec5;">(</span>V?<span style="color: #bc6ec5;">)</span>-&gt;V?<span style="color: #4f97d7;">)</span> -&gt; <span style="color: #4f97d7;">(</span>K<span style="color: #4f97d7;">)</span> -&gt; <span style="color: #4f97d7;">(</span><span style="color: #4f97d7;">Dictionary</span>&lt;K, V&gt;<span style="color: #4f97d7;">)</span> -&gt; <span style="color: #4f97d7;">Dictionary</span>&lt;K, V&gt; <span style="color: #4f97d7;">{</span>
     <span style="color: #bc6ec5;">{</span>
         key <span style="color: #4f97d7; font-weight: bold;">in</span>
         <span style="color: #2d9574;">{</span> dict <span style="color: #4f97d7; font-weight: bold;">in</span> 
             <span style="color: #4f97d7; font-weight: bold;">var</span> dict = dict
             <span style="color: #4f97d7; font-weight: bold;">if</span> dict<span style="color: #67b11d;">[</span>key<span style="color: #67b11d;">]</span> !=  <span style="color: #a45bad;">nil</span> <span style="color: #67b11d;">{</span> <span style="color: #2aa1ae; background-color: #292e34;">// </span><span style="color: #2aa1ae; background-color: #292e34;">6.</span>
                 dict<span style="color: #b1951d;">[</span>key<span style="color: #b1951d;">]</span> = <span style="color: #bc6ec5; font-weight: bold;">f</span><span style="color: #b1951d;">(</span>dict<span style="color: #4f97d7;">[</span>key<span style="color: #4f97d7;">]</span><span style="color: #b1951d;">)</span>
             <span style="color: #67b11d;">}</span>
             <span style="color: #4f97d7; font-weight: bold;">return</span> dict
         <span style="color: #2d9574;">}</span>
     <span style="color: #bc6ec5;">}</span>
     <span style="color: #4f97d7;">}</span>
</pre>
</div>
<ol class="org-ol">
<li>The former is the signature of a setter, with the transformation as first argument. The latter can not be a setter,
because it does not allow for the passing of a transformation value.
In other words: The first signature receives a transformation function \(A \rightarrow B\) whereas the second
receives two values, one of type \(A\) and one of type \(B\).
</li>
</ol>
</div>
</div>
</div>
<div id="outline-container-sec-6" class="outline-2">
<h2 id="sec-6"><span class="section-number-2">6</span> Setters and key paths</h2>
<div class="outline-text-2" id="text-6">
<p>
Key paths are generic over type they apply to, and the specific value, eg.
</p>
<div class="org-src-container">

<pre class="src src-swift"><span style="color: #4f97d7;">KeyPath</span>&lt;User, <span style="color: #4f97d7;">String</span>&gt;
</pre>
</div>
<p>
you can use a keypath with array syntax!
</p>
<div class="org-src-container">

<pre class="src src-swift">user<span style="color: #4f97d7;">[</span>keyPath: \User.<span style="color: #4f97d7;">name</span><span style="color: #4f97d7;">]</span>
</pre>
</div>
<p>
Key paths are compiler generated (generate setters/getters under the hood)
</p>


<p>
Use prop to compose functions over key paths
</p>
<div class="org-src-container">

<pre class="src src-swift">  <span style="color: #4f97d7; font-weight: bold;">func</span> <span style="color: #bc6ec5; font-weight: bold;">prop</span>&lt;Root, <span style="color: #4f97d7;">Value</span>&gt;<span style="color: #4f97d7;">(</span>_ kp: <span style="color: #4f97d7;">WritableKeyPath</span>&lt;Root, <span style="color: #4f97d7;">Value</span>&gt;<span style="color: #4f97d7;">)</span>
    -&gt; <span style="color: #4f97d7;">(</span><span style="color: #4f97d7; font-weight: bold;">@escaping</span> <span style="color: #bc6ec5;">(</span><span style="color: #4f97d7;">Value</span><span style="color: #bc6ec5;">)</span> -&gt; <span style="color: #4f97d7;">Value</span><span style="color: #4f97d7;">)</span>
    -&gt; <span style="color: #4f97d7;">(</span>Root<span style="color: #4f97d7;">)</span>
    -&gt; Root
  
  <span style="color: #4f97d7;">(</span><span style="color: #bc6ec5; font-weight: bold;">prop</span><span style="color: #bc6ec5;">(</span>\User.<span style="color: #4f97d7;">name</span><span style="color: #bc6ec5;">)</span><span style="color: #4f97d7;">)</span> <span style="color: #4f97d7;">{</span> $0.<span style="color: #4f97d7;">uppercased</span><span style="color: #bc6ec5;">()</span> <span style="color: #4f97d7;">}</span> <span style="color: #2aa1ae; background-color: #292e34;">// </span><span style="color: #2aa1ae; background-color: #292e34;">User -&gt; User</span>
  <span style="color: #2aa1ae; background-color: #292e34;">// </span><span style="color: #2aa1ae; background-color: #292e34;">composing:</span>
  <span style="color: #bc6ec5; font-weight: bold;">prop</span><span style="color: #4f97d7;">(</span>\User.<span style="color: #7590db;">location</span><span style="color: #4f97d7;">)</span> &lt;&lt;&lt; <span style="color: #bc6ec5; font-weight: bold;">prop</span><span style="color: #4f97d7;">(</span>\Location.<span style="color: #4f97d7;">name</span><span style="color: #4f97d7;">)</span>
  <span style="color: #2aa1ae; background-color: #292e34;">// </span><span style="color: #2aa1ae; background-color: #292e34;">((String) -&gt; String) -&gt; (User) -&gt; User</span>
  <span style="color: #2aa1ae; background-color: #292e34;">// </span><span style="color: #2aa1ae; background-color: #292e34;">Even though that's equivalent to \User.location.name</span>
</pre>
</div>

<p>
<code>prop</code> allows you to write neat date formatters, URLrequest configurations etc.
pointfree in one expression (without computed props/stateful funcs)..
</p>
</div>
<div id="outline-container-sec-6-1" class="outline-3">
<h3 id="sec-6-1"><span class="section-number-3">6.1</span> Exercises</h3>
<div class="outline-text-3" id="text-6-1">
<ol class="org-ol">
<li>Dictionary’s subscript key path.
<div class="org-src-container">

<pre class="src src-swift">      <span style="color: #4f97d7;">(</span><span style="color: #bc6ec5;">(</span><span style="color: #4f97d7;">Value</span>?<span style="color: #bc6ec5;">)</span> -&gt; <span style="color: #4f97d7;">Value</span>?<span style="color: #4f97d7;">)</span> -&gt; <span style="color: #4f97d7;">Dictionary</span>&lt;<span style="color: #4f97d7;">Key</span>, <span style="color: #4f97d7;">Value</span>&gt; -&gt; <span style="color: #4f97d7;">Dictionary</span>&lt;<span style="color: #4f97d7;">Key</span>, <span style="color: #4f97d7;">Value</span>&gt;
</pre>
</div>
<p>
The difference when piping map is that the optional in the signature vanishes, because we lift the
transformation in it's monadic context (the monad being the maybe monad).
</p>
</li>
<li>Functional setters for sets
<div class="org-src-container">

<pre class="src src-swift">        <span style="color: #4f97d7; font-weight: bold;">func</span> <span style="color: #bc6ec5; font-weight: bold;">elem</span>&lt;A&gt;<span style="color: #4f97d7;">(</span>_ a: <span style="color: #bc6ec5;">(</span>A<span style="color: #bc6ec5;">)</span><span style="color: #4f97d7;">)</span> -&gt; <span style="color: #4f97d7;">(</span><span style="color: #4f97d7; font-weight: bold;">@escaping</span> <span style="color: #bc6ec5;">(</span><span style="color: #4f97d7;">Bool</span><span style="color: #bc6ec5;">)</span> -&gt; <span style="color: #4f97d7;">Bool</span><span style="color: #4f97d7;">)</span> -&gt; <span style="color: #4f97d7;">(</span><span style="color: #4f97d7;">Set</span>&lt;A&gt;<span style="color: #4f97d7;">)</span> -&gt; <span style="color: #4f97d7;">Set</span>&lt;A&gt; <span style="color: #4f97d7;">{</span>
            <span style="color: #bc6ec5;">{</span> f <span style="color: #4f97d7; font-weight: bold;">in</span>
                <span style="color: #2d9574;">{</span> <span style="color: #4f97d7; font-weight: bold;">set</span> <span style="color: #4f97d7; font-weight: bold;">in</span>
                    <span style="color: #4f97d7; font-weight: bold;">var</span> <span style="color: #4f97d7; font-weight: bold;">set</span> = <span style="color: #4f97d7; font-weight: bold;">set</span>
                    <span style="color: #4f97d7; font-weight: bold;">if</span> <span style="color: #67b11d;">(</span><span style="color: #bc6ec5; font-weight: bold;">f</span><span style="color: #b1951d;">(</span><span style="color: #4f97d7; font-weight: bold;">set</span>.<span style="color: #4f97d7;">contains</span><span style="color: #4f97d7;">(</span>a<span style="color: #4f97d7;">)</span><span style="color: #b1951d;">)</span><span style="color: #67b11d;">)</span> <span style="color: #67b11d;">{</span>
                        <span style="color: #4f97d7; font-weight: bold;">set</span>.<span style="color: #4f97d7;">insert</span><span style="color: #b1951d;">(</span>a<span style="color: #b1951d;">)</span>
                    <span style="color: #67b11d;">}</span>
                    <span style="color: #4f97d7; font-weight: bold;">return</span> <span style="color: #4f97d7; font-weight: bold;">set</span>
                <span style="color: #2d9574;">}</span>
            <span style="color: #bc6ec5;">}</span>
        <span style="color: #4f97d7;">}</span>
</pre>
</div>
</li>
<li>Array subscript key path on user
Guess i misunderstood the task
<div class="org-src-container">

<pre class="src src-swift">        <span style="color: #bc6ec5; font-weight: bold;">prop</span><span style="color: #4f97d7;">(</span>\User.<span style="color: #7590db;">favoriteFoods</span><span style="color: #4f97d7;">)(</span><span style="color: #bc6ec5;">{</span>
            <span style="color: #4f97d7; font-weight: bold;">if</span> $0.<span style="color: #4f97d7;">isEmpty</span> <span style="color: #2d9574;">{</span>
                <span style="color: #4f97d7; font-weight: bold;">return</span> <span style="color: #67b11d;">[]</span>
            <span style="color: #2d9574;">}</span> <span style="color: #4f97d7; font-weight: bold;">else</span> <span style="color: #2d9574;">{</span>
                <span style="color: #4f97d7; font-weight: bold;">return</span> <span style="color: #67b11d;">[</span>$0.<span style="color: #4f97d7;">first</span>!.<span style="color: #4f97d7;">uppercased</span><span style="color: #b1951d;">()</span><span style="color: #67b11d;">]</span> + <span style="color: #4f97d7;">Array</span><span style="color: #67b11d;">(</span>$0.<span style="color: #4f97d7;">dropFirst</span><span style="color: #b1951d;">()</span><span style="color: #67b11d;">)</span>
            <span style="color: #2d9574;">}</span>
        <span style="color: #bc6ec5;">}</span><span style="color: #4f97d7;">)</span>
</pre>
</div>
<p>
correctAnswer:
</p>
<div class="org-src-container">

<pre class="src src-swift">        <span style="color: #4f97d7;">(</span><span style="color: #bc6ec5; font-weight: bold;">prop</span><span style="color: #bc6ec5;">(</span>\User.<span style="color: #7590db;">favoriteFoods</span><span style="color: #2d9574;">[</span><span style="color: #a45bad;">0</span><span style="color: #2d9574;">]</span>.<span style="color: #4f97d7;">name</span><span style="color: #bc6ec5;">)</span><span style="color: #4f97d7;">)</span> <span style="color: #4f97d7;">{</span> $0.<span style="color: #4f97d7;">uppercased</span><span style="color: #bc6ec5;">()</span> <span style="color: #4f97d7;">}</span>
</pre>
</div>
</li>
<li>filtering in place
<div class="org-src-container">

<pre class="src src-swift">        <span style="color: #4f97d7;">(</span><span style="color: #bc6ec5; font-weight: bold;">prop</span><span style="color: #bc6ec5;">(</span>\User.<span style="color: #7590db;">favoriteFoods</span><span style="color: #bc6ec5;">)</span> &lt;&lt;&lt; filter<span style="color: #4f97d7;">)</span> <span style="color: #2aa1ae; background-color: #292e34;">// </span><span style="color: #2aa1ae; background-color: #292e34;">(String -&gt; Bool) -&gt; User -&gt; User</span>
</pre>
</div>
</li>
<li>We will use <code>Result&lt;Value, Error&gt;</code> from <code>Foundation</code>.
<div class="org-src-container">

<pre class="src src-swift">        <span style="color: #4f97d7; font-weight: bold;">let</span> result = <span style="color: #4f97d7;">Result</span>&lt;<span style="color: #4f97d7;">Int</span>, <span style="color: #4f97d7;">Error</span>&gt;.<span style="color: #4f97d7;">success</span><span style="color: #4f97d7;">(</span><span style="color: #a45bad;">1</span><span style="color: #4f97d7;">)</span>
        <span style="color: #4f97d7; font-weight: bold;">func</span> <span style="color: #bc6ec5; font-weight: bold;">value</span>&lt;V, E&gt;<span style="color: #4f97d7;">(</span>f: <span style="color: #4f97d7; font-weight: bold;">@escaping</span> <span style="color: #bc6ec5;">(</span><span style="color: #2d9574;">(</span>V<span style="color: #2d9574;">)</span>-&gt;V<span style="color: #bc6ec5;">)</span><span style="color: #4f97d7;">)</span> -&gt; <span style="color: #4f97d7;">(</span><span style="color: #4f97d7;">Result</span>&lt;V, E&gt;<span style="color: #4f97d7;">)</span> -&gt; <span style="color: #4f97d7;">(</span><span style="color: #4f97d7;">Result</span>&lt;V, E&gt;<span style="color: #4f97d7;">)</span> <span style="color: #4f97d7;">{</span>
            <span style="color: #bc6ec5;">{</span> res <span style="color: #4f97d7; font-weight: bold;">in</span>
                <span style="color: #4f97d7; font-weight: bold;">switch</span> res <span style="color: #2d9574;">{</span>
                <span style="color: #4f97d7; font-weight: bold;">case</span> .<span style="color: #4f97d7;">failure</span>:
                    <span style="color: #4f97d7; font-weight: bold;">return</span> res
                <span style="color: #4f97d7; font-weight: bold;">case</span> .<span style="color: #4f97d7;">success</span><span style="color: #67b11d;">(</span><span style="color: #4f97d7; font-weight: bold;">let</span> v<span style="color: #67b11d;">)</span>:
                    <span style="color: #4f97d7; font-weight: bold;">return</span> <span style="color: #4f97d7;">Result</span>&lt;V, E&gt;.<span style="color: #4f97d7;">success</span><span style="color: #67b11d;">(</span><span style="color: #bc6ec5; font-weight: bold;">f</span><span style="color: #b1951d;">(</span>v<span style="color: #b1951d;">)</span><span style="color: #67b11d;">)</span>
                <span style="color: #2d9574;">}</span>
            <span style="color: #bc6ec5;">}</span>
        <span style="color: #4f97d7;">}</span>
        <span style="color: #2aa1ae; background-color: #292e34;">// </span><span style="color: #2aa1ae; background-color: #292e34;">Error defined equivalently for failure case.</span>
</pre>
</div>
<ol class="org-ol">
<li>No, there are no key paths for structs (Case paths from pointfree as an alternative)
</li>
<li>e.g. for prop, the mapper function returns Void, and we simply need to call it, rather than re-assigning.
<div class="org-src-container">

<pre class="src src-swift">         <span style="color: #4f97d7; font-weight: bold;">func</span> <span style="color: #bc6ec5; font-weight: bold;">inoutProp</span>&lt;Root, <span style="color: #4f97d7;">Value</span>&gt;<span style="color: #4f97d7;">(</span>_ kp: <span style="color: #4f97d7;">WritableKeyPath</span>&lt;Root, <span style="color: #4f97d7;">Value</span>&gt;<span style="color: #4f97d7;">)</span>
         -&gt; <span style="color: #4f97d7;">(</span><span style="color: #4f97d7; font-weight: bold;">@escaping</span> <span style="color: #bc6ec5;">(</span><span style="color: #4f97d7; font-weight: bold;">inout</span> <span style="color: #4f97d7;">Value</span><span style="color: #bc6ec5;">)</span> -&gt; <span style="color: #bc6ec5;">()</span><span style="color: #4f97d7;">)</span>
         -&gt; <span style="color: #4f97d7;">(</span>Root<span style="color: #4f97d7;">)</span>
         -&gt; Root <span style="color: #4f97d7;">{</span>
             <span style="color: #bc6ec5;">{</span> f <span style="color: #4f97d7; font-weight: bold;">in</span>
                 <span style="color: #2d9574;">{</span> root <span style="color: #4f97d7; font-weight: bold;">in</span>
                     <span style="color: #4f97d7; font-weight: bold;">var</span> root = root
                     <span style="color: #bc6ec5; font-weight: bold;">f</span><span style="color: #67b11d;">(</span>&amp;root<span style="color: #b1951d;">[</span>keyPath: kp<span style="color: #b1951d;">]</span><span style="color: #67b11d;">)</span>
                     <span style="color: #4f97d7; font-weight: bold;">return</span> root
                 <span style="color: #2d9574;">}</span>
             <span style="color: #bc6ec5;">}</span>
         <span style="color: #4f97d7;">}</span>
</pre>
</div>
</li>
</ol>
</li>
</ol>
</div>
</div>
</div>

<div id="outline-container-sec-7" class="outline-2">
<h2 id="sec-7"><span class="section-number-2">7</span> Getters and key paths</h2>
<div class="outline-text-2" id="text-7">
<p>
Use <code>get</code> wrapper to bridge between function and keypath world
</p>
<div class="org-src-container">

<pre class="src src-swift"><span style="color: #4f97d7; font-weight: bold;">func</span> <span style="color: #4f97d7; font-weight: bold;">get</span>&lt;Root, <span style="color: #4f97d7;">Value</span>&gt;<span style="color: #4f97d7;">(</span>_ kp: <span style="color: #4f97d7;">KeyPath</span>&lt;Root, <span style="color: #4f97d7;">Value</span>&gt;<span style="color: #4f97d7;">)</span> -&gt; <span style="color: #4f97d7;">(</span>Root<span style="color: #4f97d7;">)</span> -&gt; <span style="color: #4f97d7;">Value</span> <span style="color: #4f97d7;">{</span>
  <span style="color: #4f97d7; font-weight: bold;">return</span> <span style="color: #bc6ec5;">{</span> root <span style="color: #4f97d7; font-weight: bold;">in</span>
    root<span style="color: #2d9574;">[</span>keyPath: kp<span style="color: #2d9574;">]</span>
  <span style="color: #bc6ec5;">}</span>
<span style="color: #4f97d7;">}</span>
</pre>
</div>
<p>
this is nice:
</p>
<div class="org-src-container">

<pre class="src src-swift">users
  .<span style="color: #4f97d7;">filter</span><span style="color: #4f97d7;">(</span><span style="color: #4f97d7; font-weight: bold;">get</span><span style="color: #bc6ec5;">(</span>\.<span style="color: #7590db;">isStaff</span><span style="color: #bc6ec5;">)</span> &gt;&gt;&gt; <span style="color: #bc6ec5;">(</span><span style="color: #a45bad;">!</span><span style="color: #bc6ec5;">)</span><span style="color: #4f97d7;">)</span>
</pre>
</div>
<p>
you can do operators as functions 💡.
</p>

<p>
Generic getters can also be helpful for sorting, max etc. because there you need a compare function
<code>A -&gt; A -&gt; Bool</code>.
With <code>their</code>, we can write
</p>
<div class="org-src-container">

<pre class="src src-swift">users
  .<span style="color: #4f97d7;">max</span><span style="color: #4f97d7;">(</span>by: <span style="color: #bc6ec5; font-weight: bold;">their</span><span style="color: #bc6ec5;">(</span><span style="color: #4f97d7; font-weight: bold;">get</span><span style="color: #2d9574;">(</span>\.<span style="color: #7590db;">email</span><span style="color: #2d9574;">)</span>, &lt;<span style="color: #bc6ec5;">)</span><span style="color: #4f97d7;">)</span> <span style="color: #2aa1ae; background-color: #292e34;">// </span><span style="color: #2aa1ae; background-color: #292e34;">we can also use Comparable instead of passing the compare fn.</span>
</pre>
</div>

<p>
We can also write a wrapper for combining elements in <code>reduce</code>:
</p>
<div class="org-src-container">

<pre class="src src-swift">episodes.<span style="color: #4f97d7;">reduce</span><span style="color: #4f97d7;">(</span><span style="color: #a45bad;">0</span>, <span style="color: #bc6ec5; font-weight: bold;">combining</span><span style="color: #bc6ec5;">(</span><span style="color: #4f97d7; font-weight: bold;">get</span><span style="color: #2d9574;">(</span>\.<span style="color: #7590db;">viewCount</span><span style="color: #2d9574;">)</span>, by: +<span style="color: #bc6ec5;">)</span><span style="color: #4f97d7;">)</span>
</pre>
</div>
<p>
We use get a lot, so you might consider using an operator <code>^</code> as prefix operator.
</p>
</div>

<div id="outline-container-sec-7-1" class="outline-3">
<h3 id="sec-7-1"><span class="section-number-3">7.1</span> Exercises</h3>
<div class="outline-text-3" id="text-7-1">
<ol class="org-ol">
<li>Find three more standard library APIs that can be used with our get and ^ helpers:
<ul class="org-ul">
<li><code>filter</code> a list of items on a boolean property
</li>
<li><code>Dictionary&lt;A, B&gt;.init(grouping:, by:)</code>, grouping by an int property
</li>
<li><code>contains(where:)</code>
</li>
<li>other maps such as <code>compact</code> or <code>flatMap</code>, <code>mapValues</code> etc.
</li>
</ul>
</li>
<li>A getter key-path for zero-argument functions wrapping a property&#x2026;
cant think of others
</li>
<li>I am not sure if this is what is meant:
<div class="org-src-container">

<pre class="src src-swift">        <span style="color: #4f97d7; font-weight: bold;">func</span> <span style="color: #bc6ec5; font-weight: bold;">getFoodAttr</span>&lt;T&gt;<span style="color: #4f97d7;">(</span>f: <span style="color: #4f97d7;">KeyPath</span>&lt;Food, T&gt;<span style="color: #4f97d7;">)</span> -&gt; <span style="color: #4f97d7;">(</span>User<span style="color: #4f97d7;">)</span> -&gt; <span style="color: #4f97d7;">[</span>T<span style="color: #4f97d7;">]</span> <span style="color: #4f97d7;">{</span>
            <span style="color: #bc6ec5;">{</span> user <span style="color: #4f97d7; font-weight: bold;">in</span>
                <span style="color: #bc6ec5; font-weight: bold;">map</span><span style="color: #2d9574;">(</span>f: <span style="color: #4f97d7; font-weight: bold;">get</span><span style="color: #67b11d;">(</span>f<span style="color: #67b11d;">)</span><span style="color: #2d9574;">)(</span>user.<span style="color: #7590db;">favoriteFoods</span><span style="color: #2d9574;">)</span>
            <span style="color: #bc6ec5;">}</span>
        <span style="color: #4f97d7;">}</span>
        <span style="color: #bc6ec5; font-weight: bold;">getFoodAttr</span><span style="color: #4f97d7;">(</span>f: \.<span style="color: #4f97d7;">name</span><span style="color: #4f97d7;">)(</span>user<span style="color: #4f97d7;">)</span> <span style="color: #2aa1ae; background-color: #292e34;">// </span><span style="color: #2aa1ae; background-color: #292e34;">Tacos, Nachos</span>
</pre>
</div>
</li>
<li>Key paths support optional chaining
<div class="org-src-container">

<pre class="src src-swift">        <span style="color: #4f97d7; font-weight: bold;">func</span> <span style="color: #bc6ec5; font-weight: bold;">getLocationAttr</span>&lt;T&gt;<span style="color: #4f97d7;">(</span>f: <span style="color: #4f97d7;">KeyPath</span>&lt;Location, T&gt;<span style="color: #4f97d7;">)</span> -&gt; <span style="color: #4f97d7;">(</span>User<span style="color: #4f97d7;">)</span> -&gt; T? <span style="color: #4f97d7;">{</span>
            <span style="color: #bc6ec5;">{</span> user <span style="color: #4f97d7; font-weight: bold;">in</span>
                <span style="color: #bc6ec5; font-weight: bold;">map</span><span style="color: #2d9574;">(</span>f: <span style="color: #4f97d7; font-weight: bold;">get</span><span style="color: #67b11d;">(</span>f<span style="color: #67b11d;">)</span><span style="color: #2d9574;">)(</span>user.<span style="color: #7590db;">location</span><span style="color: #2d9574;">)</span>
            <span style="color: #bc6ec5;">}</span>
        <span style="color: #4f97d7;">}</span>
        <span style="color: #bc6ec5; font-weight: bold;">getLocationAttr</span><span style="color: #4f97d7;">(</span>f: \.<span style="color: #4f97d7;">name</span><span style="color: #4f97d7;">)(</span>user<span style="color: #4f97d7;">)</span>
        <span style="color: #4f97d7; font-weight: bold;">let</span> user2 = <span style="color: #bc6ec5; font-weight: bold;">User</span><span style="color: #4f97d7;">(</span>
            favoriteFoods: <span style="color: #bc6ec5;">[]</span>,
            location: <span style="color: #a45bad;">nil</span>,
            name: <span style="color: #2d9574;">"Blob"</span>
        <span style="color: #4f97d7;">)</span>
        <span style="color: #4f97d7; font-weight: bold;">get</span><span style="color: #4f97d7;">(</span>\User.<span style="color: #7590db;">location</span>?.<span style="color: #4f97d7;">name</span><span style="color: #4f97d7;">)(</span>user2<span style="color: #4f97d7;">)</span>
</pre>
</div>
</li>
<li>Like this?
<div class="org-src-container">

<pre class="src src-swift">        <span style="color: #4f97d7; font-weight: bold;">func</span> <span style="color: #bc6ec5; font-weight: bold;">pluck</span>&lt;V, E&gt;<span style="color: #4f97d7;">(</span>r: <span style="color: #4f97d7;">Result</span>&lt;V, E&gt;<span style="color: #4f97d7;">)</span> -&gt; V? <span style="color: #4f97d7;">{</span>
            <span style="color: #4f97d7; font-weight: bold;">switch</span> r <span style="color: #bc6ec5;">{</span>
            <span style="color: #4f97d7; font-weight: bold;">case</span> .<span style="color: #4f97d7;">success</span><span style="color: #2d9574;">(</span><span style="color: #4f97d7; font-weight: bold;">let</span> v<span style="color: #2d9574;">)</span>:
                <span style="color: #4f97d7; font-weight: bold;">return</span> v
            <span style="color: #4f97d7; font-weight: bold;">default</span>: <span style="color: #4f97d7; font-weight: bold;">return</span> <span style="color: #a45bad;">nil</span>
            <span style="color: #bc6ec5;">}</span>
        <span style="color: #4f97d7;">}</span>
        <span style="color: #4f97d7; font-weight: bold;">let</span> res: <span style="color: #4f97d7;">Result</span>&lt;User, <span style="color: #4f97d7;">Error</span>&gt; = .<span style="color: #4f97d7;">success</span><span style="color: #4f97d7;">(</span>user<span style="color: #4f97d7;">)</span>
        <span style="color: #bc6ec5; font-weight: bold;">map</span><span style="color: #4f97d7;">(</span>f: <span style="color: #4f97d7; font-weight: bold;">get</span><span style="color: #bc6ec5;">(</span>\User.<span style="color: #4f97d7;">name</span><span style="color: #bc6ec5;">)</span><span style="color: #4f97d7;">)(</span><span style="color: #bc6ec5; font-weight: bold;">pluck</span><span style="color: #bc6ec5;">(</span>r: res<span style="color: #bc6ec5;">)</span><span style="color: #4f97d7;">)</span>
</pre>
</div>
</li>
</ol>
<p>
TODO: i don't really understand what is meant with 6,7,8 exercises.
</p>
</div>
</div>
</div>
<div id="outline-container-sec-8" class="outline-2">
<h2 id="sec-8"><span class="section-number-2">8</span> Algebraic Data Types: Exponents</h2>
<div class="outline-text-2" id="text-8">
<p>
As we learned in the exercises from "Algebraic Data Types",
there are \(B^A\) functions of type \(A->B\).
Since \(a^b^c = a^(b*c)\), we can derive that
<code>C-&gt;B-&gt;A = (B, C) -&gt; A</code>.
Shows that curry and uncurry are elemental operations.
Since \(a^1 = a\), we can derive zurry and unzurry.
</p>

<p>
What happens with \(a^0=1\)?
<code>Never -&gt; A = Void</code>
We can define absurd in swift!
</p>

<div class="org-src-container">

<pre class="src src-swift"><span style="color: #4f97d7; font-weight: bold;">func</span> <span style="color: #bc6ec5; font-weight: bold;">to</span>&lt;A&gt;<span style="color: #4f97d7;">(</span>_ f: <span style="color: #bc6ec5;">(</span><span style="color: #4f97d7;">Never</span><span style="color: #bc6ec5;">)</span> -&gt; A<span style="color: #4f97d7;">)</span> -&gt; <span style="color: #4f97d7;">Void</span> <span style="color: #4f97d7;">{</span>
  <span style="color: #4f97d7; font-weight: bold;">return</span> <span style="color: #bc6ec5;">()</span>
<span style="color: #4f97d7;">}</span>
</pre>
</div>
<div class="org-src-container">

<pre class="src src-swift"><span style="color: #4f97d7; font-weight: bold;">func</span> <span style="color: #bc6ec5; font-weight: bold;">from</span>&lt;A&gt;<span style="color: #4f97d7;">(</span>_ x: <span style="color: #4f97d7;">Void</span><span style="color: #4f97d7;">)</span> -&gt; <span style="color: #4f97d7;">(</span><span style="color: #4f97d7;">Never</span><span style="color: #4f97d7;">)</span> -&gt; A <span style="color: #4f97d7;">{</span>
  <span style="color: #4f97d7; font-weight: bold;">return</span> <span style="color: #bc6ec5;">{</span> never <span style="color: #4f97d7; font-weight: bold;">in</span>
    <span style="color: #4f97d7; font-weight: bold;">switch</span> never <span style="color: #2d9574;">{</span>
    <span style="color: #2d9574;">}</span>
  <span style="color: #bc6ec5;">}</span>
<span style="color: #4f97d7;">}</span>
</pre>
</div>
<p>
This can actually be useful, eg. in case of <code>Result&lt;Int, Never&gt;</code>.
</p>

<p>
Remember that <code>inout A -&gt; Void</code> can be transformed to <code>A-&gt;A</code>?
This means that you can refactor <code>(A,B) -&gt; A</code> into <code>(inout A, B) -&gt; Void</code>,
<code>(A, inout B) -&gt; C</code> to <code>(A, B) -&gt; (C, B)</code> and such.
</p>

<p>
We can also see a correspondence between <code>throws</code> and <code>Result&lt;A, Error&gt;</code>.
</p>

<p>
There is also the power law \(a^(b+c) = a^b * a ^ c\), equivalent to
<code>Either&lt;B, C&gt; -&gt; A = (B -&gt; A, C -&gt; A)</code>
</p>

<p>
💡We can use exponent laws to understand which functions can't and can not be simplified.
</p>
</div>

<div id="outline-container-sec-8-1" class="outline-3">
<h3 id="sec-8-1"><span class="section-number-3">8.1</span> Exercises</h3>
<div class="outline-text-3" id="text-8-1">
<ol class="org-ol">
<li>\(1^a = 1\)
<code>Void &lt;- a = Void</code>
<code>a -&gt; Void = Void</code>
<div class="org-src-container">

<pre class="src src-swift">        <span style="color: #4f97d7; font-weight: bold;">func</span> <span style="color: #bc6ec5; font-weight: bold;">to</span>&lt;A&gt;<span style="color: #4f97d7;">(</span>a: A<span style="color: #4f97d7;">)</span> -&gt; <span style="color: #4f97d7;">(</span><span style="color: #4f97d7;">Void</span><span style="color: #4f97d7;">)</span> -&gt; <span style="color: #4f97d7;">Void</span> <span style="color: #4f97d7;">{</span>
            <span style="color: #bc6ec5;">{</span> void <span style="color: #4f97d7; font-weight: bold;">in</span> void <span style="color: #bc6ec5;">}</span>
        <span style="color: #4f97d7;">}</span>
        
        <span style="color: #4f97d7; font-weight: bold;">func</span> <span style="color: #bc6ec5; font-weight: bold;">from</span>&lt;A&gt;<span style="color: #4f97d7;">(</span>void: <span style="color: #4f97d7;">Void</span><span style="color: #4f97d7;">)</span> -&gt; <span style="color: #4f97d7;">(</span>A<span style="color: #4f97d7;">)</span> -&gt; <span style="color: #4f97d7;">Void</span> <span style="color: #4f97d7;">{</span>
            <span style="color: #bc6ec5;">{</span> a <span style="color: #4f97d7; font-weight: bold;">in</span> void <span style="color: #bc6ec5;">}</span>
        <span style="color: #4f97d7;">}</span>
</pre>
</div>
</li>
<li>Case 1: \(0^a = 0 | a != 0\)
<code>a -&gt; Never = Never</code>
<div class="org-src-container">

<pre class="src src-swift">        <span style="color: #4f97d7; font-weight: bold;">func</span> <span style="color: #bc6ec5; font-weight: bold;">from</span>&lt;A&gt;<span style="color: #4f97d7;">(</span>a: A<span style="color: #4f97d7;">)</span> -&gt; <span style="color: #4f97d7;">(</span><span style="color: #4f97d7;">Never</span><span style="color: #4f97d7;">)</span> -&gt; <span style="color: #4f97d7;">(</span><span style="color: #4f97d7;">Never</span><span style="color: #4f97d7;">)</span> <span style="color: #4f97d7;">{</span>
            <span style="color: #bc6ec5;">{</span> never <span style="color: #4f97d7; font-weight: bold;">in</span>
                never
            <span style="color: #bc6ec5;">}</span>
        <span style="color: #4f97d7;">}</span>
        
        <span style="color: #4f97d7; font-weight: bold;">func</span> <span style="color: #bc6ec5; font-weight: bold;">to</span>&lt;A&gt;<span style="color: #4f97d7;">(</span>never: <span style="color: #4f97d7;">Never</span><span style="color: #4f97d7;">)</span> -&gt; <span style="color: #4f97d7;">(</span>A<span style="color: #4f97d7;">)</span> -&gt; <span style="color: #4f97d7;">(</span><span style="color: #4f97d7;">Never</span><span style="color: #4f97d7;">)</span> <span style="color: #4f97d7;">{</span>
            <span style="color: #bc6ec5;">{</span> a <span style="color: #4f97d7; font-weight: bold;">in</span>
                never
            <span style="color: #bc6ec5;">}</span>
        <span style="color: #4f97d7;">}</span>
</pre>
</div>
<p>
Case 2: \(0^a = undefined | a = 0\)
</p>
</li>
<li>We will know in the next "Algebraic data types" episode 😌
</li>
<li><code>2^A = Set&lt;A&gt;</code>
<code>A -&gt; Bool = Set&lt;A&gt;</code>
So we can interpret a set as a function from A to Bool,
that returns true if the element is contained, and false otherwise.
</li>
<li><div class="org-src-container">

<pre class="src src-swift">         <span style="color: #4f97d7; font-weight: bold;">func</span> <span style="color: #bc6ec5; font-weight: bold;">intersection</span>&lt;A&gt;<span style="color: #4f97d7;">(</span>a: <span style="color: #4f97d7; font-weight: bold;">@escaping</span> <span style="color: #bc6ec5;">(</span><span style="color: #2d9574;">(</span>A<span style="color: #2d9574;">)</span> -&gt; <span style="color: #4f97d7;">Bool</span><span style="color: #bc6ec5;">)</span>, b: <span style="color: #4f97d7; font-weight: bold;">@escaping</span> <span style="color: #bc6ec5;">(</span>A<span style="color: #bc6ec5;">)</span> -&gt; <span style="color: #bc6ec5;">(</span><span style="color: #4f97d7;">Bool</span><span style="color: #bc6ec5;">)</span><span style="color: #4f97d7;">)</span> -&gt; <span style="color: #4f97d7;">(</span>A<span style="color: #4f97d7;">)</span> -&gt; <span style="color: #4f97d7;">Bool</span> <span style="color: #4f97d7;">{</span>
             <span style="color: #bc6ec5;">{</span> e <span style="color: #4f97d7; font-weight: bold;">in</span>
                 <span style="color: #4f97d7; font-weight: bold;">return</span> <span style="color: #bc6ec5; font-weight: bold;">a</span><span style="color: #2d9574;">(</span>e<span style="color: #2d9574;">)</span> &amp;&amp; <span style="color: #bc6ec5; font-weight: bold;">b</span><span style="color: #2d9574;">(</span>e<span style="color: #2d9574;">)</span>
             <span style="color: #bc6ec5;">}</span>
         <span style="color: #4f97d7;">}</span>
        
         <span style="color: #4f97d7; font-weight: bold;">func</span> <span style="color: #bc6ec5; font-weight: bold;">union</span>&lt;A&gt;<span style="color: #4f97d7;">(</span>a: <span style="color: #4f97d7; font-weight: bold;">@escaping</span> <span style="color: #bc6ec5;">(</span><span style="color: #2d9574;">(</span>A<span style="color: #2d9574;">)</span> -&gt; <span style="color: #4f97d7;">Bool</span><span style="color: #bc6ec5;">)</span>, b: <span style="color: #4f97d7; font-weight: bold;">@escaping</span> <span style="color: #bc6ec5;">(</span>A<span style="color: #bc6ec5;">)</span> -&gt; <span style="color: #bc6ec5;">(</span><span style="color: #4f97d7;">Bool</span><span style="color: #bc6ec5;">)</span><span style="color: #4f97d7;">)</span> -&gt; <span style="color: #4f97d7;">(</span>A<span style="color: #4f97d7;">)</span> -&gt; <span style="color: #4f97d7;">Bool</span> <span style="color: #4f97d7;">{</span>
             <span style="color: #bc6ec5;">{</span> e <span style="color: #4f97d7; font-weight: bold;">in</span>
                 <span style="color: #4f97d7; font-weight: bold;">return</span> <span style="color: #bc6ec5; font-weight: bold;">a</span><span style="color: #2d9574;">(</span>e<span style="color: #2d9574;">)</span> || <span style="color: #bc6ec5; font-weight: bold;">b</span><span style="color: #2d9574;">(</span>e<span style="color: #2d9574;">)</span>
             <span style="color: #bc6ec5;">}</span>
         <span style="color: #4f97d7;">}</span>
</pre>
</div>
</li>
<li>\((1+V)^K\)
Because we map from the key space to the value space with one additional element <code>nil</code>.
</li>
<li><div class="org-src-container">

<pre class="src src-swift">         <span style="color: #4f97d7; font-weight: bold;">func</span> <span style="color: #bc6ec5; font-weight: bold;">to</span>&lt;A, B, C&gt;<span style="color: #4f97d7;">(</span>_ f: <span style="color: #4f97d7; font-weight: bold;">@escaping</span> <span style="color: #bc6ec5;">(</span>Either&lt;B, C&gt;<span style="color: #bc6ec5;">)</span> -&gt; A<span style="color: #4f97d7;">)</span> -&gt; <span style="color: #4f97d7;">(</span><span style="color: #bc6ec5;">(</span>B<span style="color: #bc6ec5;">)</span> -&gt; A, <span style="color: #bc6ec5;">(</span>C<span style="color: #bc6ec5;">)</span> -&gt; A<span style="color: #4f97d7;">)</span> <span style="color: #4f97d7;">{</span>
             <span style="color: #bc6ec5;">(</span> <span style="color: #2d9574;">{</span> b <span style="color: #4f97d7; font-weight: bold;">in</span> <span style="color: #bc6ec5; font-weight: bold;">f</span><span style="color: #67b11d;">(</span>.<span style="color: #4f97d7; font-weight: bold;">left</span><span style="color: #b1951d;">(</span>b<span style="color: #b1951d;">)</span><span style="color: #67b11d;">)</span> <span style="color: #2d9574;">}</span>
                 ,
               <span style="color: #2d9574;">{</span> c <span style="color: #4f97d7; font-weight: bold;">in</span> <span style="color: #bc6ec5; font-weight: bold;">f</span><span style="color: #67b11d;">(</span>.<span style="color: #4f97d7; font-weight: bold;">right</span><span style="color: #b1951d;">(</span>c<span style="color: #b1951d;">)</span><span style="color: #67b11d;">)</span> <span style="color: #2d9574;">}</span>
             <span style="color: #bc6ec5;">)</span>
         <span style="color: #4f97d7;">}</span>
        
         <span style="color: #4f97d7; font-weight: bold;">func</span> <span style="color: #bc6ec5; font-weight: bold;">from</span>&lt;A, B, C&gt;<span style="color: #4f97d7;">(</span>_ f: <span style="color: #bc6ec5;">(</span><span style="color: #2d9574;">(</span>B<span style="color: #2d9574;">)</span> -&gt; A, <span style="color: #2d9574;">(</span>C<span style="color: #2d9574;">)</span> -&gt; A<span style="color: #bc6ec5;">)</span><span style="color: #4f97d7;">)</span> -&gt; <span style="color: #4f97d7;">(</span>Either&lt;B, C&gt;<span style="color: #4f97d7;">)</span> -&gt; A <span style="color: #4f97d7;">{</span>
             <span style="color: #4f97d7; font-weight: bold;">let</span> <span style="color: #bc6ec5;">(</span>bToA, cToA<span style="color: #bc6ec5;">)</span> = f
             <span style="color: #4f97d7; font-weight: bold;">return</span> <span style="color: #bc6ec5;">{</span> bc <span style="color: #4f97d7; font-weight: bold;">in</span>
                 <span style="color: #4f97d7; font-weight: bold;">switch</span> bc <span style="color: #2d9574;">{</span>
                 <span style="color: #4f97d7; font-weight: bold;">case</span> .<span style="color: #4f97d7; font-weight: bold;">left</span><span style="color: #67b11d;">(</span><span style="color: #4f97d7; font-weight: bold;">let</span> b<span style="color: #67b11d;">)</span>:
                     <span style="color: #4f97d7; font-weight: bold;">return</span> <span style="color: #bc6ec5; font-weight: bold;">bToA</span><span style="color: #67b11d;">(</span>b<span style="color: #67b11d;">)</span>
                 <span style="color: #4f97d7; font-weight: bold;">case</span> .<span style="color: #4f97d7; font-weight: bold;">right</span><span style="color: #67b11d;">(</span><span style="color: #4f97d7; font-weight: bold;">let</span> c<span style="color: #67b11d;">)</span>:
                     <span style="color: #4f97d7; font-weight: bold;">return</span> <span style="color: #bc6ec5; font-weight: bold;">cToA</span><span style="color: #67b11d;">(</span>c<span style="color: #67b11d;">)</span>
                 <span style="color: #2d9574;">}</span>
             <span style="color: #bc6ec5;">}</span>
         <span style="color: #4f97d7;">}</span>
</pre>
</div>
</li>
<li><div class="org-src-container">

<pre class="src src-swift">        <span style="color: #4f97d7; font-weight: bold;">func</span> <span style="color: #bc6ec5; font-weight: bold;">to</span>&lt;A, B, C&gt;<span style="color: #4f97d7;">(</span>_ f: <span style="color: #4f97d7; font-weight: bold;">@escaping</span> <span style="color: #bc6ec5;">(</span>C<span style="color: #bc6ec5;">)</span> -&gt; <span style="color: #bc6ec5;">(</span>A, B<span style="color: #bc6ec5;">)</span><span style="color: #4f97d7;">)</span> -&gt; <span style="color: #4f97d7;">(</span><span style="color: #bc6ec5;">(</span>C<span style="color: #bc6ec5;">)</span> -&gt; A, <span style="color: #bc6ec5;">(</span>C<span style="color: #bc6ec5;">)</span> -&gt; B<span style="color: #4f97d7;">)</span> <span style="color: #4f97d7;">{</span>
            <span style="color: #bc6ec5;">(</span> <span style="color: #2d9574;">{</span> c <span style="color: #4f97d7; font-weight: bold;">in</span> <span style="color: #bc6ec5; font-weight: bold;">f</span><span style="color: #67b11d;">(</span>c<span style="color: #67b11d;">)</span>.<span style="color: #a45bad;">0</span> <span style="color: #2d9574;">}</span>
                ,
              <span style="color: #2d9574;">{</span> c <span style="color: #4f97d7; font-weight: bold;">in</span> <span style="color: #bc6ec5; font-weight: bold;">f</span><span style="color: #67b11d;">(</span>c<span style="color: #67b11d;">)</span>.<span style="color: #a45bad;">1</span> <span style="color: #2d9574;">}</span>
            <span style="color: #bc6ec5;">)</span>
        <span style="color: #4f97d7;">}</span>
        
                <span style="color: #4f97d7; font-weight: bold;">func</span> <span style="color: #bc6ec5; font-weight: bold;">from</span>&lt;A, B, C&gt;<span style="color: #4f97d7;">(</span>_ f: <span style="color: #bc6ec5;">(</span><span style="color: #2d9574;">(</span>C<span style="color: #2d9574;">)</span> -&gt; A, <span style="color: #2d9574;">(</span>C<span style="color: #2d9574;">)</span> -&gt; B<span style="color: #bc6ec5;">)</span><span style="color: #4f97d7;">)</span> -&gt; <span style="color: #4f97d7;">(</span>C<span style="color: #4f97d7;">)</span> -&gt; <span style="color: #4f97d7;">(</span>A, B<span style="color: #4f97d7;">)</span> <span style="color: #4f97d7;">{</span>
            <span style="color: #4f97d7; font-weight: bold;">let</span> <span style="color: #bc6ec5;">(</span>cToA, cToB<span style="color: #bc6ec5;">)</span> = f
            <span style="color: #4f97d7; font-weight: bold;">return</span> <span style="color: #bc6ec5;">{</span> c <span style="color: #4f97d7; font-weight: bold;">in</span>
                <span style="color: #2d9574;">(</span><span style="color: #bc6ec5; font-weight: bold;">cToA</span><span style="color: #67b11d;">(</span>c<span style="color: #67b11d;">)</span>, <span style="color: #bc6ec5; font-weight: bold;">cToB</span><span style="color: #67b11d;">(</span>c<span style="color: #67b11d;">)</span><span style="color: #2d9574;">)</span>
            <span style="color: #bc6ec5;">}</span>
        <span style="color: #4f97d7;">}</span>
        
</pre>
</div>
</li>
</ol>
</div>
</div>
</div>

<div id="outline-container-sec-9" class="outline-2">
<h2 id="sec-9"><span class="section-number-2">9</span> A tale of two flat maps</h2>
<div class="outline-text-2" id="text-9">
<p>
<code>flatMap</code> is the mondaic bind.
use <code>compactMap</code> to filter nil values.
</p>
</div>
<div id="outline-container-sec-9-1" class="outline-3">
<h3 id="sec-9-1"><span class="section-number-3">9.1</span> Exercises</h3>
<div class="outline-text-3" id="text-9-1">
<ol class="org-ol">
<li>filtered:
<div class="org-src-container">

<pre class="src src-swift">       <span style="color: #4f97d7; font-weight: bold;">func</span> <span style="color: #bc6ec5; font-weight: bold;">filtered</span>&lt;A&gt;<span style="color: #4f97d7;">(</span>_ lst: <span style="color: #bc6ec5;">[</span>A?<span style="color: #bc6ec5;">]</span><span style="color: #4f97d7;">)</span> -&gt; <span style="color: #4f97d7;">[</span>A<span style="color: #4f97d7;">]</span> <span style="color: #4f97d7;">{</span>
           lst.<span style="color: #4f97d7;">compactMap</span> <span style="color: #bc6ec5;">{</span> x <span style="color: #4f97d7; font-weight: bold;">in</span> x <span style="color: #bc6ec5;">}</span>
       <span style="color: #4f97d7;">}</span>
</pre>
</div>
</li>
<li><div class="org-src-container">

<pre class="src src-swift">         <span style="color: #4f97d7; font-weight: bold;">func</span> <span style="color: #4f97d7; font-weight: bold;">left</span>&lt;A, B&gt;<span style="color: #4f97d7;">(</span>_ either: Either&lt;A, B&gt;<span style="color: #4f97d7;">)</span> -&gt; A? <span style="color: #4f97d7;">{</span>
             <span style="color: #4f97d7; font-weight: bold;">switch</span> either <span style="color: #bc6ec5;">{</span>
             <span style="color: #4f97d7; font-weight: bold;">case</span> .<span style="color: #4f97d7; font-weight: bold;">left</span><span style="color: #2d9574;">(</span><span style="color: #4f97d7; font-weight: bold;">let</span> l<span style="color: #2d9574;">)</span>:
                 <span style="color: #4f97d7; font-weight: bold;">return</span> l
             <span style="color: #4f97d7; font-weight: bold;">default</span>:
                 <span style="color: #4f97d7; font-weight: bold;">return</span> <span style="color: #a45bad;">nil</span>
             <span style="color: #bc6ec5;">}</span>
         <span style="color: #4f97d7;">}</span>
        
         <span style="color: #4f97d7; font-weight: bold;">func</span> <span style="color: #4f97d7; font-weight: bold;">right</span>&lt;A, B&gt;<span style="color: #4f97d7;">(</span>_ either: Either&lt;A, B&gt;<span style="color: #4f97d7;">)</span> -&gt; B? <span style="color: #4f97d7;">{</span>
             <span style="color: #4f97d7; font-weight: bold;">switch</span> either <span style="color: #bc6ec5;">{</span>
             <span style="color: #4f97d7; font-weight: bold;">case</span> .<span style="color: #4f97d7; font-weight: bold;">right</span><span style="color: #2d9574;">(</span><span style="color: #4f97d7; font-weight: bold;">let</span> r<span style="color: #2d9574;">)</span>:
                 <span style="color: #4f97d7; font-weight: bold;">return</span> r
             <span style="color: #4f97d7; font-weight: bold;">default</span>:
                 <span style="color: #4f97d7; font-weight: bold;">return</span> <span style="color: #a45bad;">nil</span>
             <span style="color: #bc6ec5;">}</span>
         <span style="color: #4f97d7;">}</span>
        
         <span style="color: #4f97d7; font-weight: bold;">func</span> <span style="color: #bc6ec5; font-weight: bold;">partitioned</span>&lt;A, B&gt;<span style="color: #4f97d7;">(</span>_ either: <span style="color: #bc6ec5;">[</span>Either&lt;A,B&gt;<span style="color: #bc6ec5;">]</span><span style="color: #4f97d7;">)</span> -&gt; <span style="color: #4f97d7;">(</span><span style="color: #4f97d7; font-weight: bold;">left</span>: <span style="color: #bc6ec5;">[</span>A<span style="color: #bc6ec5;">]</span>, <span style="color: #4f97d7; font-weight: bold;">right</span>: <span style="color: #bc6ec5;">[</span>B<span style="color: #bc6ec5;">]</span><span style="color: #4f97d7;">)</span> <span style="color: #4f97d7;">{</span>
             <span style="color: #bc6ec5;">(</span> either.<span style="color: #4f97d7;">compactMap</span><span style="color: #2d9574;">(</span><span style="color: #4f97d7; font-weight: bold;">left</span><span style="color: #2d9574;">)</span>
                 ,
               either.<span style="color: #4f97d7;">compactMap</span><span style="color: #2d9574;">(</span><span style="color: #4f97d7; font-weight: bold;">right</span><span style="color: #2d9574;">)</span>
             <span style="color: #bc6ec5;">)</span>
         <span style="color: #4f97d7;">}</span>
        
</pre>
</div>
</li>
<li><div class="org-src-container">

<pre class="src src-swift">         <span style="color: #4f97d7; font-weight: bold;">func</span> <span style="color: #bc6ec5; font-weight: bold;">partitionMap</span>&lt;A, B, C&gt;<span style="color: #4f97d7;">(</span>
             _ <span style="color: #4f97d7; font-weight: bold;">optional</span>: <span style="color: #4f97d7;">Optional</span>&lt;A&gt;,
             _ f: <span style="color: #4f97d7; font-weight: bold;">@escaping</span> <span style="color: #bc6ec5;">(</span><span style="color: #2d9574;">(</span>A<span style="color: #2d9574;">)</span> -&gt; Either&lt;B, C&gt;<span style="color: #bc6ec5;">)</span><span style="color: #4f97d7;">)</span> -&gt; <span style="color: #4f97d7;">(</span><span style="color: #4f97d7;">Optional</span>&lt;B&gt;, <span style="color: #4f97d7;">Optional</span>&lt;C&gt;<span style="color: #4f97d7;">)</span> <span style="color: #4f97d7;">{</span>
             <span style="color: #bc6ec5;">(</span> <span style="color: #4f97d7; font-weight: bold;">optional</span>.<span style="color: #4f97d7;">flatMap</span><span style="color: #2d9574;">(</span>f &gt;&gt;&gt; <span style="color: #4f97d7; font-weight: bold;">left</span><span style="color: #2d9574;">)</span>
                 ,
               <span style="color: #4f97d7; font-weight: bold;">optional</span>.<span style="color: #4f97d7;">flatMap</span><span style="color: #2d9574;">(</span>f &gt;&gt;&gt; <span style="color: #4f97d7; font-weight: bold;">right</span><span style="color: #2d9574;">)</span>
             <span style="color: #bc6ec5;">)</span>
         <span style="color: #4f97d7;">}</span>
</pre>
</div>
</li>
<li><div class="org-src-container">

<pre class="src src-swift">         <span style="color: #4f97d7; font-weight: bold;">func</span> <span style="color: #bc6ec5; font-weight: bold;">filterMapValues</span>&lt;K, V, R&gt;<span style="color: #4f97d7;">(</span>_ d: <span style="color: #4f97d7;">Dictionary</span>&lt;K, V&gt;<span style="color: #4f97d7;">)</span> -&gt; <span style="color: #4f97d7;">(</span><span style="color: #bc6ec5;">(</span>V<span style="color: #bc6ec5;">)</span> -&gt; R?<span style="color: #4f97d7;">)</span> -&gt; <span style="color: #4f97d7;">[</span>R<span style="color: #4f97d7;">]</span> <span style="color: #4f97d7;">{</span> <span style="color: #bc6ec5;">{</span> f <span style="color: #4f97d7; font-weight: bold;">in</span>
             d.<span style="color: #4f97d7;">values</span>.<span style="color: #4f97d7;">compactMap</span><span style="color: #2d9574;">(</span>f<span style="color: #2d9574;">)</span>
         <span style="color: #bc6ec5;">}</span>
         <span style="color: #4f97d7;">}</span>
</pre>
</div>
</li>
<li><div class="org-src-container">

<pre class="src src-swift">         <span style="color: #4f97d7; font-weight: bold;">func</span> <span style="color: #bc6ec5; font-weight: bold;">partitionMapValues</span>&lt;K, V, A, B&gt;<span style="color: #4f97d7;">(</span>_ d: <span style="color: #4f97d7;">Dictionary</span>&lt;K, V&gt;<span style="color: #4f97d7;">)</span> -&gt; <span style="color: #4f97d7;">(</span><span style="color: #bc6ec5;">(</span>V<span style="color: #bc6ec5;">)</span> -&gt; Either&lt;A, B&gt;<span style="color: #4f97d7;">)</span> -&gt; <span style="color: #4f97d7;">(</span>lefts: <span style="color: #bc6ec5;">[</span>A<span style="color: #bc6ec5;">]</span>, rights: <span style="color: #bc6ec5;">[</span>B<span style="color: #bc6ec5;">]</span><span style="color: #4f97d7;">)</span> <span style="color: #4f97d7;">{</span>
             <span style="color: #bc6ec5;">{</span> f <span style="color: #4f97d7; font-weight: bold;">in</span>
                 <span style="color: #4f97d7;">Array</span><span style="color: #2d9574;">(</span>d.<span style="color: #4f97d7;">values</span><span style="color: #2d9574;">)</span>.<span style="color: #bc6ec5; font-weight: bold;">partitionMap</span><span style="color: #2d9574;">(</span>f<span style="color: #2d9574;">)</span>
             <span style="color: #bc6ec5;">}</span>
         <span style="color: #4f97d7;">}</span>
</pre>
</div>
</li>
<li><div class="org-src-container">

<pre class="src src-swift">         <span style="color: #4f97d7; font-weight: bold;">func</span> <span style="color: #bc6ec5; font-weight: bold;">optionalEither</span>&lt;A, B&gt;<span style="color: #4f97d7;">(</span>_ f: <span style="color: #4f97d7; font-weight: bold;">@escaping</span> <span style="color: #bc6ec5;">(</span><span style="color: #2d9574;">(</span>A<span style="color: #2d9574;">)</span> -&gt; B?<span style="color: #bc6ec5;">)</span><span style="color: #4f97d7;">)</span> -&gt; <span style="color: #4f97d7;">(</span>A<span style="color: #4f97d7;">)</span> -&gt; Either&lt;B, <span style="color: #4f97d7;">Void</span>&gt; <span style="color: #4f97d7;">{</span>
             <span style="color: #bc6ec5;">{</span> a <span style="color: #4f97d7; font-weight: bold;">in</span>
                 <span style="color: #4f97d7; font-weight: bold;">if</span> <span style="color: #4f97d7; font-weight: bold;">let</span> r = <span style="color: #bc6ec5; font-weight: bold;">f</span><span style="color: #2d9574;">(</span>a<span style="color: #2d9574;">)</span> <span style="color: #2d9574;">{</span>
                     <span style="color: #4f97d7; font-weight: bold;">return</span> .<span style="color: #4f97d7; font-weight: bold;">left</span><span style="color: #67b11d;">(</span>r<span style="color: #67b11d;">)</span>
                 <span style="color: #2d9574;">}</span> <span style="color: #4f97d7; font-weight: bold;">else</span> <span style="color: #2d9574;">{</span>
                     <span style="color: #4f97d7; font-weight: bold;">return</span> .<span style="color: #4f97d7; font-weight: bold;">right</span><span style="color: #67b11d;">(</span><span style="color: #b1951d;">()</span><span style="color: #67b11d;">)</span>
                 <span style="color: #2d9574;">}</span>
             <span style="color: #bc6ec5;">}</span>
         <span style="color: #4f97d7;">}</span>
         
         <span style="color: #4f97d7; font-weight: bold;">func</span> <span style="color: #bc6ec5; font-weight: bold;">filterMap</span>&lt;A, B&gt;<span style="color: #4f97d7;">(</span>_ f: <span style="color: #4f97d7; font-weight: bold;">@escaping</span> <span style="color: #bc6ec5;">(</span><span style="color: #2d9574;">(</span>A<span style="color: #2d9574;">)</span> -&gt; B?<span style="color: #bc6ec5;">)</span>, _ a: <span style="color: #bc6ec5;">[</span>A<span style="color: #bc6ec5;">]</span><span style="color: #4f97d7;">)</span> -&gt; <span style="color: #4f97d7;">[</span>B<span style="color: #4f97d7;">]</span> <span style="color: #4f97d7;">{</span>
             a.<span style="color: #bc6ec5; font-weight: bold;">partitionMap</span><span style="color: #bc6ec5;">(</span><span style="color: #bc6ec5; font-weight: bold;">optionalEither</span><span style="color: #2d9574;">(</span>f<span style="color: #2d9574;">)</span><span style="color: #bc6ec5;">)</span>.<span style="color: #7590db;">lefts</span>
         <span style="color: #4f97d7;">}</span>
         
         <span style="color: #4f97d7; font-weight: bold;">func</span> <span style="color: #bc6ec5; font-weight: bold;">predicateOptional</span>&lt;A&gt;<span style="color: #4f97d7;">(</span>_ f: <span style="color: #4f97d7; font-weight: bold;">@escaping</span> <span style="color: #bc6ec5;">(</span>A<span style="color: #bc6ec5;">)</span> -&gt; <span style="color: #4f97d7;">Bool</span><span style="color: #4f97d7;">)</span> -&gt; <span style="color: #4f97d7;">(</span>A<span style="color: #4f97d7;">)</span> -&gt; A? <span style="color: #4f97d7;">{</span>
             <span style="color: #bc6ec5;">{</span> a <span style="color: #4f97d7; font-weight: bold;">in</span>
                 <span style="color: #bc6ec5; font-weight: bold;">f</span><span style="color: #2d9574;">(</span>a<span style="color: #2d9574;">)</span> ? a : <span style="color: #a45bad;">nil</span>
             <span style="color: #bc6ec5;">}</span>
         <span style="color: #4f97d7;">}</span>
         
         <span style="color: #4f97d7; font-weight: bold;">func</span> <span style="color: #bc6ec5; font-weight: bold;">filter</span>&lt;A&gt;<span style="color: #4f97d7;">(</span>_ f: <span style="color: #4f97d7; font-weight: bold;">@escaping</span> <span style="color: #bc6ec5;">(</span><span style="color: #2d9574;">(</span>A<span style="color: #2d9574;">)</span> -&gt; <span style="color: #4f97d7;">Bool</span><span style="color: #bc6ec5;">)</span>, _ a: <span style="color: #bc6ec5;">[</span>A<span style="color: #bc6ec5;">]</span><span style="color: #4f97d7;">)</span> -&gt; <span style="color: #4f97d7;">[</span>A<span style="color: #4f97d7;">]</span> <span style="color: #4f97d7;">{</span>
             a.<span style="color: #bc6ec5; font-weight: bold;">partitionMap</span><span style="color: #bc6ec5;">(</span><span style="color: #bc6ec5; font-weight: bold;">optionalEither</span><span style="color: #2d9574;">(</span><span style="color: #bc6ec5; font-weight: bold;">predicateOptional</span><span style="color: #67b11d;">(</span>f<span style="color: #67b11d;">)</span><span style="color: #2d9574;">)</span><span style="color: #bc6ec5;">)</span>.<span style="color: #7590db;">lefts</span>
         <span style="color: #4f97d7;">}</span>
</pre>
</div>
</li>
<li>Depends on what is allowed. You'd have to pass it two transformation functions for the left and the right case,
that have the same <code>Either&lt;A,B&gt;</code> return type. Then you can partition into <code>(Optional&lt;A&gt;, Optional&lt;B&gt;)</code>.
</li>
</ol>
</div>
</div>
</div>

<div id="outline-container-sec-10" class="outline-2">
<h2 id="sec-10"><span class="section-number-2">10</span> Composition without operators</h2>
<div class="outline-text-2" id="text-10">
<p>
If operators are not the way to go, you can use named functions.
The problem is that you need an overload for any number of arguments.
This might change in the future for variadic generics.
</p>
</div>
<div id="outline-container-sec-10-1" class="outline-3">
<h3 id="sec-10-1"><span class="section-number-3">10.1</span> Exercises</h3>
<div class="outline-text-3" id="text-10-1">
<ol class="org-ol">
<li><div class="org-src-container">

<pre class="src src-swift">          <span style="color: #4f97d7; font-weight: bold;">func</span> <span style="color: #bc6ec5; font-weight: bold;">concat</span>&lt;A: <span style="color: #4f97d7;">AnyObject</span>&gt;<span style="color: #4f97d7;">(</span>
              _ fs: <span style="color: #bc6ec5;">(</span><span style="color: #2d9574;">(</span><span style="color: #4f97d7; font-weight: bold;">inout</span> A<span style="color: #2d9574;">)</span> -&gt; <span style="color: #4f97d7;">Void</span><span style="color: #bc6ec5;">)</span>...
          <span style="color: #4f97d7;">)</span>
          -&gt; <span style="color: #4f97d7;">(</span><span style="color: #4f97d7; font-weight: bold;">inout</span> A<span style="color: #4f97d7;">)</span> -&gt; <span style="color: #4f97d7;">Void</span> <span style="color: #4f97d7;">{</span>
              <span style="color: #bc6ec5;">{</span> a <span style="color: #4f97d7; font-weight: bold;">in</span> fs.<span style="color: #4f97d7;">forEach</span> <span style="color: #2d9574;">{</span> $<span style="color: #bc6ec5; font-weight: bold;">0</span><span style="color: #67b11d;">(</span>&amp;a<span style="color: #67b11d;">)</span> <span style="color: #2d9574;">}</span> <span style="color: #bc6ec5;">}</span>
          <span style="color: #4f97d7;">}</span>
</pre>
</div>
</li>
<li><div class="org-src-container">

<pre class="src src-swift">        <span style="color: #4f97d7; font-weight: bold;">func</span> <span style="color: #bc6ec5; font-weight: bold;">concat</span>&lt;A: <span style="color: #4f97d7;">AnyObject</span>&gt;<span style="color: #4f97d7;">(</span>
            _ fs: <span style="color: #bc6ec5;">(</span><span style="color: #2d9574;">(</span>A<span style="color: #2d9574;">)</span> -&gt; A<span style="color: #bc6ec5;">)</span>...
        <span style="color: #4f97d7;">)</span>
        -&gt; <span style="color: #4f97d7;">(</span>A<span style="color: #4f97d7;">)</span> -&gt; A <span style="color: #4f97d7;">{</span>
            <span style="color: #bc6ec5;">{</span> x <span style="color: #4f97d7; font-weight: bold;">in</span>
                <span style="color: #4f97d7; font-weight: bold;">return</span> <span style="color: #bc6ec5; font-weight: bold;">reduce</span><span style="color: #2d9574;">(</span>f: <span style="color: #67b11d;">{</span> a, f <span style="color: #4f97d7; font-weight: bold;">in</span> <span style="color: #bc6ec5; font-weight: bold;">f</span><span style="color: #b1951d;">(</span>a<span style="color: #b1951d;">)</span> <span style="color: #67b11d;">}</span><span style="color: #2d9574;">)(</span>fs<span style="color: #2d9574;">)(</span>x<span style="color: #2d9574;">)</span>
            <span style="color: #bc6ec5;">}</span>
        <span style="color: #4f97d7;">}</span>
</pre>
</div>
</li>
<li><div class="org-src-container">

<pre class="src src-swift">       <span style="color: #4f97d7; font-weight: bold;">func</span> <span style="color: #bc6ec5; font-weight: bold;">compose</span>&lt;A, B, C&gt;<span style="color: #4f97d7;">(</span>_ f: <span style="color: #4f97d7; font-weight: bold;">@escaping</span> <span style="color: #bc6ec5;">(</span>B<span style="color: #bc6ec5;">)</span>-&gt;C, _ g: <span style="color: #4f97d7; font-weight: bold;">@escaping</span><span style="color: #bc6ec5;">(</span>A<span style="color: #bc6ec5;">)</span> -&gt; B<span style="color: #4f97d7;">)</span> -&gt; <span style="color: #4f97d7;">(</span><span style="color: #bc6ec5;">(</span>A<span style="color: #bc6ec5;">)</span> -&gt; C<span style="color: #4f97d7;">)</span> <span style="color: #4f97d7;">{</span>
           <span style="color: #bc6ec5;">{</span> a <span style="color: #4f97d7; font-weight: bold;">in</span> <span style="color: #bc6ec5; font-weight: bold;">f</span><span style="color: #2d9574;">(</span><span style="color: #bc6ec5; font-weight: bold;">g</span><span style="color: #67b11d;">(</span>a<span style="color: #67b11d;">)</span><span style="color: #2d9574;">)</span> <span style="color: #bc6ec5;">}</span>
       <span style="color: #4f97d7;">}</span>
       
       <span style="color: #4f97d7; font-weight: bold;">struct</span> <span style="color: #bc6ec5; font-weight: bold;">Dog</span> <span style="color: #4f97d7;">{</span>
           <span style="color: #4f97d7; font-weight: bold;">var</span> favoriteFood: DogFood
       <span style="color: #4f97d7;">}</span>
       
       <span style="color: #4f97d7; font-weight: bold;">struct</span> <span style="color: #bc6ec5; font-weight: bold;">DogFood</span> <span style="color: #4f97d7;">{</span>
           <span style="color: #4f97d7; font-weight: bold;">var</span> name: <span style="color: #4f97d7;">String</span>
           <span style="color: #4f97d7; font-weight: bold;">var</span> scrumptiousness: <span style="color: #4f97d7;">Int</span>
       <span style="color: #4f97d7;">}</span>
       
       <span style="color: #4f97d7; font-weight: bold;">let</span> doggieBoy: Dog = <span style="color: #bc6ec5; font-weight: bold;">compose</span><span style="color: #4f97d7;">(</span>
         <span style="color: #bc6ec5; font-weight: bold;">prop</span><span style="color: #bc6ec5;">(</span>\Dog.<span style="color: #7590db;">favoriteFood</span><span style="color: #bc6ec5;">)</span>,
          <span style="color: #bc6ec5; font-weight: bold;">prop</span><span style="color: #bc6ec5;">(</span>\DogFood.<span style="color: #7590db;">scrumptiousness</span><span style="color: #bc6ec5;">)</span><span style="color: #4f97d7;">)(</span><span style="color: #bc6ec5;">{</span>$0+<span style="color: #a45bad;">1</span><span style="color: #bc6ec5;">}</span><span style="color: #4f97d7;">)(</span>
         <span style="color: #bc6ec5; font-weight: bold;">Dog</span><span style="color: #bc6ec5;">(</span>favoriteFood: <span style="color: #bc6ec5; font-weight: bold;">DogFood</span><span style="color: #2d9574;">(</span>name: <span style="color: #2d9574;">"nuggers"</span>, scrumptiousness: <span style="color: #a45bad;">1999</span><span style="color: #2d9574;">)</span>
       <span style="color: #bc6ec5;">)</span><span style="color: #4f97d7;">)</span>
</pre>
</div>
</li>
</ol>
</div>
</div>
</div>

<div id="outline-container-sec-11" class="outline-2">
<h2 id="sec-11"><span class="section-number-2">11</span> <span class="label label-primary TODO">TODO</span> Tagged</h2>
<div class="outline-text-2" id="text-11">
<p>
We can use `Decodable` and `Encodable` to and from json.
Sometimes it can be desirable to wrap your datatypes with a custom type,
e.g. use an <code>Email</code> struct instead of just <code>String</code>.
This can help avoid errors, because the compiler will complain if you pass other fields to
e.g. a <code>sendEmail</code> function.
</p>

<p>
Problem: If you have a custom struct, you need to adapt the json structure.
Or implement your custom <code>Decodable</code> instance.
Or use <code>RawRepresentable</code> which saves a lot of code.
You will have to tag on an <code>Equatable</code> though:
</p>
<div class="org-src-container">

<pre class="src src-swift"><span style="color: #4f97d7; font-weight: bold;">struct</span> <span style="color: #bc6ec5; font-weight: bold;">Subscription</span>: <span style="color: #4f97d7;">Decodable</span> <span style="color: #4f97d7;">{</span>
  <span style="color: #4f97d7; font-weight: bold;">struct</span> <span style="color: #bc6ec5; font-weight: bold;">Id</span>: <span style="color: #4f97d7;">Decodable</span>, <span style="color: #4f97d7;">RawRepresentable</span>, <span style="color: #4f97d7;">Equatable</span> <span style="color: #bc6ec5;">{</span> <span style="color: #4f97d7; font-weight: bold;">let</span> rawValue: <span style="color: #4f97d7;">Int</span> <span style="color: #bc6ec5;">}</span>

  <span style="color: #4f97d7; font-weight: bold;">let</span> id: Id
  <span style="color: #4f97d7; font-weight: bold;">let</span> ownerId: <span style="color: #4f97d7;">Int</span>
<span style="color: #4f97d7;">}</span>
</pre>
</div>
<p>
This is really need, but you're gonna repeat the three protocols all over again.
Akin to <code>newtype</code> in haskell we can use <code>Tagged&lt;Tag, Type&gt;</code>:
</p>
<div class="org-src-container">

<pre class="src src-swift"><span style="color: #4f97d7; font-weight: bold;">struct</span> <span style="color: #bc6ec5; font-weight: bold;">Subscription</span>: <span style="color: #4f97d7;">Decodable</span> <span style="color: #4f97d7;">{</span>
  <span style="color: #4f97d7; font-weight: bold;">typealias</span> Id = Tagged&lt;Subscription, <span style="color: #4f97d7;">Int</span>&gt;

  <span style="color: #4f97d7; font-weight: bold;">let</span> id: Id
  <span style="color: #4f97d7; font-weight: bold;">let</span> ownerId: User.<span style="color: #7590db;">Id</span>
<span style="color: #4f97d7;">}</span>
</pre>
</div>
<p>
Tagged uses <i>Conditional conformance</i> to implement <code>Equatable</code> and <code>Decodable</code>:
</p>
<div class="org-src-container">

<pre class="src src-swift"><span style="color: #4f97d7; font-weight: bold;">extension</span> <span style="color: #bc6ec5; font-weight: bold;">Tagged</span>: <span style="color: #4f97d7;">Equatable</span> <span style="color: #4f97d7; font-weight: bold;">where</span> <span style="color: #4f97d7;">RawValue</span>: <span style="color: #4f97d7;">Equatable</span> <span style="color: #4f97d7;">{</span>
  <span style="color: #4f97d7; font-weight: bold;">static</span> <span style="color: #4f97d7; font-weight: bold;">func</span> == <span style="color: #bc6ec5;">(</span>lhs: Tagged, rhs: Tagged<span style="color: #bc6ec5;">)</span> -&gt; <span style="color: #4f97d7;">Bool</span> <span style="color: #bc6ec5;">{</span>
    <span style="color: #4f97d7; font-weight: bold;">return</span> lhs.<span style="color: #4f97d7;">rawValue</span> == rhs.<span style="color: #4f97d7;">rawValue</span>
  <span style="color: #bc6ec5;">}</span>
<span style="color: #4f97d7;">}</span>
</pre>
</div>
<p>
If you have to instantiate <code>Tagged</code> fields yourself, it makes sense to use
<code>ExpressibleBy...Literal</code> protocols.
</p>
</div>

<div id="outline-container-sec-11-1" class="outline-3">
<h3 id="sec-11-1"><span class="section-number-3">11.1</span> Exercises</h3>
<div class="outline-text-3" id="text-11-1">
<ol class="org-ol">
<li>Expressible by string:
<div class="org-src-container">

<pre class="src src-swift">        <span style="color: #4f97d7; font-weight: bold;">extension</span> <span style="color: #bc6ec5; font-weight: bold;">Tagged</span>: <span style="color: #4f97d7;">ExpressibleByUnicodeScalarLiteral</span> <span style="color: #4f97d7; font-weight: bold;">where</span> <span style="color: #4f97d7;">RawValue</span>: <span style="color: #4f97d7;">ExpressibleByStringLiteral</span> <span style="color: #4f97d7;">{</span>
            <span style="color: #4f97d7; font-weight: bold;">typealias</span> <span style="color: #4f97d7;">UnicodeScalarLiteralType</span> = <span style="color: #4f97d7;">String</span>
        <span style="color: #4f97d7;">}</span>
        
        <span style="color: #4f97d7; font-weight: bold;">extension</span> <span style="color: #bc6ec5; font-weight: bold;">Tagged</span>: <span style="color: #4f97d7;">ExpressibleByExtendedGraphemeClusterLiteral</span> <span style="color: #4f97d7; font-weight: bold;">where</span> <span style="color: #4f97d7;">RawValue</span>: <span style="color: #4f97d7;">ExpressibleByStringLiteral</span> <span style="color: #4f97d7;">{</span>
            <span style="color: #4f97d7; font-weight: bold;">init</span><span style="color: #bc6ec5;">(</span>extendedGraphemeClusterLiteral value: <span style="color: #4f97d7;">String</span><span style="color: #bc6ec5;">)</span> <span style="color: #bc6ec5;">{</span>
                <span style="color: #4f97d7; font-weight: bold;">self</span>.<span style="color: #4f97d7; font-weight: bold;">init</span><span style="color: #2d9574;">(</span>stringLiteral: value <span style="color: #4f97d7; font-weight: bold;">as</span>! <span style="color: #4f97d7;">RawValue</span>.<span style="color: #4f97d7;">StringLiteralType</span><span style="color: #2d9574;">)</span>
            <span style="color: #bc6ec5;">}</span>
        <span style="color: #4f97d7;">}</span>
        
        <span style="color: #4f97d7; font-weight: bold;">extension</span> <span style="color: #bc6ec5; font-weight: bold;">Tagged</span>: <span style="color: #4f97d7;">ExpressibleByStringLiteral</span> <span style="color: #4f97d7; font-weight: bold;">where</span> <span style="color: #4f97d7;">RawValue</span>: <span style="color: #4f97d7;">ExpressibleByStringLiteral</span> <span style="color: #4f97d7;">{</span>
            <span style="color: #4f97d7; font-weight: bold;">init</span><span style="color: #bc6ec5;">(</span>stringLiteral value: <span style="color: #4f97d7;">RawValue</span>.<span style="color: #4f97d7;">StringLiteralType</span><span style="color: #bc6ec5;">)</span> <span style="color: #bc6ec5;">{</span>
                <span style="color: #4f97d7; font-weight: bold;">self</span>.<span style="color: #4f97d7; font-weight: bold;">init</span><span style="color: #2d9574;">(</span>rawValue: <span style="color: #4f97d7;">RawValue</span><span style="color: #67b11d;">(</span>stringLiteral: value<span style="color: #67b11d;">)</span><span style="color: #2d9574;">)</span>
            <span style="color: #bc6ec5;">}</span>
        <span style="color: #4f97d7;">}</span>
</pre>
</div>
</li>
<li><div class="org-src-container">

<pre class="src src-swift">         <span style="color: #4f97d7; font-weight: bold;">extension</span> <span style="color: #bc6ec5; font-weight: bold;">Tagged</span>: <span style="color: #4f97d7;">Comparable</span> <span style="color: #4f97d7; font-weight: bold;">where</span> <span style="color: #4f97d7;">RawValue</span>: <span style="color: #4f97d7;">Comparable</span> <span style="color: #4f97d7;">{</span>
             <span style="color: #4f97d7; font-weight: bold;">static</span> <span style="color: #4f97d7; font-weight: bold;">func</span> &lt; <span style="color: #bc6ec5;">(</span>lhs: Tagged&lt;Tag, <span style="color: #4f97d7;">RawValue</span>&gt;, rhs: Tagged&lt;Tag, <span style="color: #4f97d7;">RawValue</span>&gt;<span style="color: #bc6ec5;">)</span> -&gt; <span style="color: #4f97d7;">Bool</span> <span style="color: #bc6ec5;">{</span>
                 <span style="color: #4f97d7; font-weight: bold;">return</span> lhs.<span style="color: #4f97d7;">rawValue</span> &lt; rhs.<span style="color: #4f97d7;">rawValue</span>
             <span style="color: #bc6ec5;">}</span>
         <span style="color: #4f97d7;">}</span>
         <span style="color: #2aa1ae; background-color: #292e34;">// </span><span style="color: #2aa1ae; background-color: #292e34;">from swift-overture:</span>
         <span style="color: #4f97d7; font-weight: bold;">public</span> <span style="color: #4f97d7; font-weight: bold;">func</span> <span style="color: #bc6ec5; font-weight: bold;">their</span>&lt;Root, <span style="color: #4f97d7;">Value</span>: <span style="color: #4f97d7;">Comparable</span>&gt;<span style="color: #4f97d7;">(</span>
             _ getter: <span style="color: #4f97d7; font-weight: bold;">@escaping</span> <span style="color: #bc6ec5;">(</span>Root<span style="color: #bc6ec5;">)</span> -&gt; <span style="color: #4f97d7;">Value</span>
         <span style="color: #4f97d7;">)</span>
         -&gt; <span style="color: #4f97d7;">(</span>Root, Root<span style="color: #4f97d7;">)</span> -&gt; <span style="color: #4f97d7;">Bool</span> <span style="color: #4f97d7;">{</span>
             <span style="color: #4f97d7; font-weight: bold;">return</span> <span style="color: #bc6ec5; font-weight: bold;">their</span><span style="color: #bc6ec5;">(</span>getter, &lt;<span style="color: #bc6ec5;">)</span>
         <span style="color: #4f97d7;">}</span>
        
        
         users.<span style="color: #4f97d7;">sorted</span><span style="color: #4f97d7;">(</span>by: <span style="color: #bc6ec5; font-weight: bold;">their</span><span style="color: #bc6ec5;">(</span>\.<span style="color: #7590db;">id</span><span style="color: #bc6ec5;">)</span><span style="color: #4f97d7;">)</span>
</pre>
</div>
</li>
<li>hmmmmm
<div class="org-src-container">

<pre class="src src-swift">         <span style="color: #4f97d7; font-weight: bold;">enum</span> <span style="color: #bc6ec5; font-weight: bold;">AgeTag</span> <span style="color: #4f97d7;">{}</span>
         <span style="color: #4f97d7; font-weight: bold;">typealias</span> Age = Tagged&lt;AgeTag, <span style="color: #4f97d7;">Int</span>&gt;
</pre>
</div>
</li>
<li></li>
</ol>
</div>
</div>
</div>


<div id="outline-container-sec-12" class="outline-2">
<h2 id="sec-12"><span class="section-number-2">12</span> <span class="label label-primary TODO">TODO</span> Dependency Injection made easy</h2>
<div class="outline-text-2" id="text-12">
<p>
Protocol oriented programming for DI is the most common way in swift.
They come with a lot of boilerplate.
Another solution is to use staticly defined environments that you can swap out at test time:
</p>
<div class="org-src-container">

<pre class="src src-swift"><span style="color: #4f97d7; font-weight: bold;">struct</span> <span style="color: #bc6ec5; font-weight: bold;">Environment</span> <span style="color: #4f97d7;">{</span>
  <span style="color: #4f97d7; font-weight: bold;">var</span> analytics = <span style="color: #bc6ec5; font-weight: bold;">Analytics</span><span style="color: #bc6ec5;">()</span>
  <span style="color: #4f97d7; font-weight: bold;">var</span> date: <span style="color: #bc6ec5;">()</span> -&gt; <span style="color: #4f97d7;">Date</span> = <span style="color: #4f97d7;">Date</span>.<span style="color: #4f97d7; font-weight: bold;">init</span>
  <span style="color: #4f97d7; font-weight: bold;">var</span> gitHub = <span style="color: #bc6ec5; font-weight: bold;">GitHub</span><span style="color: #bc6ec5;">()</span>
<span style="color: #4f97d7;">}</span>

<span style="color: #4f97d7; font-weight: bold;">var</span> Current = <span style="color: #bc6ec5; font-weight: bold;">Environment</span><span style="color: #4f97d7;">()</span>
</pre>
</div>

<p>
The test setup then looks somewhat like this:
</p>

<div class="org-src-container">

<pre class="src src-swift">  <span style="color: #2aa1ae; background-color: #292e34;">// </span><span style="color: #2aa1ae; background-color: #292e34;">Define mock dependencies statically</span>
  <span style="color: #4f97d7; font-weight: bold;">extension</span> <span style="color: #bc6ec5; font-weight: bold;">GitHub</span> <span style="color: #4f97d7;">{</span>
    <span style="color: #4f97d7; font-weight: bold;">let</span> <span style="color: #4f97d7; font-weight: bold;">static</span> mock = <span style="color: #bc6ec5; font-weight: bold;">GitHub</span><span style="color: #bc6ec5;">(</span>fetchRepos: <span style="color: #2d9574;">{</span> callback <span style="color: #4f97d7; font-weight: bold;">in</span>
      <span style="color: #bc6ec5; font-weight: bold;">callback</span><span style="color: #67b11d;">(</span>.<span style="color: #4f97d7;">success</span><span style="color: #b1951d;">(</span><span style="color: #4f97d7;">[</span>
        GitHub.<span style="color: #bc6ec5; font-weight: bold;">Repo</span><span style="color: #bc6ec5;">(</span>
          archived: <span style="color: #a45bad;">false</span>,
          description: <span style="color: #2d9574;">"Blob's blog"</span>,
          htmlUrl: <span style="color: #4f97d7;">URL</span><span style="color: #2d9574;">(</span><span style="color: #2d9574;">"https://www.pointfree.co"</span>,
          name: <span style="color: #2d9574;">"Bloblog"</span>,
          pushedAt: <span style="color: #4f97d7;">Date</span><span style="color: #9cb6ad;">(</span>timeIntervalSinceReferenceData: <span style="color: #a45bad;">547152021</span><span style="color: #9cb6ad;">)</span>
        <span style="color: #2d9574;">)</span>
      <span style="color: #e0211d; text-decoration: overline;">])</span>
    <span style="color: #e0211d; text-decoration: overline;">}</span><span style="color: #67b11d;">)</span>
  <span style="color: #2d9574;">}</span>
  
  <span style="color: #4f97d7; font-weight: bold;">extension</span> <span style="color: #bc6ec5; font-weight: bold;">Environment</span> <span style="color: #2d9574;">{</span>
      <span style="color: #4f97d7; font-weight: bold;">static</span> <span style="color: #4f97d7; font-weight: bold;">let</span> mock = <span style="color: #bc6ec5; font-weight: bold;">Environment</span><span style="color: #67b11d;">(</span>
        analytics: .<span style="color: #7590db;">mock</span>,
        date: <span style="color: #b1951d;">{</span> <span style="color: #4f97d7;">Date</span><span style="color: #4f97d7;">(</span>timeIntervalSinceReferenceDate: <span style="color: #a45bad;">557152051</span><span style="color: #4f97d7;">)</span> <span style="color: #b1951d;">}</span>,
        gitHub: .<span style="color: #7590db;">mock</span>
      <span style="color: #67b11d;">)</span>
  <span style="color: #2d9574;">}</span>
Current = .<span style="color: #7590db;">mock</span>
<span style="color: #2aa1ae; background-color: #292e34;">// </span><span style="color: #2aa1ae; background-color: #292e34;">Do tests</span>
</pre>
</div>
<p>
Unfortunately no example of some clean test suite is provided.
Downsides: it will keep you from parallelizing tests,
and won't force you to overwrite dependencies with mocks during tests.
</p>
</div>
<div id="outline-container-sec-12-1" class="outline-3">
<h3 id="sec-12-1"><span class="section-number-3">12.1</span> <span class="label label-primary TODO">TODO</span> Exercises</h3>
</div>
</div>


<div id="outline-container-sec-13" class="outline-2">
<h2 id="sec-13"><span class="section-number-2">13</span> Dependency Injection Made Comfortable</h2>
<div class="outline-text-2" id="text-13">
<p>
Nothing much new other than how to easily build mock structures with overture
</p>
<div class="org-src-container">

<pre class="src src-swift">  <span style="color: #4f97d7; font-weight: bold;">extension</span> <span style="color: #4f97d7;">Array</span> <span style="color: #4f97d7; font-weight: bold;">where</span> <span style="color: #4f97d7;">Element</span> == GitHub.<span style="color: #7590db;">Repo</span> <span style="color: #4f97d7;">{</span>
    <span style="color: #4f97d7; font-weight: bold;">static</span> <span style="color: #4f97d7; font-weight: bold;">let</span> mock = <span style="color: #bc6ec5;">[</span>
      GitHub.<span style="color: #7590db;">Repo</span>.<span style="color: #7590db;">mock</span>,
      <span style="color: #bc6ec5; font-weight: bold;">with</span><span style="color: #2d9574;">(</span>.<span style="color: #7590db;">mock</span>, <span style="color: #bc6ec5; font-weight: bold;">concat</span><span style="color: #67b11d;">(</span>
        <span style="color: #4f97d7; font-weight: bold;">set</span><span style="color: #b1951d;">(</span>\.<span style="color: #4f97d7;">name</span>, <span style="color: #2d9574;">"Nomadic Blob"</span><span style="color: #b1951d;">)</span>,
        <span style="color: #4f97d7; font-weight: bold;">set</span><span style="color: #b1951d;">(</span>\.<span style="color: #4f97d7;">description</span>, <span style="color: #2d9574;">"Where in the world is Blob?"</span><span style="color: #b1951d;">)</span>,
        <span style="color: #4f97d7; font-weight: bold;">set</span><span style="color: #b1951d;">(</span>\GitHub.<span style="color: #7590db;">Repo</span>.<span style="color: #7590db;">pushedAt</span>, .<span style="color: #7590db;">mock</span> - <span style="color: #a45bad;">60</span>*<span style="color: #a45bad;">60</span>*<span style="color: #a45bad;">24</span>*<span style="color: #a45bad;">2</span><span style="color: #b1951d;">)</span>
      <span style="color: #67b11d;">)</span><span style="color: #2d9574;">)</span>
    <span style="color: #bc6ec5;">]</span>
    <span style="color: #4f97d7; font-weight: bold;">static</span> <span style="color: #4f97d7; font-weight: bold;">func</span> <span style="color: #bc6ec5; font-weight: bold;">mocks</span><span style="color: #bc6ec5;">(</span>_ count: <span style="color: #4f97d7;">Int</span><span style="color: #bc6ec5;">)</span> -&gt; <span style="color: #4f97d7;">Array</span> <span style="color: #bc6ec5;">{</span>
    <span style="color: #4f97d7; font-weight: bold;">return</span> <span style="color: #2d9574;">(</span><span style="color: #a45bad;">1</span>...<span style="color: #4f97d7;">count</span><span style="color: #2d9574;">)</span>.<span style="color: #4f97d7;">map</span> <span style="color: #2d9574;">{</span> n <span style="color: #4f97d7; font-weight: bold;">in</span>
      <span style="color: #bc6ec5; font-weight: bold;">with</span><span style="color: #67b11d;">(</span>.<span style="color: #7590db;">mock</span>, <span style="color: #bc6ec5; font-weight: bold;">concat</span><span style="color: #b1951d;">(</span>
        <span style="color: #bc6ec5; font-weight: bold;">over</span><span style="color: #4f97d7;">(</span>\.<span style="color: #4f97d7;">name</span><span style="color: #4f97d7;">)</span> <span style="color: #4f97d7;">{</span> <span style="color: #2d9574;">"#\(</span>n<span style="color: #2d9574;">): \(</span>$0<span style="color: #2d9574;">)"</span> <span style="color: #4f97d7;">}</span>,
        <span style="color: #4f97d7; font-weight: bold;">set</span><span style="color: #4f97d7;">(</span>\GitHub.<span style="color: #7590db;">Repo</span>.<span style="color: #7590db;">pushedAt</span>, .<span style="color: #7590db;">mock</span> - <span style="color: #a45bad;">60</span>*<span style="color: #a45bad;">60</span>*<span style="color: #a45bad;">24</span>*<span style="color: #4f97d7;">TimeInterval</span><span style="color: #bc6ec5;">(</span>n<span style="color: #bc6ec5;">)</span><span style="color: #4f97d7;">)</span>
      <span style="color: #b1951d;">)</span><span style="color: #67b11d;">)</span>
    <span style="color: #2d9574;">}</span>
  <span style="color: #bc6ec5;">}</span>
  <span style="color: #4f97d7;">}</span>
</pre>
</div>
</div>
<div id="outline-container-sec-13-1" class="outline-3">
<h3 id="sec-13-1"><span class="section-number-3">13.1</span> Exercises</h3>
<div class="outline-text-3" id="text-13-1">
<p>
No exercises
</p>
</div>
</div>
</div>


<div id="outline-container-sec-14" class="outline-2">
<h2 id="sec-14"><span class="section-number-2">14</span> Playground Driven Development</h2>
<div class="outline-text-2" id="text-14">
<p>
When developing in UIKit, you can build something similar to previews with playgrounds.
This requires you to modularize your app, or put the whole app in one framework/package.
</p>

<div class="org-src-container">

<pre class="src src-swift"><span style="color: #4f97d7; font-weight: bold;">import</span> PointFreeFramework
<span style="color: #4f97d7; font-weight: bold;">import</span> PlaygroundSupport

<span style="color: #4f97d7; font-weight: bold;">let</span> vc = <span style="color: #bc6ec5; font-weight: bold;">EpisodeListViewController</span><span style="color: #4f97d7;">()</span>
PlaygroundPage.<span style="color: #4f97d7;">current</span>.<span style="color: #7590db;">liveView</span> = vc
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-15" class="outline-2">
<h2 id="sec-15"><span class="section-number-2">15</span> Dependency Injection Made Composable</h2>
</div>



<div id="outline-container-sec-16" class="outline-2">
<h2 id="sec-16"><span class="section-number-2">16</span> A Tour of the Composable Architecture: Part 1</h2>
<div class="outline-text-2" id="text-16">
<ul class="org-ul">
<li>Cohesive package to solve some problems that Swift UI has
</li>
<li>Opinionated
</li>
<li>Focus on modularization and composability
</li>
<li>Very restrictive regarding side effects.
</li>
<li>Assertion helper to test the composable architecture, that forces you to deal with all effects
</li>
<li>Debugging capabilities (.debug to print all actions)
</li>
<li>Range of example projects
</li>
</ul>

<p>
<i>Why view store?</i>
</p>
<ul class="org-ul">
<li>Hide state of sub-views so that the current view is only re-rendered when it's own state changes
</li>
<li>More flexibility binding different front-ends to the state (platform-specific)
</li>
</ul>

<p>
Equatable for duplicate filtering
Bindings
For a list of states, there is a lot of index juggling in bare-metal CA
</p>
</div>
</div>
<div id="outline-container-sec-17" class="outline-2">
<h2 id="sec-17"><span class="section-number-2">17</span> A Tour of the Composable Architecture: Part 2</h2>
<div class="outline-text-2" id="text-17">
<p>
We can get rid of index juggling with <code>ForEachStore</code>
On the reducer side we need to call forEach that supplies
</p>
<ul class="org-ul">
<li>Writable key path to a random access collection of subview-states
</li>
<li>Case path of an action that embeds an index and action into a subview-action
(could write this yourself with <code>embed</code> and <code>extract</code>, but CasePaths supplies the backslash for this)
</li>
<li>Function to create the environment. Or key path
</li>
</ul>

<p>
Strong type level guarantees
</p>

<p>
ForEachStore can be used with stores that only knows about the collection, and the indexed actions.
This is done with <code>scope</code>, that extracts the list out of the state, and embeds an index action into the global actions.
(<i>Extract global state into local, and embed local state into global</i>)
</p>

<p>
Then extracting the subviews into their seperate views, the code becomes very short:
</p>
<div class="org-src-container">

<pre class="src src-swift">    <span style="color: #bc6ec5; font-weight: bold;">ForEachStore</span><span style="color: #4f97d7;">(</span>
                  <span style="color: #4f97d7; font-weight: bold;">self</span>.<span style="color: #7590db;">store</span>.<span style="color: #bc6ec5; font-weight: bold;">scope</span><span style="color: #bc6ec5;">(</span>
                      state: \.<span style="color: #7590db;">tiles</span>,
                      action: MyActions.<span style="color: #7590db;">tileAction</span><span style="color: #bc6ec5;">)</span>,
                  content: TileView.<span style="color: #4f97d7; font-weight: bold;">init</span><span style="color: #4f97d7;">)</span>
</pre>
</div>
<p>
<code>combine</code> multiple stores, if the global store also needs to handle some logic, that is unrelated to the list of subviews.
</p>
</div>
</div>
<div id="outline-container-sec-18" class="outline-2">
<h2 id="sec-18"><span class="section-number-2">18</span> A Tour of the Composable Architecture: Part 3</h2>
<div class="outline-text-2" id="text-18">
<p>
Exhaustive tests with <code>TestStore</code>.
<span class="underline">Basic workflow:</span>
</p>
<ol class="org-ol">
<li>Create a TestStore
<div class="org-src-container">

<pre class="src src-swift">       <span style="color: #4f97d7; font-weight: bold;">let</span> store = <span style="color: #bc6ec5; font-weight: bold;">TestStore</span><span style="color: #4f97d7;">(</span>
         initialState: <span style="color: #bc6ec5; font-weight: bold;">AppState</span><span style="color: #bc6ec5;">(</span>
           todos: <span style="color: #2d9574;">[</span>
             <span style="color: #bc6ec5; font-weight: bold;">Todo</span><span style="color: #67b11d;">(</span>
               description: <span style="color: #2d9574;">"Milk"</span>,
               id: <span style="color: #4f97d7;">UUID</span><span style="color: #b1951d;">(</span>uuidString: <span style="color: #2d9574;">"00000000-0000-0000-0000-000000000000"</span><span style="color: #b1951d;">)</span>!,
               isComplete: <span style="color: #a45bad;">false</span>
             <span style="color: #67b11d;">)</span>
           <span style="color: #2d9574;">]</span>
         <span style="color: #bc6ec5;">)</span>,
         reducer: appReducer,
         environment: <span style="color: #bc6ec5; font-weight: bold;">AppEnvironment</span><span style="color: #bc6ec5;">()</span>
       <span style="color: #4f97d7;">)</span>
</pre>
</div>
</li>
<li>Create exhaustive assertions (effects that are not tested will throw an error)
<div class="org-src-container">

<pre class="src src-swift">       store.<span style="color: #4f97d7;">assert</span><span style="color: #4f97d7;">(</span>
       .<span style="color: #4f97d7;">send</span><span style="color: #bc6ec5;">(</span>.<span style="color: #bc6ec5; font-weight: bold;">todo</span><span style="color: #2d9574;">(</span>index: <span style="color: #a45bad;">0</span>, action: .<span style="color: #7590db;">checkboxTapped</span><span style="color: #2d9574;">)</span><span style="color: #bc6ec5;">)</span> <span style="color: #bc6ec5;">{</span>
         $0.<span style="color: #7590db;">todos</span> = <span style="color: #2d9574;">[</span>
           <span style="color: #bc6ec5; font-weight: bold;">Todo</span><span style="color: #67b11d;">(</span>
             description: <span style="color: #2d9574;">"Eggs"</span>,
             id: <span style="color: #4f97d7;">UUID</span><span style="color: #b1951d;">(</span>uuidString: <span style="color: #2d9574;">"00000000-0000-0000-0000-000000000001"</span><span style="color: #b1951d;">)</span>!,
             isComplete: <span style="color: #a45bad;">false</span>
           <span style="color: #67b11d;">)</span>,
           <span style="color: #bc6ec5; font-weight: bold;">Todo</span><span style="color: #67b11d;">(</span>
             description: <span style="color: #2d9574;">"Milk"</span>,
             id: <span style="color: #4f97d7;">UUID</span><span style="color: #b1951d;">(</span>uuidString: <span style="color: #2d9574;">"00000000-0000-0000-0000-000000000000"</span><span style="color: #b1951d;">)</span>!,
             isComplete: <span style="color: #a45bad;">true</span>
           <span style="color: #67b11d;">)</span>
         <span style="color: #2d9574;">]</span>
       <span style="color: #bc6ec5;">}</span>
       <span style="color: #4f97d7;">)</span>
</pre>
</div>
</li>
</ol>
<p>
Some more wisdom:
</p>
<ul class="org-ul">
<li>Inject dependencies via environment
</li>
<li>Be explicit in the assertions
</li>
<li>use an inline struct to define your cancellable id's:
<div class="org-src-container">

<pre class="src src-swift">      <span style="color: #4f97d7; font-weight: bold;">case</span> .<span style="color: #bc6ec5; font-weight: bold;">todo</span><span style="color: #4f97d7;">(</span>index: _, action: .<span style="color: #7590db;">checkboxTapped</span><span style="color: #4f97d7;">)</span>:
      <span style="color: #4f97d7; font-weight: bold;">struct</span> <span style="color: #bc6ec5; font-weight: bold;">CancelDelayId</span>: <span style="color: #4f97d7;">Hashable</span> <span style="color: #4f97d7;">{}</span>
      
      <span style="color: #4f97d7; font-weight: bold;">return</span> <span style="color: #bc6ec5; font-weight: bold;">Effect</span><span style="color: #4f97d7;">(</span>value: .<span style="color: #7590db;">todoDelayCompleted</span><span style="color: #4f97d7;">)</span>
        .<span style="color: #4f97d7;">delay</span><span style="color: #4f97d7;">(</span><span style="color: #4f97d7; font-weight: bold;">for</span>: <span style="color: #a45bad;">1</span>, scheduler: environment.<span style="color: #7590db;">mainQueue</span><span style="color: #4f97d7;">)</span>
        .<span style="color: #bc6ec5; font-weight: bold;">eraseToEffect</span><span style="color: #4f97d7;">()</span>
        .<span style="color: #bc6ec5; font-weight: bold;">cancellable</span><span style="color: #4f97d7;">(</span>id: <span style="color: #bc6ec5; font-weight: bold;">CancelDelayId</span><span style="color: #bc6ec5;">()</span>, cancelInFlight: <span style="color: #a45bad;">true</span><span style="color: #4f97d7;">)</span>
</pre>
</div>
</li>
</ul>
</div>
</div>
<div id="outline-container-sec-19" class="outline-2">
<h2 id="sec-19"><span class="section-number-2">19</span> A Tour of the Composable Architecture: Part 4</h2>
<div class="outline-text-2" id="text-19">
<p>
How to test async effects?
Test helper will complain if some effects are still running.
</p>
<ul class="org-ul">
<li>don't use <code>XCTWaiter</code> and the like
</li>
<li>Inject DispatchQueue using <code>AnySchedulerOf&lt;DispatchQueue&gt;</code> and use <code>TestScheduler</code> in the tests.
You can then just <code>advance</code> your scheduler and don't have to wait.
</li>
</ul>
</div>
</div>


<div id="outline-container-sec-20" class="outline-2">
<h2 id="sec-20"><span class="section-number-2">20</span> Designing Dependenciecs: The problem</h2>
<div class="outline-text-2" id="text-20">
<p>
This episode introduces the already common approach of abstracting away dependencies
via a protocol. It then builds the case for scrapping the protocol.
(No exercises)
</p>
</div>
</div>
<div id="outline-container-sec-21" class="outline-2">
<h2 id="sec-21"><span class="section-number-2">21</span> Designing Dependencies: Modularization</h2>
<div class="outline-text-2" id="text-21">
<p>
Dependencies can now easily split into modules, and we can even seperate implementation and interface if needed.
(No exercises)
</p>
</div>
</div>
<div id="outline-container-sec-22" class="outline-2">
<h2 id="sec-22"><span class="section-number-2">22</span> Designing Dependencies: Reachability</h2>
<div class="outline-text-2" id="text-22">
<p>
Discusses how to modularise and style a wrapper library around a system API (<code>NWPathMonitor</code>).
(No exercises)
</p>
</div>
</div>
<div id="outline-container-sec-23" class="outline-2">
<h2 id="sec-23"><span class="section-number-2">23</span> Designing Dependencies: Core Location</h2>
<div class="outline-text-2" id="text-23">
<p>
Interesting showcase with a more complicated dependency including delegates and <code>NSObject</code> inheritance.
Keeping a reference to the delegate after the initializer function exits is done via <code>receiveEvents</code>
</p>

<div class="org-src-container">

<pre class="src src-swift"><span style="color: #4f97d7; font-weight: bold;">var</span> delegate: Delegate? = <span style="color: #bc6ec5; font-weight: bold;">Delegate</span><span style="color: #4f97d7;">(</span>subject: subject<span style="color: #4f97d7;">)</span>
locationManager.<span style="color: #4f97d7;">delegate</span> = delegate
<span style="color: #4f97d7; font-weight: bold;">return</span> <span style="color: #4f97d7; font-weight: bold;">Self</span><span style="color: #4f97d7;">(</span>
  delegate: delegate
    .<span style="color: #4f97d7;">handleEvents</span><span style="color: #bc6ec5;">(</span>receiveCancel: <span style="color: #2d9574;">{</span> delegate = <span style="color: #a45bad;">nil</span> <span style="color: #2d9574;">}</span>
    .<span style="color: #4f97d7;">eraseToAnyPublisher</span><span style="color: #2d9574;">()</span>
  ...
<span style="color: #bc6ec5;">)</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-sec-24" class="outline-2">
<h2 id="sec-24"><span class="section-number-2">24</span> Designing Dependencies: The point</h2>
<div class="outline-text-2" id="text-24">
<p>
This episode demonstrates how freely you can now play with your dependencies.
With this approach you can
</p>
<ul class="org-ul">
<li>write tests with strong guarantees, e.g. that certain
</li>
</ul>
<p>
API's are not called.
</p>
<ul class="org-ul">
<li>Create transformations/setters on dependencies
</li>
<li>Create decorations on dependencies, such as "every effect is delayed by 1 second"
</li>
<li>Create a mix of dependencies, such as a live core location client that
only has the final location result hardcoded
</li>
<li>Write a debug screen that arbitrarily taps into your environment
</li>
</ul>
</div>
</div>

<div id="outline-container-sec-25" class="outline-2">
<h2 id="sec-25"><span class="section-number-2">25</span> Redacted SwiftUI: The problem</h2>
<div class="outline-text-2" id="text-25">
<p>
The problem is that it's hard to seperate concerns in vanilla swiftui.
When you redact a view you don't want any interaction to happen,
hence you basically want to swap out your business logic with no-ops.
In a traditional swiftui setup, you'd have to sprinkle your code all over with early exits to achieve that.
</p>
</div>
</div>
<div id="outline-container-sec-26" class="outline-2">
<h2 id="sec-26"><span class="section-number-2">26</span> Redacted SwiftUI: The Composable Architecture</h2>
<div class="outline-text-2" id="text-26">
<p>
The idea is simple: In CA, Just swap in a Store that has some placeholder data, no reducer and no environment while loading.
You can use the <code>.empty</code> extension of Reducer for a reducer that doesn't care about any actions.
And a <code>void</code> env because that's not gonna be used anyway.
</p>
</div>
</div>
<div id="outline-container-sec-27" class="outline-2">
<h2 id="sec-27"><span class="section-number-2">27</span> The Point of Redacted SwiftUI: Part 1</h2>
<div class="outline-text-2" id="text-27">
<ul class="org-ul">
<li>If you have a subview that you <code>unredact</code> within your bigger view,
</li>
</ul>
<p>
you can selectively add back some logic into your empty reducer
</p>
<ul class="org-ul">
<li>You cann call out to another reducer like this
</li>
</ul>
<div class="org-src-container">

<pre class="src src-swift">appReducer.<span style="color: #4f97d7;">run</span><span style="color: #4f97d7;">(</span>&amp;state, &amp;action, &amp;environment<span style="color: #4f97d7;">)</span>
</pre>
</div>
</div>
<div id="outline-container-sec-27-1" class="outline-3">
<h3 id="sec-27-1"><span class="section-number-3">27.1</span> Exercises</h3>
<div class="outline-text-3" id="text-27-1">
<ol class="org-ol">
<li>My solution:
</li>
</ol>
<div class="org-src-container">

<pre class="src src-swift">    <span style="color: #4f97d7; font-weight: bold;">func</span> <span style="color: #bc6ec5; font-weight: bold;">applying</span>&lt;T: View, I: View&gt;<span style="color: #4f97d7;">(</span>view: I, <span style="color: #4f97d7; font-weight: bold;">@ViewBuilder</span> block: <span style="color: #bc6ec5;">(</span>I<span style="color: #bc6ec5;">)</span> -&gt; T<span style="color: #4f97d7;">)</span> -&gt; T <span style="color: #4f97d7;">{</span>
        <span style="color: #bc6ec5; font-weight: bold;">block</span><span style="color: #bc6ec5;">(</span>view<span style="color: #bc6ec5;">)</span>
    <span style="color: #4f97d7;">}</span>
</pre>
</div>
<p>
The reference solution uses an extension:
</p>
<div class="org-src-container">

<pre class="src src-swift"><span style="color: #4f97d7; font-weight: bold;">extension</span> <span style="color: #bc6ec5; font-weight: bold;">View</span> <span style="color: #4f97d7;">{</span>
  <span style="color: #4f97d7; font-weight: bold;">func</span> <span style="color: #bc6ec5; font-weight: bold;">applying</span>&lt;V: View&gt;<span style="color: #bc6ec5;">(</span>
    <span style="color: #4f97d7; font-weight: bold;">@ViewBuilder</span> _ builder: <span style="color: #4f97d7; font-weight: bold;">@escaping</span> <span style="color: #2d9574;">(</span><span style="color: #4f97d7; font-weight: bold;">Self</span><span style="color: #2d9574;">)</span> -&gt; V
  <span style="color: #bc6ec5;">)</span> -&gt; <span style="color: #4f97d7; font-weight: bold;">some</span> View <span style="color: #bc6ec5;">{</span>
    <span style="color: #bc6ec5; font-weight: bold;">builder</span><span style="color: #2d9574;">(</span><span style="color: #4f97d7; font-weight: bold;">self</span><span style="color: #2d9574;">)</span>
  <span style="color: #bc6ec5;">}</span>
<span style="color: #4f97d7;">}</span>
</pre>
</div>
<p>
2, 3 &amp; 4:
For this we need to migrate the onboarding view to the composable architecture as well.
we can then react on actions happening in the "subview" (the app):
</p>
<div class="org-src-container">

<pre class="src src-swift">     <span style="color: #4f97d7; font-weight: bold;">case</span> .<span style="color: #bc6ec5; font-weight: bold;">placeholderAction</span><span style="color: #4f97d7;">(</span>.<span style="color: #bc6ec5; font-weight: bold;">todo</span><span style="color: #bc6ec5;">(</span><span style="color: #4f97d7; font-weight: bold;">let</span> id, action: .<span style="color: #7590db;">checkBoxToggled</span><span style="color: #bc6ec5;">)</span><span style="color: #4f97d7;">)</span>:
         <span style="color: #4f97d7; font-weight: bold;">guard</span> state.<span style="color: #7590db;">step</span> == .<span style="color: #7590db;">todos</span> <span style="color: #4f97d7; font-weight: bold;">else</span> <span style="color: #4f97d7;">{</span> <span style="color: #4f97d7; font-weight: bold;">return</span> .<span style="color: #4f97d7; font-weight: bold;">none</span> <span style="color: #4f97d7;">}</span>
         state.<span style="color: #7590db;">placeholderState</span>.<span style="color: #7590db;">todos</span><span style="color: #4f97d7;">[</span>id: id<span style="color: #4f97d7;">]</span>?.<span style="color: #7590db;">isComplete</span>.<span style="color: #4f97d7;">toggle</span><span style="color: #4f97d7;">()</span>
         <span style="color: #4f97d7; font-weight: bold;">return</span> .<span style="color: #4f97d7; font-weight: bold;">none</span>
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-sec-28" class="outline-2">
<h2 id="sec-28"><span class="section-number-2">28</span> The Point of Redacted SwiftUI: Part 2</h2>
<div class="outline-text-2" id="text-28">
<p>
This shows the reference solutions of part 1: You can do it more elegant with <code>case let where</code>, and run the original app reducer:
</p>
<div class="org-src-container">

<pre class="src src-swift"><span style="color: #4f97d7; font-weight: bold;">case</span> <span style="color: #4f97d7; font-weight: bold;">let</span> .<span style="color: #bc6ec5; font-weight: bold;">placeholderAction</span><span style="color: #4f97d7;">(</span>action<span style="color: #4f97d7;">)</span> <span style="color: #4f97d7; font-weight: bold;">where</span> state.<span style="color: #7590db;">step</span> == .<span style="color: #7590db;">todos</span>:
    <span style="color: #4f97d7; font-weight: bold;">switch</span> action <span style="color: #4f97d7;">{</span>
    <span style="color: #4f97d7; font-weight: bold;">case</span> .<span style="color: #bc6ec5; font-weight: bold;">todo</span><span style="color: #bc6ec5;">(</span>id: _, action: .<span style="color: #7590db;">checkBoxToggled</span><span style="color: #bc6ec5;">)</span>,
         .<span style="color: #7590db;">sortCompletedTodos</span>:
        <span style="color: #4f97d7; font-weight: bold;">return</span> appReducer
          .<span style="color: #4f97d7;">run</span><span style="color: #bc6ec5;">(</span>&amp;state.<span style="color: #7590db;">placeholderState</span>, action, environment<span style="color: #bc6ec5;">)</span>
          .<span style="color: #4f97d7;">map</span><span style="color: #bc6ec5;">(</span>OnboardingAction.<span style="color: #7590db;">placeholderAction</span><span style="color: #bc6ec5;">)</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-29" class="outline-2">
<h2 id="sec-29"><span class="section-number-2">29</span> Concise Forms: SwiftUI</h2>
<div class="outline-text-2" id="text-29">
<ul class="org-ul">
<li>SwiftUI <code>Form</code> arrangement is a great way to build simple forms
</li>
<li>Split sections with <code>Section</code>
</li>
<li>State handling and side effects quickly become messy with vanilla SwiftUI
(guess who saves the day, the composable architecture of course)
</li>
</ul>
</div>
</div>
<div id="outline-container-sec-30" class="outline-2">
<h2 id="sec-30"><span class="section-number-2">30</span> Concise Forms: Composable Architecture</h2>
<div class="outline-text-2" id="text-30">
<p>
This episode mainly showcases basic TCA stuff, and how it makes state mutations in forms more readable and testable,
albeit being a bit more verbose.
</p>
</div>
<div id="outline-container-sec-30-1" class="outline-3">
<h3 id="sec-30-1"><span class="section-number-3">30.1</span> Exercises</h3>
<div class="outline-text-3" id="text-30-1">
<ol class="org-ol">
<li>Simple test, just a state change. We can also make sure to error in any dependencies now unused (registerPush for example).
</li>
</ol>
<div class="org-src-container">

<pre class="src src-swift">store.<span style="color: #4f97d7;">assert</span><span style="color: #4f97d7;">(</span>
            .<span style="color: #4f97d7;">send</span><span style="color: #bc6ec5;">(</span>.<span style="color: #bc6ec5; font-weight: bold;">notificationSettingsResponse</span><span style="color: #2d9574;">(</span>UserNotificationsClient.<span style="color: #7590db;">Settings</span>.<span style="color: #4f97d7; font-weight: bold;">init</span><span style="color: #67b11d;">(</span>authorizationStatus: .<span style="color: #7590db;">denied</span><span style="color: #67b11d;">)</span><span style="color: #2d9574;">)</span><span style="color: #bc6ec5;">)</span> <span style="color: #bc6ec5;">{</span>
                $0.<span style="color: #7590db;">sendNotifications</span> = <span style="color: #a45bad;">false</span>
                $0.<span style="color: #7590db;">alert</span> = .<span style="color: #4f97d7; font-weight: bold;">init</span><span style="color: #2d9574;">(</span>title: <span style="color: #2d9574;">"You need to enable permissions from iOS settings"</span><span style="color: #2d9574;">)</span>
            <span style="color: #bc6ec5;">}</span>
        <span style="color: #4f97d7;">)</span>
</pre>
</div>
<p>
(The reference solution tested a different user flow rather than the individual <code>Action</code> of a denied response).
</p>
<ol class="org-ol">
<li></li>
</ol>
<div class="org-src-container">

<pre class="src src-swift">store.<span style="color: #4f97d7;">assert</span><span style="color: #4f97d7;">(</span>
            .<span style="color: #4f97d7;">send</span><span style="color: #bc6ec5;">(</span>.<span style="color: #bc6ec5; font-weight: bold;">sendNotificationsChanged</span><span style="color: #2d9574;">(</span><span style="color: #a45bad;">true</span><span style="color: #2d9574;">)</span><span style="color: #bc6ec5;">)</span>,
            .<span style="color: #4f97d7;">receive</span><span style="color: #bc6ec5;">(</span>.<span style="color: #bc6ec5; font-weight: bold;">notificationSettingsResponse</span><span style="color: #2d9574;">(</span>.<span style="color: #4f97d7; font-weight: bold;">init</span><span style="color: #67b11d;">(</span>authorizationStatus: .<span style="color: #7590db;">denied</span><span style="color: #67b11d;">)</span><span style="color: #2d9574;">)</span><span style="color: #bc6ec5;">)</span> <span style="color: #bc6ec5;">{</span>
                $0.<span style="color: #7590db;">sendNotifications</span> = <span style="color: #a45bad;">false</span>
                $0.<span style="color: #7590db;">alert</span> = .<span style="color: #4f97d7; font-weight: bold;">init</span><span style="color: #2d9574;">(</span>title: <span style="color: #2d9574;">"You need to enable permissions from iOS settings"</span><span style="color: #2d9574;">)</span>
            <span style="color: #bc6ec5;">}</span>
        <span style="color: #4f97d7;">)</span>
</pre>
</div>
<p>
Reference tests dismissing the alert as well.
</p>
</div>
</div>
</div>
<div id="outline-container-sec-31" class="outline-2">
<h2 id="sec-31"><span class="section-number-2">31</span> Concise Forms: Bye Bye Boilerplate</h2>
<div class="outline-text-2" id="text-31">
<p>
Forms can be incredibly simpler than the "naive" TCA approach.
</p>
<ol class="org-ol">
<li>Wrap form actions (getters and setters of key paths) in a generic struct
</li>
</ol>
<div class="org-src-container">

<pre class="src src-swift"><span style="color: #4f97d7; font-weight: bold;">struct</span> <span style="color: #bc6ec5; font-weight: bold;">FormAction</span>&lt;Root&gt;: <span style="color: #4f97d7;">Equatable</span> <span style="color: #4f97d7;">{</span>
  <span style="color: #4f97d7; font-weight: bold;">let</span> keyPath: <span style="color: #4f97d7;">PartialKeyPath</span>&lt;Root&gt;
  <span style="color: #4f97d7; font-weight: bold;">let</span> value: AnyEquatable
  <span style="color: #4f97d7; font-weight: bold;">let</span> setter: <span style="color: #bc6ec5;">(</span><span style="color: #4f97d7; font-weight: bold;">inout</span> Root<span style="color: #bc6ec5;">)</span> -&gt; <span style="color: #4f97d7;">Void</span>

  <span style="color: #4f97d7; font-weight: bold;">init</span>&lt;<span style="color: #4f97d7;">Value</span>&gt;<span style="color: #bc6ec5;">(</span>
    _ keyPath: <span style="color: #4f97d7;">WritableKeyPath</span>&lt;Root, <span style="color: #4f97d7;">Value</span>&gt;,
    _ value: <span style="color: #4f97d7;">Value</span>
  <span style="color: #bc6ec5;">)</span> <span style="color: #4f97d7; font-weight: bold;">where</span> <span style="color: #4f97d7;">Value</span>: <span style="color: #4f97d7;">Equatable</span> <span style="color: #bc6ec5;">{</span>
    <span style="color: #4f97d7; font-weight: bold;">self</span>.<span style="color: #4f97d7;">keyPath</span> = keyPath
    <span style="color: #4f97d7; font-weight: bold;">self</span>.<span style="color: #4f97d7;">value</span> = <span style="color: #bc6ec5; font-weight: bold;">AnyEquatable</span><span style="color: #2d9574;">(</span>value<span style="color: #2d9574;">)</span>
    <span style="color: #4f97d7; font-weight: bold;">self</span>.<span style="color: #7590db;">setter</span> = <span style="color: #2d9574;">{</span> $0<span style="color: #67b11d;">[</span>keyPath: keyPath<span style="color: #67b11d;">]</span> = value <span style="color: #2d9574;">}</span>
  <span style="color: #bc6ec5;">}</span>

  <span style="color: #2aa1ae; background-color: #292e34;">// </span><span style="color: #2aa1ae; background-color: #292e34;">Note this is just an alias for init, for better readability</span>
  <span style="color: #4f97d7; font-weight: bold;">static</span> <span style="color: #4f97d7; font-weight: bold;">func</span> <span style="color: #4f97d7; font-weight: bold;">set</span>&lt;<span style="color: #4f97d7;">Value</span>&gt;<span style="color: #bc6ec5;">(</span>
    _ keyPath: <span style="color: #4f97d7;">WritableKeyPath</span>&lt;Root, <span style="color: #4f97d7;">Value</span>&gt;,
    _ value: <span style="color: #4f97d7;">Value</span>
  <span style="color: #bc6ec5;">)</span> -&gt; <span style="color: #4f97d7; font-weight: bold;">Self</span> <span style="color: #4f97d7; font-weight: bold;">where</span> <span style="color: #4f97d7;">Value</span>: <span style="color: #4f97d7;">Equatable</span> <span style="color: #bc6ec5;">{</span>
    <span style="color: #4f97d7; font-weight: bold;">self</span>.<span style="color: #4f97d7; font-weight: bold;">init</span><span style="color: #2d9574;">(</span>keyPath, value<span style="color: #2d9574;">)</span>
  <span style="color: #bc6ec5;">}</span>

  <span style="color: #4f97d7; font-weight: bold;">static</span> <span style="color: #4f97d7; font-weight: bold;">func</span> == <span style="color: #bc6ec5;">(</span>lhs: FormAction&lt;Root&gt;, rhs: FormAction&lt;Root&gt;<span style="color: #bc6ec5;">)</span> -&gt; <span style="color: #4f97d7;">Bool</span> <span style="color: #bc6ec5;">{</span>
    lhs.<span style="color: #4f97d7;">keyPath</span> == rhs.<span style="color: #4f97d7;">keyPath</span> &amp;&amp; lhs.<span style="color: #4f97d7;">value</span> == rhs.<span style="color: #4f97d7;">value</span>
  <span style="color: #bc6ec5;">}</span>
<span style="color: #4f97d7;">}</span>
</pre>
</div>
<ol class="org-ol">
<li>Use a single action for all state changes by form interactions:
</li>
</ol>
<div class="org-src-container">

<pre class="src src-swift"><span style="color: #4f97d7; font-weight: bold;">case</span> <span style="color: #bc6ec5; font-weight: bold;">form</span><span style="color: #4f97d7;">(</span>FormAction&lt;SettingsState&gt;<span style="color: #4f97d7;">)</span>
</pre>
</div>
<ol class="org-ol">
<li>use viewStore.binding with key store to hook the action into the form
(⚠ This method seems deprecated, more info in Safer, Conciser Forms: Part 1&amp;2)
</li>
</ol>
<div class="org-src-container">

<pre class="src src-swift"><span style="color: #4f97d7; font-weight: bold;">extension</span> <span style="color: #bc6ec5; font-weight: bold;">ViewStore</span> <span style="color: #4f97d7;">{</span>
  <span style="color: #4f97d7; font-weight: bold;">func</span> <span style="color: #bc6ec5; font-weight: bold;">binding</span>&lt;<span style="color: #4f97d7;">Value</span>&gt;<span style="color: #bc6ec5;">(</span>
    keyPath: <span style="color: #4f97d7;">WritableKeyPath</span>&lt;<span style="color: #4f97d7;">State</span>, <span style="color: #4f97d7;">Value</span>&gt;,
    send action: <span style="color: #4f97d7; font-weight: bold;">@escaping</span> <span style="color: #2d9574;">(</span>FormAction&lt;<span style="color: #4f97d7;">State</span>&gt;<span style="color: #2d9574;">)</span> -&gt; Action
  <span style="color: #bc6ec5;">)</span> -&gt; Binding&lt;<span style="color: #4f97d7;">Value</span>&gt; <span style="color: #4f97d7; font-weight: bold;">where</span> <span style="color: #4f97d7;">Value</span>: <span style="color: #4f97d7;">Hashable</span> <span style="color: #bc6ec5;">{</span>
    <span style="color: #4f97d7; font-weight: bold;">self</span>.<span style="color: #bc6ec5; font-weight: bold;">binding</span><span style="color: #2d9574;">(</span>
      <span style="color: #4f97d7; font-weight: bold;">get</span>: <span style="color: #67b11d;">{</span> $0<span style="color: #b1951d;">[</span>keyPath: keyPath<span style="color: #b1951d;">]</span> <span style="color: #67b11d;">}</span>,
      send: <span style="color: #67b11d;">{</span> <span style="color: #bc6ec5; font-weight: bold;">action</span><span style="color: #b1951d;">(</span>.<span style="color: #4f97d7; font-weight: bold;">init</span><span style="color: #4f97d7;">(</span>keyPath, $0<span style="color: #4f97d7;">)</span><span style="color: #b1951d;">)</span> <span style="color: #67b11d;">}</span>
    <span style="color: #2d9574;">)</span>
  <span style="color: #bc6ec5;">}</span>
<span style="color: #4f97d7;">}</span>

<span style="color: #2aa1ae; background-color: #292e34;">// </span><span style="color: #2aa1ae; background-color: #292e34;">And then:</span>
<span style="color: #bc6ec5; font-weight: bold;">Picker</span><span style="color: #4f97d7;">(</span>
              <span style="color: #2d9574;">"Top posts digest"</span>,
              selection: viewStore.<span style="color: #bc6ec5; font-weight: bold;">binding</span><span style="color: #bc6ec5;">(</span>
                keyPath: \.<span style="color: #7590db;">digest</span>,
                send: ConciseSettingsAction.<span style="color: #7590db;">form</span>
              <span style="color: #bc6ec5;">)</span>
...
</pre>
</div>
<ol class="org-ol">
<li>Reduce even more boiler plate by allowing switches on the form action on first level:
</li>
</ol>
<div class="org-src-container">

<pre class="src src-swift"><span style="color: #4f97d7; font-weight: bold;">func</span> ~= &lt;Root, <span style="color: #4f97d7;">Value</span>&gt; <span style="color: #4f97d7;">(</span>
  keyPath: <span style="color: #4f97d7;">WritableKeyPath</span>&lt;Root, <span style="color: #4f97d7;">Value</span>&gt;,
  formAction: FormAction&lt;Root&gt;
<span style="color: #4f97d7;">)</span> -&gt; <span style="color: #4f97d7;">Bool</span> <span style="color: #4f97d7;">{</span>
  formAction.<span style="color: #4f97d7;">keyPath</span> == keyPath
<span style="color: #4f97d7;">}</span>
</pre>
</div>
<p>
neat!
</p>
</div>
<div id="outline-container-sec-31-1" class="outline-3">
<h3 id="sec-31-1"><span class="section-number-3">31.1</span> Exercises:</h3>
<div class="outline-text-3" id="text-31-1">
<ol class="org-ol">
<li>AnyEquatable
</li>
</ol>
<div class="org-src-container">

<pre class="src src-swift"><span style="color: #4f97d7; font-weight: bold;">struct</span> <span style="color: #bc6ec5; font-weight: bold;">AnyEquatable</span>: <span style="color: #4f97d7;">Equatable</span> <span style="color: #4f97d7;">{</span>
    <span style="color: #4f97d7; font-weight: bold;">let</span> value: Any
    <span style="color: #4f97d7; font-weight: bold;">let</span> equals: <span style="color: #bc6ec5;">(</span><span style="color: #2d9574;">(</span>Any<span style="color: #2d9574;">)</span> -&gt; <span style="color: #4f97d7;">Bool</span><span style="color: #bc6ec5;">)</span>!
    <span style="color: #4f97d7; font-weight: bold;">init</span>&lt;E&gt;<span style="color: #bc6ec5;">(</span>_ base: E<span style="color: #bc6ec5;">)</span> <span style="color: #4f97d7; font-weight: bold;">where</span> E : <span style="color: #4f97d7;">Equatable</span> <span style="color: #bc6ec5;">{</span>
        <span style="color: #4f97d7; font-weight: bold;">self</span>.<span style="color: #4f97d7;">value</span> = base
        <span style="color: #4f97d7; font-weight: bold;">self</span>.<span style="color: #7590db;">equals</span> = <span style="color: #2d9574;">{</span> $0 <span style="color: #4f97d7; font-weight: bold;">as</span>? E == base <span style="color: #2d9574;">}</span>
    <span style="color: #bc6ec5;">}</span>
<span style="color: #4f97d7;">}</span>

<span style="color: #4f97d7; font-weight: bold;">func</span> == <span style="color: #4f97d7;">(</span>lhs: AnyEquatable, rhs: AnyEquatable<span style="color: #4f97d7;">)</span> -&gt; <span style="color: #4f97d7;">Bool</span> <span style="color: #4f97d7;">{</span>
    lhs.<span style="color: #bc6ec5; font-weight: bold;">equals</span><span style="color: #bc6ec5;">(</span>rhs.<span style="color: #4f97d7;">value</span><span style="color: #bc6ec5;">)</span>
<span style="color: #4f97d7;">}</span>
</pre>
</div>
<p>
(almost equal to reference solution).
</p>
</div>
</div>
</div>
<div id="outline-container-sec-32" class="outline-2">
<h2 id="sec-32"><span class="section-number-2">32</span> Concise Forms: The Point</h2>
<div class="outline-text-2" id="text-32">
<p>
This presents concise forms in action within isowords.
⚠ In the current version of TCA, the action and higher level reducer have been renamed more generally to
<code>BindingAction&lt;T&gt;</code> and <code>.binding()</code>.
</p>
</div>
</div>
<div id="outline-container-sec-33" class="outline-2">
<h2 id="sec-33"><span class="section-number-2">33</span> SwiftUI Animation: The Basics</h2>
<div class="outline-text-2" id="text-33">
<p>
Implicit animations (<code>.animation(_,value:)</code>) vs explicit animations (<code>withAnimation {}</code>).
Implicit animations can give great results with very little work but are unsuitable
for fine-grained control, because they animate everything in the view hirarchy.
And the semantics of overriding animations is not clear.
E.g. if/else branches rather than ternary operator can mess up your animation semantics.
</p>

<p>
<code>withAnimation</code> is a special case of a <i>continuation</i>: <code>(A -&gt; R) -&gt; R</code> (where <code>A</code> is <code>Void</code> in this case).
Animate bindings with <code>binding.animation()</code> instead of <code>withAnimation</code>.
</p>
</div>
<div id="outline-container-sec-33-1" class="outline-3">
<h3 id="sec-33-1"><span class="section-number-3">33.1</span> Exercises</h3>
<div class="outline-text-3" id="text-33-1">
<ol class="org-ol">
<li>(Might be an ugly solution, don't know the best practices)
We can create the work on the dispatch queue as <code>WorkItem</code>'s and cancel them later.
</li>
</ol>
<div class="org-src-container">

<pre class="src src-swift"><span style="color: #4f97d7; font-weight: bold;">@State</span> <span style="color: #4f97d7; font-weight: bold;">private</span> <span style="color: #4f97d7; font-weight: bold;">var</span> animationStack: <span style="color: #4f97d7;">[</span>DispatchWorkItem<span style="color: #4f97d7;">]</span> = <span style="color: #4f97d7;">[]</span>
<span style="color: #2aa1ae; background-color: #292e34;">// </span><span style="color: #2aa1ae; background-color: #292e34;">...</span>

   <span style="color: #bc6ec5; font-weight: bold;">Button</span><span style="color: #4f97d7;">(</span><span style="color: #2d9574;">"Cycle colors"</span><span style="color: #4f97d7;">)</span> <span style="color: #4f97d7;">{</span>
        <span style="color: #bc6ec5;">[</span>Color.<span style="color: #7590db;">red</span>, .<span style="color: #7590db;">blue</span>, .<span style="color: #7590db;">green</span>, .<span style="color: #7590db;">purple</span>, .<span style="color: #7590db;">black</span><span style="color: #bc6ec5;">]</span>
          .<span style="color: #4f97d7;">enumerated</span><span style="color: #bc6ec5;">()</span>
          .<span style="color: #4f97d7;">forEach</span> <span style="color: #bc6ec5;">{</span> offset, color <span style="color: #4f97d7; font-weight: bold;">in</span>
              <span style="color: #4f97d7; font-weight: bold;">let</span> work = <span style="color: #bc6ec5; font-weight: bold;">DispatchWorkItem</span><span style="color: #2d9574;">(</span>block: <span style="color: #67b11d;">{</span>
                  <span style="color: #bc6ec5; font-weight: bold;">withAnimation</span><span style="color: #b1951d;">(</span>.<span style="color: #7590db;">linear</span><span style="color: #b1951d;">)</span> <span style="color: #b1951d;">{</span>
                      <span style="color: #4f97d7; font-weight: bold;">self</span>.<span style="color: #7590db;">viewModel</span>.<span style="color: #7590db;">circleColor</span> = color
                  <span style="color: #b1951d;">}</span>
              <span style="color: #67b11d;">}</span><span style="color: #2d9574;">)</span>
              <span style="color: #4f97d7; font-weight: bold;">self</span>.<span style="color: #7590db;">animationStack</span>.<span style="color: #4f97d7;">append</span><span style="color: #2d9574;">(</span>work<span style="color: #2d9574;">)</span>
              DispatchQueue.<span style="color: #4f97d7;">main</span>.<span style="color: #bc6ec5; font-weight: bold;">asyncAfter</span><span style="color: #2d9574;">(</span>deadline: .<span style="color: #4f97d7;">now</span><span style="color: #67b11d;">()</span> + .<span style="color: #4f97d7;">seconds</span><span style="color: #67b11d;">(</span>offset<span style="color: #67b11d;">)</span>, execute: work<span style="color: #2d9574;">)</span>
          <span style="color: #bc6ec5;">}</span>
 <span style="color: #2aa1ae; background-color: #292e34;">// </span><span style="color: #2aa1ae; background-color: #292e34;">...</span>
      <span style="color: #bc6ec5; font-weight: bold;">Button</span><span style="color: #bc6ec5;">(</span><span style="color: #2d9574;">"Reset"</span><span style="color: #bc6ec5;">)</span> <span style="color: #bc6ec5;">{</span>
          <span style="color: #4f97d7; font-weight: bold;">for</span> work <span style="color: #4f97d7; font-weight: bold;">in</span> <span style="color: #4f97d7; font-weight: bold;">self</span>.<span style="color: #7590db;">animationStack</span> <span style="color: #2d9574;">{</span>
              work.<span style="color: #4f97d7;">cancel</span><span style="color: #67b11d;">()</span>
          <span style="color: #2d9574;">}</span>
          animationStack.<span style="color: #4f97d7;">removeAll</span><span style="color: #2d9574;">()</span>
          <span style="color: #2aa1ae; background-color: #292e34;">// </span><span style="color: #2aa1ae; background-color: #292e34;">...</span>
      <span style="color: #bc6ec5;">}</span>
</pre>
</div>
<ol class="org-ol">
<li>Easy!
</li>
</ol>
<div class="org-src-container">

<pre class="src src-swift"><span style="color: #4f97d7; font-weight: bold;">class</span> <span style="color: #bc6ec5; font-weight: bold;">ViewModel</span>: <span style="color: #4f97d7;">ObservableObject</span> <span style="color: #4f97d7;">{</span>
    <span style="color: #4f97d7; font-weight: bold;">@Published</span> <span style="color: #4f97d7; font-weight: bold;">var</span> circleCenter = CGPoint.<span style="color: #4f97d7;">zero</span>
    <span style="color: #4f97d7; font-weight: bold;">@Published</span> <span style="color: #4f97d7; font-weight: bold;">var</span> circleColor = Color.<span style="color: #7590db;">black</span>
    <span style="color: #4f97d7; font-weight: bold;">@Published</span> <span style="color: #4f97d7; font-weight: bold;">var</span> isCircleScaled = <span style="color: #a45bad;">false</span>
    <span style="color: #4f97d7; font-weight: bold;">@Published</span> <span style="color: #4f97d7; font-weight: bold;">var</span> isResetting = <span style="color: #a45bad;">false</span>
<span style="color: #4f97d7;">}</span>
...

<span style="color: #4f97d7; font-weight: bold;">struct</span> <span style="color: #bc6ec5; font-weight: bold;">ContentView</span>: View <span style="color: #4f97d7;">{</span>
    <span style="color: #4f97d7; font-weight: bold;">@StateObject</span> <span style="color: #4f97d7; font-weight: bold;">var</span> viewModel: ViewModel
    <span style="color: #2aa1ae; background-color: #292e34;">/// </span><span style="color: #2aa1ae; background-color: #292e34;">Then change all usages of self.someState to self.viewModel.someState</span>
<span style="color: #4f97d7;">}</span>
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-sec-34" class="outline-2">
<h2 id="sec-34"><span class="section-number-2">34</span> Better Test Dependencies: Exhaustivity</h2>
<div class="outline-text-2" id="text-34">
<ul class="org-ul">
<li>Make those functions/dependencies fail that are not used in the test,
</li>
</ul>
<p>
e.g. by providing an unimplemented helper. For example
</p>
<div class="org-src-container">

<pre class="src src-swift"><span style="color: #4f97d7; font-weight: bold;">extension</span> <span style="color: #4f97d7;">UUID</span> <span style="color: #4f97d7;">{</span>
  <span style="color: #4f97d7; font-weight: bold;">static</span> <span style="color: #4f97d7; font-weight: bold;">let</span> unimplemented: <span style="color: #bc6ec5;">()</span> -&gt; <span style="color: #4f97d7;">UUID</span> = <span style="color: #bc6ec5;">{</span> <span style="color: #4f97d7;">fatalError</span><span style="color: #2d9574;">()</span> <span style="color: #bc6ec5;">}</span>
<span style="color: #4f97d7;">}</span>
</pre>
</div>
<p>
This will assert which dependencies are not used, strengthening your tests.
Also if you add more usage of the dependencies later, the tests will tell you exactly where to update.
</p>
<ul class="org-ul">
<li>Record function arguments by passing closures like so:
</li>
</ul>
<div class="org-src-container">

<pre class="src src-swift"><span style="color: #4f97d7; font-weight: bold;">extension</span> <span style="color: #bc6ec5; font-weight: bold;">AnalyticsClient</span> <span style="color: #4f97d7;">{</span>
  <span style="color: #4f97d7; font-weight: bold;">static</span> <span style="color: #4f97d7; font-weight: bold;">func</span> <span style="color: #bc6ec5; font-weight: bold;">test</span><span style="color: #bc6ec5;">(</span>onEvent: <span style="color: #4f97d7; font-weight: bold;">@escaping</span> <span style="color: #2d9574;">(</span><span style="color: #4f97d7;">Event</span><span style="color: #2d9574;">)</span> -&gt; <span style="color: #4f97d7;">Void</span><span style="color: #bc6ec5;">)</span> -&gt; <span style="color: #4f97d7; font-weight: bold;">Self</span> <span style="color: #bc6ec5;">{</span>
    <span style="color: #4f97d7; font-weight: bold;">Self</span><span style="color: #2d9574;">(</span>
      track: <span style="color: #67b11d;">{</span> event <span style="color: #4f97d7; font-weight: bold;">in</span>
        .<span style="color: #7590db;">fireAndForget</span> <span style="color: #b1951d;">{</span>
          <span style="color: #bc6ec5; font-weight: bold;">onEvent</span><span style="color: #4f97d7;">(</span>event<span style="color: #4f97d7;">)</span>
        <span style="color: #b1951d;">}</span>
      <span style="color: #67b11d;">}</span>
    <span style="color: #2d9574;">)</span>
  <span style="color: #bc6ec5;">}</span>
<span style="color: #4f97d7;">}</span>
</pre>
</div>
</div>
<div id="outline-container-sec-34-1" class="outline-3">
<h3 id="sec-34-1"><span class="section-number-3">34.1</span> Exercises</h3>
<div class="outline-text-3" id="text-34-1">
<ol class="org-ol">
<li>An assertion helper that asserts the events and removes all of them
</li>
</ol>
<div class="org-src-container">

<pre class="src src-swift">  <span style="color: #4f97d7; font-weight: bold;">func</span> <span style="color: #bc6ec5; font-weight: bold;">assertTracked</span><span style="color: #4f97d7;">(</span>events: <span style="color: #4f97d7; font-weight: bold;">inout</span> <span style="color: #bc6ec5;">[</span>AnalyticsClient.<span style="color: #4f97d7;">Event</span><span style="color: #bc6ec5;">]</span><span style="color: #4f97d7;">)</span> <span style="color: #4f97d7;">{</span>
    <span style="color: #bc6ec5; font-weight: bold;">XCTAssertEqual</span><span style="color: #bc6ec5;">(</span>events, <span style="color: #4f97d7; font-weight: bold;">self</span>.<span style="color: #7590db;">events</span><span style="color: #bc6ec5;">)</span>
    events.<span style="color: #4f97d7;">removeAll</span><span style="color: #bc6ec5;">()</span>
  <span style="color: #4f97d7;">}</span>
</pre>
</div>
<p>
(But why not re-initialise the captured data every time?)
</p>
</div>
</div>
</div>
<div id="outline-container-sec-35" class="outline-2">
<h2 id="sec-35"><span class="section-number-2">35</span> Better Test Dependencies: Failability</h2>
<div class="outline-text-2" id="text-35">
<ul class="org-ul">
<li>use <code>XCTDynamicTestOverlay</code>
</li>
<li>create a failing dependency "constructor'
</li>
</ul>
<div class="org-src-container">

<pre class="src src-swift"><span style="color: #4f97d7; font-weight: bold;">static</span> <span style="color: #4f97d7; font-weight: bold;">let</span> failing = <span style="color: #4f97d7; font-weight: bold;">Self</span><span style="color: #4f97d7;">(</span>
        execute: <span style="color: #bc6ec5;">{</span> language <span style="color: #4f97d7; font-weight: bold;">in</span>
            <span style="color: #bc6ec5; font-weight: bold;">XCTFail</span><span style="color: #2d9574;">(</span><span style="color: #2d9574;">"MyService.execute(\(</span>language<span style="color: #2d9574;">)) not implemented"</span><span style="color: #2d9574;">)</span>
            <span style="color: #4f97d7; font-weight: bold;">return</span> <span style="color: #bc6ec5; font-weight: bold;">SomeDummyData</span><span style="color: #2d9574;">()</span>
        <span style="color: #bc6ec5;">}</span>
    <span style="color: #4f97d7;">)</span>
</pre>
</div>
<p>
it will not crash the testsuite. CA can also better point out where the error is.
There is a neat failing `Effect` in CA:
<code>Effect.failing(prefix: String)</code>
</p>
</div>
</div>




<div id="outline-container-sec-36" class="outline-2">
<h2 id="sec-36"><span class="section-number-2">36</span> A Tour of Isowords: Part 1</h2>
<div class="outline-text-2" id="text-36">
<p>
Describes the hyper-modularization, domain modelling and testing strategy for isowords.
</p>
</div>
</div>
<div id="outline-container-sec-37" class="outline-2">
<h2 id="sec-37"><span class="section-number-2">37</span> A Tour of Isowords: Part 2</h2>
<div class="outline-text-2" id="text-37">
<p>
Demonstrates how the composable architecture can be used
to abstract away seperate features like app clips and app store videos
on top of the existing game logic, without littering it with additional code.
</p>
</div>
</div>


<div id="outline-container-sec-38" class="outline-2">
<h2 id="sec-38"><span class="section-number-2">38</span> Async Refreshable: SwiftUI</h2>
<div class="outline-text-2" id="text-38">
<p>
You can use <code>.refreshable { &lt;async closure&gt; }</code> to implement a simple pull to refresh.
We could use for example the new async URLSession to perform the data refresh,
since refreshable gives us an async context.
</p>
<div class="org-src-container">

<pre class="src src-swift"><span style="color: #4f97d7; font-weight: bold;">let</span> <span style="color: #4f97d7;">(</span>data, _<span style="color: #4f97d7;">)</span> = <span style="color: #4f97d7; font-weight: bold;">try</span> <span style="color: #4f97d7; font-weight: bold;">await</span> <span style="color: #4f97d7;">URLSession</span>.<span style="color: #4f97d7;">shared</span>.<span style="color: #4f97d7;">data</span><span style="color: #4f97d7;">(</span>...<span style="color: #4f97d7;">)</span>
</pre>
</div>
<p>
If we want to be able to cancle such asnychronous work, it needs to be wrapped in a task:
</p>
<div class="org-src-container">

<pre class="src src-swift"><span style="color: #4f97d7; font-weight: bold;">let</span> task = Task <span style="color: #4f97d7;">{</span>
  <span style="color: #2aa1ae; background-color: #292e34;">//</span><span style="color: #2aa1ae; background-color: #292e34;">...perform work</span>
<span style="color: #4f97d7;">}</span>
task.<span style="color: #4f97d7;">cancel</span><span style="color: #4f97d7;">()</span>
</pre>
</div>
<p>
If this task is part of your <code>ObservableObject</code> view model and you want to display state based
on weather the task is running or not, you had to mark it as <code>@Published</code>, so that
SwiftUI can recompute the view when the State of <code>Task</code> execution changes.
</p>

<p>
When performing <code>async</code> things that then modify some state on completion, it can make sense
to use <code>@MainAction</code> method annotation, to make sure work is resumed on the main thread, after finishing 
the async workload.
</p>

<p>
The episode then goes to explain that e.g. displaying loading state and cancelling requests when doing <code>async</code> tasks
is hard to test. For example, it seems you have to work with <code>TaskSleep</code> and artificial delays to hook into the state of the view model
where the request is currently executing.
</p>
</div>
</div>

<div id="outline-container-sec-39" class="outline-2">
<h2 id="sec-39"><span class="section-number-2">39</span> Async Refreshable: ComposableArchitecture</h2>
<div class="outline-text-2" id="text-39">
<p>
When the <code>refreshable</code> closure is called, the loading spinner is shown as long as an async task is running
in the asynchronous context of it. This is a problem with the composable architecture: While you of course can make changes
to the store from an async context, the call to make these changes returns immediately.
</p>

<p>
Solution: Use a boolean to reflect weather an async process is running
</p>
<div class="org-src-container">

<pre class="src src-swift"><span style="color: #4f97d7; font-weight: bold;">func</span> <span style="color: #bc6ec5; font-weight: bold;">send</span><span style="color: #4f97d7;">(</span>
  _ action: Action,
  <span style="color: #2d9574;">`while`</span> isInFlight: <span style="color: #4f97d7; font-weight: bold;">@escaping</span> <span style="color: #bc6ec5;">(</span><span style="color: #4f97d7;">State</span><span style="color: #bc6ec5;">)</span> -&gt; <span style="color: #4f97d7;">Bool</span>
<span style="color: #4f97d7;">)</span> <span style="color: #4f97d7; font-weight: bold;">async</span> <span style="color: #4f97d7;">{</span>
    <span style="color: #4f97d7; font-weight: bold;">self</span>.<span style="color: #4f97d7;">send</span><span style="color: #bc6ec5;">(</span>action<span style="color: #bc6ec5;">)</span>
    <span style="color: #4f97d7; font-weight: bold;">await</span> withUnsafeContinuation <span style="color: #bc6ec5;">{</span> continuation <span style="color: #4f97d7; font-weight: bold;">in</span>
        <span style="color: #4f97d7; font-weight: bold;">var</span> cancellable: Cancellable?
        cancellable = <span style="color: #4f97d7; font-weight: bold;">self</span>.<span style="color: #4f97d7;">publisher</span>
          .<span style="color: #4f97d7;">filter</span> <span style="color: #2d9574;">{</span> <span style="color: #a45bad;">!</span><span style="color: #bc6ec5; font-weight: bold;">isInFlight</span><span style="color: #67b11d;">(</span>$0<span style="color: #67b11d;">)</span> <span style="color: #2d9574;">}</span>
          .<span style="color: #4f97d7; font-weight: bold;">prefix</span><span style="color: #2d9574;">(</span><span style="color: #a45bad;">1</span><span style="color: #2d9574;">)</span>
          .<span style="color: #4f97d7;">sink</span> <span style="color: #2d9574;">{</span> _ <span style="color: #4f97d7; font-weight: bold;">in</span>
              continuation.<span style="color: #4f97d7;">resume</span><span style="color: #67b11d;">(</span>returning: <span style="color: #b1951d;">()</span><span style="color: #67b11d;">)</span>
              _ = cancellable
          <span style="color: #2d9574;">}</span>
    <span style="color: #bc6ec5;">}</span>
<span style="color: #4f97d7;">}</span>
</pre>
</div>
</div>
<div id="outline-container-sec-39-1" class="outline-3">
<h3 id="sec-39-1"><span class="section-number-3">39.1</span> Exercises</h3>
<div class="outline-text-3" id="text-39-1">
<ol class="org-ol">
<li>My solution, probably with some race conditions:
</li>
</ol>
<div class="org-src-container">

<pre class="src src-swift"><span style="color: #4f97d7; font-weight: bold;">extension</span> <span style="color: #bc6ec5; font-weight: bold;">ViewStore</span> <span style="color: #4f97d7;">{</span>
  <span style="color: #4f97d7; font-weight: bold;">func</span> <span style="color: #bc6ec5; font-weight: bold;">send</span><span style="color: #bc6ec5;">(</span>
    _ action: Action,
    <span style="color: #4f97d7; font-weight: bold;">while</span> predicate: <span style="color: #4f97d7; font-weight: bold;">@escaping</span> <span style="color: #2d9574;">(</span><span style="color: #4f97d7;">State</span><span style="color: #2d9574;">)</span> -&gt; <span style="color: #4f97d7;">Bool</span>
  <span style="color: #bc6ec5;">)</span> <span style="color: #4f97d7; font-weight: bold;">async</span> <span style="color: #bc6ec5;">{</span>
    <span style="color: #4f97d7; font-weight: bold;">self</span>.<span style="color: #4f97d7;">send</span><span style="color: #2d9574;">(</span>action<span style="color: #2d9574;">)</span>
      <span style="color: #4f97d7; font-weight: bold;">var</span> cancellable: Cancellable?
      <span style="color: #4f97d7; font-weight: bold;">let</span> onCancel = <span style="color: #2d9574;">{</span> cancellable = <span style="color: #a45bad;">nil</span> <span style="color: #2d9574;">}</span>
      <span style="color: #4f97d7; font-weight: bold;">await</span> <span style="color: #bc6ec5; font-weight: bold;">withTaskCancellationHandler</span><span style="color: #2d9574;">(</span>operation: <span style="color: #67b11d;">{</span>
          <span style="color: #4f97d7; font-weight: bold;">await</span> withUnsafeContinuation <span style="color: #b1951d;">{</span> <span style="color: #4f97d7;">(</span>continuation: UnsafeContinuation&lt;<span style="color: #4f97d7;">Void</span>, <span style="color: #4f97d7;">Never</span>&gt;<span style="color: #4f97d7;">)</span> <span style="color: #4f97d7; font-weight: bold;">in</span>
              cancellable = <span style="color: #4f97d7; font-weight: bold;">self</span>.<span style="color: #4f97d7;">publisher</span>
                  .<span style="color: #4f97d7;">filter</span> <span style="color: #4f97d7;">{</span> <span style="color: #a45bad;">!</span><span style="color: #bc6ec5; font-weight: bold;">predicate</span><span style="color: #bc6ec5;">(</span>$0<span style="color: #bc6ec5;">)</span> <span style="color: #4f97d7;">}</span>
                  .<span style="color: #4f97d7; font-weight: bold;">prefix</span><span style="color: #4f97d7;">(</span><span style="color: #a45bad;">1</span><span style="color: #4f97d7;">)</span>
                  .<span style="color: #4f97d7;">sink</span> <span style="color: #4f97d7;">{</span> _ <span style="color: #4f97d7; font-weight: bold;">in</span>
                      continuation.<span style="color: #4f97d7;">resume</span><span style="color: #bc6ec5;">()</span>
                      _ = cancellable
                  <span style="color: #4f97d7;">}</span>
          <span style="color: #b1951d;">}</span>
      <span style="color: #67b11d;">}</span>, onCancel: <span style="color: #67b11d;">{</span> <span style="color: #bc6ec5; font-weight: bold;">onCancel</span><span style="color: #b1951d;">()</span> <span style="color: #67b11d;">}</span><span style="color: #2d9574;">)</span>
  <span style="color: #bc6ec5;">}</span>
<span style="color: #4f97d7;">}</span>

</pre>
</div>
<p>
Reference solution:
</p>
<div class="org-src-container">

<pre class="src src-swift"><span style="color: #4f97d7; font-weight: bold;">extension</span> <span style="color: #bc6ec5; font-weight: bold;">ViewStore</span> <span style="color: #4f97d7;">{</span>
  <span style="color: #4f97d7; font-weight: bold;">func</span> <span style="color: #bc6ec5; font-weight: bold;">send</span><span style="color: #bc6ec5;">(</span>
    _ action: Action,
    <span style="color: #2d9574;">`while`</span> isInFlight: <span style="color: #4f97d7; font-weight: bold;">@escaping</span> <span style="color: #2d9574;">(</span><span style="color: #4f97d7;">State</span><span style="color: #2d9574;">)</span> -&gt; <span style="color: #4f97d7;">Bool</span>
  <span style="color: #bc6ec5;">)</span> <span style="color: #4f97d7; font-weight: bold;">async</span> <span style="color: #bc6ec5;">{</span>
    <span style="color: #4f97d7; font-weight: bold;">self</span>.<span style="color: #4f97d7;">send</span><span style="color: #2d9574;">(</span>action<span style="color: #2d9574;">)</span>

    <span style="color: #4f97d7; font-weight: bold;">var</span> cancellable: Cancellable?
    <span style="color: #4f97d7; font-weight: bold;">try</span>? <span style="color: #4f97d7; font-weight: bold;">await</span> <span style="color: #bc6ec5; font-weight: bold;">withTaskCancellationHandler</span><span style="color: #2d9574;">(</span>
      handler: <span style="color: #67b11d;">{</span> <span style="color: #b1951d;">[</span>cancellable<span style="color: #b1951d;">]</span> <span style="color: #4f97d7; font-weight: bold;">in</span> cancellable?.<span style="color: #4f97d7;">cancel</span><span style="color: #b1951d;">()</span> <span style="color: #67b11d;">}</span>,
      operation: <span style="color: #67b11d;">{</span>
        <span style="color: #4f97d7; font-weight: bold;">try</span> Task.<span style="color: #bc6ec5; font-weight: bold;">checkCancellation</span><span style="color: #b1951d;">()</span>
        <span style="color: #4f97d7; font-weight: bold;">try</span> <span style="color: #4f97d7; font-weight: bold;">await</span> withUnsafeThrowingContinuation <span style="color: #b1951d;">{</span> <span style="color: #4f97d7;">(</span>continuation: UnsafeContinuation&lt;<span style="color: #4f97d7;">Void</span>, <span style="color: #4f97d7;">Error</span>&gt;<span style="color: #4f97d7;">)</span> <span style="color: #4f97d7; font-weight: bold;">in</span>
          <span style="color: #4f97d7; font-weight: bold;">guard</span> <span style="color: #a45bad;">!</span>Task.<span style="color: #4f97d7;">isCancelled</span> <span style="color: #4f97d7; font-weight: bold;">else</span> <span style="color: #4f97d7;">{</span>
            continuation.<span style="color: #4f97d7;">resume</span><span style="color: #bc6ec5;">(</span>throwing: <span style="color: #bc6ec5; font-weight: bold;">CancellationError</span><span style="color: #2d9574;">()</span><span style="color: #bc6ec5;">)</span>
            <span style="color: #4f97d7; font-weight: bold;">return</span>
          <span style="color: #4f97d7;">}</span>
          cancellable = <span style="color: #4f97d7; font-weight: bold;">self</span>.<span style="color: #4f97d7;">publisher</span>
            .<span style="color: #4f97d7;">filter</span> <span style="color: #4f97d7;">{</span> <span style="color: #a45bad;">!</span><span style="color: #bc6ec5; font-weight: bold;">predicate</span><span style="color: #bc6ec5;">(</span>$0<span style="color: #bc6ec5;">)</span> <span style="color: #4f97d7;">}</span>
            .<span style="color: #4f97d7; font-weight: bold;">prefix</span><span style="color: #4f97d7;">(</span><span style="color: #a45bad;">1</span><span style="color: #4f97d7;">)</span>
            .<span style="color: #4f97d7;">sink</span> <span style="color: #4f97d7;">{</span> _ <span style="color: #4f97d7; font-weight: bold;">in</span>
              continuation.<span style="color: #4f97d7;">resume</span><span style="color: #bc6ec5;">()</span>
              _ = cancellable
            <span style="color: #4f97d7;">}</span>
        <span style="color: #b1951d;">}</span>
      <span style="color: #67b11d;">}</span>
    <span style="color: #2d9574;">)</span>
  <span style="color: #bc6ec5;">}</span>
<span style="color: #4f97d7;">}</span>
</pre>
</div>
<p>
(In my solution i don't check for cancellation)
Also i'm not sure how the capture list works. Won't it capture always <code>nil</code>, so the cancelable will actually never be cancelled?
</p>
<ol class="org-ol">
<li>I don't think we can write it in terms of the previous function, because we cannot <code>await</code> in <code>withAnimation</code> block.
</li>
</ol>
<p>
My monke brain solution would be to copy the previous function and wrap the <code>store.send</code> inside a <code>withAnimation(animation){}</code>.
Reference solution: Extract the code after <code>store.send</code> and use it in both functions.
</p>
<ol class="org-ol">
<li>From what we learned so far, this should be quite easy:
</li>
</ol>
<div class="org-src-container">

<pre class="src src-swift"><span style="color: #4f97d7; font-weight: bold;">extension</span> <span style="color: #bc6ec5; font-weight: bold;">ViewStore</span> <span style="color: #4f97d7;">{</span>
    <span style="color: #4f97d7; font-weight: bold;">var</span> stream: AsyncStream&lt;<span style="color: #4f97d7;">State</span>&gt; <span style="color: #bc6ec5;">{</span>
        <span style="color: #4f97d7; font-weight: bold;">return</span> AsyncStream <span style="color: #2d9574;">{</span> continuation <span style="color: #4f97d7; font-weight: bold;">in</span>
            <span style="color: #4f97d7; font-weight: bold;">var</span> cancellable: Cancellable?
            cancellable = <span style="color: #4f97d7; font-weight: bold;">self</span>.<span style="color: #4f97d7;">publisher</span>
                .<span style="color: #4f97d7;">sink</span> <span style="color: #67b11d;">{</span> newState <span style="color: #4f97d7; font-weight: bold;">in</span>
                    continuation.<span style="color: #bc6ec5; font-weight: bold;">yield</span><span style="color: #b1951d;">(</span>newState<span style="color: #b1951d;">)</span>
                <span style="color: #67b11d;">}</span>
            continuation.<span style="color: #7590db;">onTermination</span> = <span style="color: #67b11d;">{</span>  <span style="color: #4f97d7; font-weight: bold;">@Sendable</span> <span style="color: #b1951d;">[</span>cancellable<span style="color: #b1951d;">]</span> _ <span style="color: #4f97d7; font-weight: bold;">in</span>
                cancellable?.<span style="color: #4f97d7;">cancel</span><span style="color: #b1951d;">()</span>
            <span style="color: #67b11d;">}</span>
        <span style="color: #2d9574;">}</span>
    <span style="color: #bc6ec5;">}</span>
<span style="color: #4f97d7;">}</span>
</pre>
</div>
<p>
The reference solution doesn't mind about the <code>onTermination</code>, and handles completions by calling <code>continuation.finish()</code>.
</p>
<ol class="org-ol">
<li>This is much shorter now with <code>stream</code>:
</li>
</ol>
<div class="org-src-container">

<pre class="src src-swift"><span style="color: #4f97d7; font-weight: bold;">extension</span> <span style="color: #bc6ec5; font-weight: bold;">ViewStore</span> <span style="color: #4f97d7;">{</span>
    <span style="color: #4f97d7; font-weight: bold;">func</span> <span style="color: #bc6ec5; font-weight: bold;">suspend</span><span style="color: #bc6ec5;">(</span><span style="color: #4f97d7; font-weight: bold;">while</span> predicate: <span style="color: #4f97d7; font-weight: bold;">@escaping</span> <span style="color: #2d9574;">(</span><span style="color: #4f97d7;">State</span><span style="color: #2d9574;">)</span> -&gt; <span style="color: #4f97d7;">Bool</span><span style="color: #bc6ec5;">)</span> <span style="color: #4f97d7; font-weight: bold;">async</span> <span style="color: #bc6ec5;">{</span>
        <span style="color: #4f97d7; font-weight: bold;">let</span> stream = <span style="color: #4f97d7; font-weight: bold;">self</span>.<span style="color: #7590db;">stream</span>
        .<span style="color: #4f97d7;">filter</span> <span style="color: #2d9574;">{</span> <span style="color: #a45bad;">!</span><span style="color: #bc6ec5; font-weight: bold;">predicate</span><span style="color: #67b11d;">(</span>$0<span style="color: #67b11d;">)</span> <span style="color: #2d9574;">}</span>
        .<span style="color: #4f97d7; font-weight: bold;">prefix</span><span style="color: #2d9574;">(</span><span style="color: #a45bad;">1</span><span style="color: #2d9574;">)</span>
        <span style="color: #4f97d7; font-weight: bold;">for</span> <span style="color: #4f97d7; font-weight: bold;">try</span> <span style="color: #4f97d7; font-weight: bold;">await</span> _ <span style="color: #4f97d7; font-weight: bold;">in</span> stream <span style="color: #2d9574;">{</span> <span style="color: #2d9574;">}</span>
    <span style="color: #bc6ec5;">}</span>
<span style="color: #4f97d7;">}</span>
</pre>
</div>
<p>
It can be more elegant without the weird for loop:
</p>
<div class="org-src-container">

<pre class="src src-swift"><span style="color: #4f97d7; font-weight: bold;">extension</span> <span style="color: #bc6ec5; font-weight: bold;">ViewStore</span> <span style="color: #4f97d7;">{</span>
  <span style="color: #4f97d7; font-weight: bold;">func</span> <span style="color: #bc6ec5; font-weight: bold;">suspend</span><span style="color: #bc6ec5;">(</span><span style="color: #4f97d7; font-weight: bold;">while</span> predicate: <span style="color: #4f97d7; font-weight: bold;">@escaping</span> <span style="color: #2d9574;">(</span><span style="color: #4f97d7;">State</span><span style="color: #2d9574;">)</span> -&gt; <span style="color: #4f97d7;">Bool</span><span style="color: #bc6ec5;">)</span> <span style="color: #4f97d7; font-weight: bold;">async</span> <span style="color: #bc6ec5;">{</span>
    _ = <span style="color: #4f97d7; font-weight: bold;">await</span> <span style="color: #4f97d7; font-weight: bold;">self</span>.<span style="color: #7590db;">stream</span>
      .<span style="color: #4f97d7;">filter</span> <span style="color: #2d9574;">{</span> <span style="color: #a45bad;">!</span><span style="color: #bc6ec5; font-weight: bold;">predicate</span><span style="color: #67b11d;">(</span>$0<span style="color: #67b11d;">)</span> <span style="color: #2d9574;">}</span>
      .<span style="color: #4f97d7;">first</span><span style="color: #2d9574;">(</span><span style="color: #4f97d7; font-weight: bold;">where</span>: <span style="color: #67b11d;">{</span> _ <span style="color: #4f97d7; font-weight: bold;">in</span> <span style="color: #a45bad;">true</span> <span style="color: #67b11d;">}</span><span style="color: #2d9574;">)</span>
  <span style="color: #bc6ec5;">}</span>
<span style="color: #4f97d7;">}</span>
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-sec-40" class="outline-2">
<h2 id="sec-40"><span class="section-number-2">40</span> Safer, Conciser Forms: Part 1</h2>
<div class="outline-text-2" id="text-40">
<ul class="org-ul">
<li>use <code>@BindableState</code> in your TCA state property to opt-in to make it bindable
</li>
<li>This makes the domain logic safer because the view cannot arbitrarily mutate the state
</li>
<li>use <code>case binding(BindingAction&lt;SpellingChallengeState&gt;)</code> to handle binding actions
</li>
</ul>

<p>
some swift learnings:
</p>
<ul class="org-ul">
<li>Implement <code>projectedValue</code> to expose the wrapping type when writing your own property wrapper.
</li>
</ul>
<p>
Then access the wrapping type with a <code>$</code> prefix. By default, the wrapping type is just exposed
privately and accessed by a <code>_</code> prefix.
</p>
<ul class="org-ul">
<li>Implement getter and setters within <code>projectedValue</code> to derive writable key paths.
</li>
</ul>
</div>
</div>
<div id="outline-container-sec-41" class="outline-2">
<h2 id="sec-41"><span class="section-number-2">41</span> Safer, Conciser Forms: Part 2</h2>
<div class="outline-text-2" id="text-41">
<p>
We can omit stating the binding action case when we derive bindings from bindable state,
or when we chain the higher level <code>.binding(Action)</code> reducer.
Swift enums can conform to protocols with cases, like so:
</p>
<div class="org-src-container">

<pre class="src src-swift"><span style="color: #4f97d7; font-weight: bold;">protocol</span> <span style="color: #bc6ec5; font-weight: bold;">BindableAction</span> <span style="color: #4f97d7;">{</span>
  <span style="color: #4f97d7; font-weight: bold;">associatedtype</span> <span style="color: #4f97d7;">State</span>
  <span style="color: #4f97d7; font-weight: bold;">static</span> <span style="color: #4f97d7; font-weight: bold;">func</span> <span style="color: #bc6ec5; font-weight: bold;">binding</span><span style="color: #bc6ec5;">(</span>_: BindingAction&lt;<span style="color: #4f97d7;">State</span>&gt;<span style="color: #bc6ec5;">)</span> -&gt; <span style="color: #4f97d7; font-weight: bold;">Self</span>
<span style="color: #4f97d7;">}</span>
</pre>
</div>
<p>
You could even simplify creating bindings by implementing a <a href="https://www.hackingwithswift.com/articles/55/how-to-use-dynamic-member-lookup-in-swift">dynamic member lookup</a> for the view store.
This has been deprecated in TCA though, because it causes some problems in the reducer.
If we did't care about the type safety (Only Bindable states can be bound to) we theoretically could use 
this new syntax that allows bindings to be passed to closures:
</p>
<div class="org-src-container">

<pre class="src src-swift"><span style="color: #4f97d7; font-weight: bold;">struct</span> <span style="color: #bc6ec5; font-weight: bold;">MyView</span>: View <span style="color: #4f97d7;">{</span>
  <span style="color: #4f97d7; font-weight: bold;">@State</span> <span style="color: #4f97d7; font-weight: bold;">var</span> array = <span style="color: #bc6ec5;">[</span><span style="color: #a45bad;">1</span>, <span style="color: #a45bad;">2</span>, <span style="color: #a45bad;">3</span><span style="color: #bc6ec5;">]</span>
  <span style="color: #4f97d7; font-weight: bold;">var</span> body: <span style="color: #4f97d7; font-weight: bold;">some</span> View <span style="color: #bc6ec5;">{</span>
    <span style="color: #bc6ec5; font-weight: bold;">ForEach</span><span style="color: #2d9574;">(</span><span style="color: #4f97d7; font-weight: bold;">self</span>.$array, id: \.<span style="color: #4f97d7; font-weight: bold;">self</span><span style="color: #2d9574;">)</span> <span style="color: #2d9574;">{</span> $number <span style="color: #4f97d7; font-weight: bold;">in</span>
      <span style="color: #4f97d7; font-weight: bold;">let</span> _ = $number <span style="color: #4f97d7; font-weight: bold;">as</span> Binding&lt;<span style="color: #4f97d7;">Int</span>&gt;
      <span style="color: #4f97d7; font-weight: bold;">let</span> _ = number <span style="color: #4f97d7; font-weight: bold;">as</span> <span style="color: #4f97d7;">Int</span>
    <span style="color: #2d9574;">}</span>
  <span style="color: #bc6ec5;">}</span>
<span style="color: #4f97d7;">}</span> 
</pre>
</div>
</div>
</div>
</div></div></div>
</body>
</html>