<!doctype html>
<html lang="en">
<head>
<title></title>
<!-- 2021-09-26 Sun 10:17 -->
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="generator" content="Org-mode">
<meta name="author" content="Falco Winkler">

<link  href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.5/css/bootstrap.min.css" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.5/js/bootstrap.min.js"></script>
<style>
/* org mode styles on top of twbs */

html {
    position: relative;
    min-height: 100%;
}

body {
    font-size: 18px;
    margin-bottom: 105px;
}

footer {
    position: absolute;
    bottom: 0;
    width: 100%;
    height: 101px;
    background-color: #f5f5f5;
}

footer > div {
    padding: 10px;
}

footer p {
    margin: 0 0 5px;
    text-align: center;
    font-size: 16px;
}

#table-of-contents {
    margin-top: 20px;
    margin-bottom: 20px;
}

blockquote p {
    font-size: 18px;
}

pre {
    font-size: 16px;
}

.footpara {
    display: inline-block;
}

figcaption {
  font-size: 16px;
  color: #666;
  font-style: italic;
  padding-bottom: 15px;
}

/* from twbs docs */

.bs-docs-sidebar.affix {
    position: static;
}
@media (min-width: 768px) {
    .bs-docs-sidebar {
        padding-left: 20px;
    }
}

/* All levels of nav */
.bs-docs-sidebar .nav > li > a {
    display: block;
    padding: 4px 20px;
    font-size: 14px;
    font-weight: 500;
    color: #999;
}
.bs-docs-sidebar .nav > li > a:hover,
.bs-docs-sidebar .nav > li > a:focus {
    padding-left: 19px;
    color: #A1283B;
    text-decoration: none;
    background-color: transparent;
    border-left: 1px solid #A1283B;
}
.bs-docs-sidebar .nav > .active > a,
.bs-docs-sidebar .nav > .active:hover > a,
.bs-docs-sidebar .nav > .active:focus > a {
    padding-left: 18px;
    font-weight: bold;
    color: #A1283B;
    background-color: transparent;
    border-left: 2px solid #A1283B;
}

/* Nav: second level (shown on .active) */
.bs-docs-sidebar .nav .nav {
    display: none; /* Hide by default, but at >768px, show it */
    padding-bottom: 10px;
}
.bs-docs-sidebar .nav .nav > li > a {
    padding-top: 1px;
    padding-bottom: 1px;
    padding-left: 30px;
    font-size: 12px;
    font-weight: normal;
}
.bs-docs-sidebar .nav .nav > li > a:hover,
.bs-docs-sidebar .nav .nav > li > a:focus {
    padding-left: 29px;
}
.bs-docs-sidebar .nav .nav > .active > a,
.bs-docs-sidebar .nav .nav > .active:hover > a,
.bs-docs-sidebar .nav .nav > .active:focus > a {
    padding-left: 28px;
    font-weight: 500;
}

/* Nav: third level (shown on .active) */
.bs-docs-sidebar .nav .nav .nav {
    padding-bottom: 10px;
}
.bs-docs-sidebar .nav .nav .nav > li > a {
    padding-top: 1px;
    padding-bottom: 1px;
    padding-left: 40px;
    font-size: 12px;
    font-weight: normal;
}
.bs-docs-sidebar .nav .nav .nav > li > a:hover,
.bs-docs-sidebar .nav .nav .nav > li > a:focus {
    padding-left: 39px;
}
.bs-docs-sidebar .nav .nav .nav > .active > a,
.bs-docs-sidebar .nav .nav .nav > .active:hover > a,
.bs-docs-sidebar .nav .nav .nav > .active:focus > a {
    padding-left: 38px;
    font-weight: 500;
}

/* Show and affix the side nav when space allows it */
@media (min-width: 992px) {
    .bs-docs-sidebar .nav > .active > ul {
        display: block;
    }
    /* Widen the fixed sidebar */
    .bs-docs-sidebar.affix,
    .bs-docs-sidebar.affix-bottom {
        width: 213px;
    }
    .bs-docs-sidebar.affix {
        position: fixed; /* Undo the static from mobile first approach */
        top: 20px;
    }
    .bs-docs-sidebar.affix-bottom {
        position: absolute; /* Undo the static from mobile first approach */
    }
    .bs-docs-sidebar.affix .bs-docs-sidenav,.bs-docs-sidebar.affix-bottom .bs-docs-sidenav {
        margin-top: 0;
        margin-bottom: 0
    }
}
@media (min-width: 1200px) {
    /* Widen the fixed sidebar again */
    .bs-docs-sidebar.affix-bottom,
    .bs-docs-sidebar.affix {
        width: 263px;
    }
}
</style>
<style>body { margin-bottom: 0px; }</style><script>
$(function() {
    'use strict';

    $('.bs-docs-sidebar li').first().addClass('active');

    $(document.body).scrollspy({target: '.bs-docs-sidebar'});

    $('.bs-docs-sidebar').affix();
});
</script><link rel="stylesheet" type="text/css" href="css/python_course.css">

<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  displayAlign: "center",
  displayIndent: "2em",
  messageStyle: "none",
  "HTML-CSS": {
    scale: 100,
    styles: {
      ".MathJax_Display": {
        "font-size": "100%"
      }
    }
  },
  "SVG": {
    scale: 100,
    styles: {
      ".MathJax_SVG_Display": {
        "font-size": "100%",
        "margin-left": "-2.281em"
      }
    }
  }
});
</script>
<script src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS_SVG"></script>
</head>
<body>
<div id="content" class="container">
<div class="row"><div class="col-md-3 col-md-push-9"><nav id="table-of-contents">
<div id="text-table-of-contents" class="bs-docs-sidebar">
<ul class="nav">
<li><a href="#sec-1">1. Functions</a></li>
<li><a href="#sec-2">2. Side effects</a></li>
<li><a href="#sec-3">3. UIKit styling with functions</a></li>
<li><a href="#sec-4">4. Algebraic data types</a>
<ul class="nav">
<li><a href="#sec-4-1">4.1. Exercises</a></li>
</ul>
</li>
<li><a href="#sec-5">5. Higher order functions</a>
<ul class="nav">
<li><a href="#sec-5-1">5.1. Exercises</a></li>
</ul>
</li>
<li><a href="#sec-6">6. Functional setters</a>
<ul class="nav">
<li><a href="#sec-6-1">6.1. Exercises</a></li>
</ul>
</li>
<li><a href="#sec-7">7. Setters and key paths</a>
<ul class="nav">
<li><a href="#sec-7-1">7.1. Exercises</a></li>
</ul>
</li>
<li><a href="#sec-8">8. Getters and key paths</a>
<ul class="nav">
<li><a href="#sec-8-1">8.1. Exercises</a></li>
</ul>
</li>
<li><a href="#sec-9">9. Algebraic Data Types: Exponents</a>
<ul class="nav">
<li><a href="#sec-9-1">9.1. Exercises</a></li>
</ul>
</li>
<li><a href="#sec-10">10. A tale of two flat maps</a>
<ul class="nav">
<li><a href="#sec-10-1">10.1. Exercises</a></li>
</ul>
</li>
<li><a href="#sec-11">11. Composition without operators</a>
<ul class="nav">
<li><a href="#sec-11-1">11.1. Exercises</a></li>
</ul>
</li>
<li><a href="#sec-12">12. A Tour of the Composable Architecture: Part 1</a></li>
<li><a href="#sec-13">13. A Tour of the Composable Architecture: Part 2</a></li>
<li><a href="#sec-14">14. A Tour of the Composable Architecture: Part 3</a></li>
<li><a href="#sec-15">15. A Tour of the Composable Architecture: Part 4</a></li>
</ul>
</div>
</nav>
</div><div class="col-md-9 col-md-pull-3"><h1 class="title"></h1>
<p>
key takeaways for <a href="https://www.pointfree.co/">https://www.pointfree.co/</a>
</p>
<div id="outline-container-sec-1" class="outline-2">
<h2 id="sec-1"><span class="section-number-2">1</span> Functions</h2>
<div class="outline-text-2" id="text-1">
<p>
Introduces operator <code>|&gt;</code> (forward application) and <code>&gt;&gt;&gt;</code> (forward composition).
</p>
<div class="org-src-container">

<pre class="src src-swift"><span style="color: #a45bad;">2</span> |&gt; incr <span style="color: #2aa1ae; background-color: #292e34;">// </span><span style="color: #2aa1ae; background-color: #292e34;">== incr(2)</span>
<span style="color: #4f97d7;">(</span>incr &gt;&gt;&gt; square<span style="color: #4f97d7;">)(</span><span style="color: #a45bad;">2</span><span style="color: #4f97d7;">)</span> <span style="color: #2aa1ae; background-color: #292e34;">// </span><span style="color: #2aa1ae; background-color: #292e34;">9</span>
</pre>
</div>
<ul class="org-ul">
<li>Forward composition is the oposite of haskells <code>.</code> composition operator (<code>(b-&gt;c)-&gt;(a-&gt;b)-&gt;(a-&gt;c)</code>)
</li>
<li>Use precedencegroups to avoid writing brackets
</li>
<li>Use operators with care.
</li>
<li>Tooling suffers from Free functions + operators (no autocomplete)
</li>
<li>Methods don't compose as well, because they have to be associated with a value all the time
</li>
<li>Pointfree: never refer to the value you are processing, focus on functions and compositions
</li>
</ul>
</div>
</div>
<div id="outline-container-sec-2" class="outline-2">
<h2 id="sec-2"><span class="section-number-2">2</span> Side effects</h2>
<div class="outline-text-2" id="text-2">
<p>
Side effects break composability, eg <code>map $ map f</code> can have
different side effects than <code>map (f . f)</code>, but the same return value.
</p>

<p>
Take for example writing logs.
We can fix the problem of returning logs alongside the computation (<code>(_ x: Int) -&gt; (Int, [String])</code>).
But for this kind of function/operator we need a new <code>compose</code> function that appends the logs from both function executions.
</p>

<div class="org-src-container">

<pre class="src src-swift"><span style="color: #4f97d7; font-weight: bold;">func</span> &gt;=&gt; &lt;A, B, C&gt;<span style="color: #4f97d7;">(</span>
  _ f: <span style="color: #4f97d7; font-weight: bold;">@escaping</span> <span style="color: #bc6ec5;">(</span>A<span style="color: #bc6ec5;">)</span> -&gt; B?,
  _ g: <span style="color: #4f97d7; font-weight: bold;">@escaping</span> <span style="color: #bc6ec5;">(</span>B<span style="color: #bc6ec5;">)</span> -&gt; C?
  <span style="color: #4f97d7;">)</span> -&gt; <span style="color: #4f97d7;">(</span><span style="color: #bc6ec5;">(</span>A<span style="color: #bc6ec5;">)</span> -&gt; C?<span style="color: #4f97d7;">)</span> <span style="color: #4f97d7;">{</span>

  <span style="color: #4f97d7; font-weight: bold;">return</span> <span style="color: #bc6ec5;">{</span> a <span style="color: #4f97d7; font-weight: bold;">in</span>
      <span style="color: #2aa1ae; background-color: #292e34;">// </span><span style="color: #2aa1ae; background-color: #292e34;">same for lists and optionals:</span>
      <span style="color: #bc6ec5; font-weight: bold;">f</span><span style="color: #2d9574;">(</span>a<span style="color: #2d9574;">)</span>.<span style="color: #4f97d7;">flatMap</span><span style="color: #2d9574;">(</span>g<span style="color: #2d9574;">)</span>
  <span style="color: #bc6ec5;">}</span>
<span style="color: #4f97d7;">}</span>
</pre>
</div>
<p>
In haskell, it has type <code>(&gt;=&gt;) :: Monad m =&gt; (a -&gt; m b) -&gt; (b -&gt; m c) -&gt; a -&gt; m c</code>,
forward composition for monadic functions.
</p>

<p>
We can avoid having inputs from side effects with currying.
<code>&lt;&gt;</code> is then defined as function composition for functions that return the input type.
(In haskell this is more generally defined on semigroups, namely: <code>(&lt;&gt;) :: Semigroup a =&gt; a -&gt; a -&gt; a</code>.
</p>
</div>
</div>
<div id="outline-container-sec-3" class="outline-2">
<h2 id="sec-3"><span class="section-number-2">3</span> <span class="label label-primary TODO">TODO</span> UIKit styling with functions</h2>
</div>
<div id="outline-container-sec-4" class="outline-2">
<h2 id="sec-4"><span class="section-number-2">4</span> Algebraic data types</h2>
<div class="outline-text-2" id="text-4">
<p>
Composite types can also be called <i>algebraic data types</i>, because we can do algebra with them.
E.g. if an enum has cases for type A and B we can construct \(A + B\) values from it, where in this notation,
\(A\) and \(B\) denote the number of values that can be constructed in the respective type. For pairs that's \(A * B\).
<code>Void</code> has 1 value and <code>Never</code> 0.
</p>
</div>
<div id="outline-container-sec-4-1" class="outline-3">
<h3 id="sec-4-1"><span class="section-number-3">4.1</span> Exercises</h3>
<div class="outline-text-3" id="text-4-1">
<ol class="org-ol">
<li>Exponential. So for \(A->B\), it has \(B^A\) types. Because we choose a value from set \(B\) \(A\) times.
</li>
<li><code>List&lt;A&gt; = 1 + A * List&lt;A&gt;</code>
</li>
<li><code>Optional&lt;Either&lt;A, B&gt;&gt; = 1 + A + B</code>
<code>!= (A + 1) + (B + 1) = Either&lt;Optional&lt;A&gt;, Optional&lt;B&gt;&gt;</code>.
In the second type there is <code>Left nil</code> and <code>Right nil</code> whereas in the first there is just <code>nil</code> for the absence of values.
</li>
<li><code>Either&lt;Optional&lt;A&gt;, B&gt; = 1+A+B = Optional&lt;Either&lt;A, B&gt;&gt;</code>. They are equivalent.
</li>
<li>Using the previous definitions for Pair and Either:
<div class="org-src-container">

<pre class="src src-swift"><span style="color: #4f97d7; font-weight: bold;">func</span> * &lt;A, B&gt;<span style="color: #4f97d7;">(</span>lhs: A.<span style="color: #4f97d7; font-weight: bold;">Type</span>, rhs: B.<span style="color: #4f97d7; font-weight: bold;">Type</span><span style="color: #4f97d7;">)</span> -&gt; Pair&lt;A, B&gt;.<span style="color: #4f97d7; font-weight: bold;">Type</span> <span style="color: #4f97d7;">{</span>
  <span style="color: #4f97d7; font-weight: bold;">return</span> Pair&lt;A, B&gt;.<span style="color: #4f97d7; font-weight: bold;">self</span>
<span style="color: #4f97d7;">}</span>

<span style="color: #4f97d7; font-weight: bold;">func</span> + &lt;A, B&gt;<span style="color: #4f97d7;">(</span>lhs: A.<span style="color: #4f97d7; font-weight: bold;">Type</span>, rhs: B.<span style="color: #4f97d7; font-weight: bold;">Type</span><span style="color: #4f97d7;">)</span> -&gt; Either&lt;A, B&gt;.<span style="color: #4f97d7; font-weight: bold;">Type</span> <span style="color: #4f97d7;">{</span>
  <span style="color: #4f97d7; font-weight: bold;">return</span> Either&lt;A, B&gt;.<span style="color: #4f97d7; font-weight: bold;">self</span>
<span style="color: #4f97d7;">}</span>
</pre>
</div>
</li>
</ol>
</div>
</div>
</div>
<div id="outline-container-sec-5" class="outline-2">
<h2 id="sec-5"><span class="section-number-2">5</span> Higher order functions</h2>
<div class="outline-text-2" id="text-5">
<p>
How can we fit functions that we work with every day into our composition?
We can define functions that manipulate functions such as <code>curry</code> and <code>flip</code> (equivalent to haskell).
</p>

<p>
How do we deal with methods?
Every method secretly defines a static function, which is already curried in the way that i'ts signature is always
<code>Self -&gt; Arguments -&gt; ReturnType</code>
<i>Zero argument functions</i> can be a problem, because you have these empty parathesis flying around.
Solution: Zurry (zero argument curry).
</p>
<div class="org-src-container">

<pre class="src src-swift"><span style="color: #4f97d7; font-weight: bold;">func</span> <span style="color: #bc6ec5; font-weight: bold;">zurry</span>&lt;A&gt;<span style="color: #4f97d7;">(</span>_ f: <span style="color: #bc6ec5;">()</span> -&gt; A<span style="color: #4f97d7;">)</span> -&gt; A <span style="color: #4f97d7;">{</span>
  <span style="color: #4f97d7; font-weight: bold;">return</span> <span style="color: #bc6ec5; font-weight: bold;">f</span><span style="color: #bc6ec5;">()</span>
<span style="color: #4f97d7;">}</span>
</pre>
</div>

<p>
Generic and <code>throws</code> functions are problematic, but we can redefine functions such as <code>map</code> and <code>filter</code> to free, curried functions.
</p>
<div class="org-src-container">

<pre class="src src-swift"><span style="color: #4f97d7; font-weight: bold;">func</span> <span style="color: #bc6ec5; font-weight: bold;">map</span>&lt;A, B&gt;<span style="color: #4f97d7;">(</span>_ f: <span style="color: #4f97d7; font-weight: bold;">@escaping</span> <span style="color: #bc6ec5;">(</span>A<span style="color: #bc6ec5;">)</span> -&gt; B<span style="color: #4f97d7;">)</span> -&gt; <span style="color: #4f97d7;">(</span><span style="color: #bc6ec5;">[</span>A<span style="color: #bc6ec5;">]</span><span style="color: #4f97d7;">)</span> -&gt; <span style="color: #4f97d7;">[</span>B<span style="color: #4f97d7;">]</span> <span style="color: #4f97d7;">{</span>
  <span style="color: #4f97d7; font-weight: bold;">return</span> <span style="color: #bc6ec5;">{</span> $0.<span style="color: #4f97d7;">map</span><span style="color: #2d9574;">(</span>f<span style="color: #2d9574;">)</span> <span style="color: #bc6ec5;">}</span>
<span style="color: #4f97d7;">}</span>
</pre>
</div>

<p>
What's the point? "When they work, they work really well, saving us a lot of boilerplate. 
When they don’t work, we’re still using the concepts and building intuitions for them."
</p>
</div>
<div id="outline-container-sec-5-1" class="outline-3">
<h3 id="sec-5-1"><span class="section-number-3">5.1</span> Exercises</h3>
<div class="outline-text-3" id="text-5-1">
<ol class="org-ol">
<li>3 argument curry
</li>
</ol>
<div class="org-src-container">

<pre class="src src-swift"><span style="color: #4f97d7; font-weight: bold;">func</span> <span style="color: #bc6ec5; font-weight: bold;">curry</span>&lt;A, B, C, D&gt;<span style="color: #4f97d7;">(</span>_ f: <span style="color: #4f97d7; font-weight: bold;">@escaping</span> <span style="color: #bc6ec5;">(</span>A, B, C<span style="color: #bc6ec5;">)</span> -&gt; D<span style="color: #4f97d7;">)</span> -&gt; <span style="color: #4f97d7;">(</span>A<span style="color: #4f97d7;">)</span> -&gt; <span style="color: #4f97d7;">(</span>B<span style="color: #4f97d7;">)</span> -&gt; <span style="color: #4f97d7;">(</span>C<span style="color: #4f97d7;">)</span> -&gt; D <span style="color: #4f97d7;">{</span>
    <span style="color: #4f97d7; font-weight: bold;">return</span> <span style="color: #bc6ec5;">{</span> a <span style="color: #4f97d7; font-weight: bold;">in</span> <span style="color: #2d9574;">{</span> b <span style="color: #4f97d7; font-weight: bold;">in</span> <span style="color: #67b11d;">{</span> c <span style="color: #4f97d7; font-weight: bold;">in</span> <span style="color: #bc6ec5; font-weight: bold;">f</span><span style="color: #b1951d;">(</span>a, b, c<span style="color: #b1951d;">)</span> <span style="color: #67b11d;">}</span> <span style="color: #2d9574;">}</span> <span style="color: #bc6ec5;">}</span>
<span style="color: #4f97d7;">}</span>
</pre>
</div>
<ol class="org-ol">
<li>With e.g. URL.appendingPathComponent these tricks don't work, because you can not disambiguate the overloads.
</li>
</ol>
<div class="org-src-container">

<pre class="src src-swift"><span style="color: #4f97d7; font-weight: bold;">let</span> urlForPath = <span style="color: #bc6ec5; font-weight: bold;">flip</span><span style="color: #4f97d7;">(</span><span style="color: #bc6ec5; font-weight: bold;">curry</span><span style="color: #bc6ec5;">(</span><span style="color: #4f97d7;">URL</span>.<span style="color: #4f97d7; font-weight: bold;">init</span><span style="color: #2d9574;">(</span>fileURLWithPath:isDirectory:<span style="color: #2d9574;">)</span><span style="color: #bc6ec5;">)</span><span style="color: #4f97d7;">)(</span><span style="color: #a45bad;">true</span><span style="color: #4f97d7;">)</span>
</pre>
</div>
<ol class="org-ol">
<li>As we know from haskell, it's only right associative.
</li>
</ol>
<div class="org-src-container">

<pre class="src src-haskell"><span style="color: #ce537a; font-weight: bold;">A</span><span style="color: #7590db;">-&gt;</span><span style="color: #ce537a; font-weight: bold;">B</span><span style="color: #7590db;">-&gt;</span><span style="color: #ce537a; font-weight: bold;">C</span><span style="color: #7590db;">-&gt;</span><span style="color: #ce537a; font-weight: bold;">D</span> <span style="color: #2aa1ae; background-color: #292e34;">-- </span><span style="color: #2aa1ae; background-color: #292e34;">(A-&gt;(B-&gt;(C-&gt;D)))</span>
</pre>
</div>
<ol class="org-ol">
<li>uncurry
</li>
</ol>
<div class="org-src-container">

<pre class="src src-swift"><span style="color: #4f97d7; font-weight: bold;">func</span> <span style="color: #bc6ec5; font-weight: bold;">uncurry</span>&lt;A, B, C&gt;<span style="color: #4f97d7;">(</span>_ f: <span style="color: #4f97d7; font-weight: bold;">@escaping</span> <span style="color: #bc6ec5;">(</span>A<span style="color: #bc6ec5;">)</span> -&gt; <span style="color: #bc6ec5;">(</span>B<span style="color: #bc6ec5;">)</span> -&gt; C<span style="color: #4f97d7;">)</span> -&gt; <span style="color: #4f97d7;">(</span>A, B<span style="color: #4f97d7;">)</span> -&gt; C <span style="color: #4f97d7;">{</span>
    <span style="color: #4f97d7; font-weight: bold;">return</span> <span style="color: #bc6ec5;">{</span> <span style="color: #2d9574;">(</span>a, b<span style="color: #2d9574;">)</span> <span style="color: #4f97d7; font-weight: bold;">in</span> <span style="color: #bc6ec5; font-weight: bold;">f</span><span style="color: #2d9574;">(</span>a<span style="color: #2d9574;">)(</span>b<span style="color: #2d9574;">)</span> <span style="color: #bc6ec5;">}</span>
<span style="color: #4f97d7;">}</span>
</pre>
</div>
<ol class="org-ol">
<li>reduce
</li>
</ol>
<div class="org-src-container">

<pre class="src src-swift"><span style="color: #4f97d7; font-weight: bold;">func</span> <span style="color: #bc6ec5; font-weight: bold;">reduce</span>&lt;A,E&gt;<span style="color: #4f97d7;">(</span>f: <span style="color: #4f97d7; font-weight: bold;">@escaping</span><span style="color: #bc6ec5;">(</span>A,E<span style="color: #bc6ec5;">)</span> -&gt; A<span style="color: #4f97d7;">)</span> -&gt; <span style="color: #4f97d7;">(</span><span style="color: #bc6ec5;">[</span>E<span style="color: #bc6ec5;">]</span><span style="color: #4f97d7;">)</span> -&gt; <span style="color: #4f97d7;">(</span>A<span style="color: #4f97d7;">)</span> -&gt; A <span style="color: #4f97d7;">{</span>
    <span style="color: #4f97d7; font-weight: bold;">return</span> <span style="color: #bc6ec5;">{</span> l <span style="color: #4f97d7; font-weight: bold;">in</span> <span style="color: #2d9574;">{</span> i <span style="color: #4f97d7; font-weight: bold;">in</span>
                   l.<span style="color: #4f97d7;">reduce</span><span style="color: #67b11d;">(</span>i, f<span style="color: #67b11d;">)</span>
    <span style="color: #2d9574;">}</span><span style="color: #bc6ec5;">}</span>
<span style="color: #4f97d7;">}</span>
</pre>
</div>
<ol class="org-ol">
<li>pseudoEither:
</li>
</ol>
<div class="org-src-container">

<pre class="src src-swift"><span style="color: #4f97d7; font-weight: bold;">struct</span> <span style="color: #bc6ec5; font-weight: bold;">PseudoEither</span>&lt;A, B&gt; <span style="color: #4f97d7;">{</span>
    <span style="color: #4f97d7; font-weight: bold;">let</span> <span style="color: #4f97d7; font-weight: bold;">left</span>: A?
    <span style="color: #4f97d7; font-weight: bold;">let</span> <span style="color: #4f97d7; font-weight: bold;">right</span>: B?
<span style="color: #4f97d7;">}</span>

<span style="color: #4f97d7; font-weight: bold;">func</span> <span style="color: #4f97d7; font-weight: bold;">left</span>&lt;A, B&gt;<span style="color: #4f97d7;">(</span>a: A<span style="color: #4f97d7;">)</span> -&gt; PseudoEither&lt;A, B&gt; <span style="color: #4f97d7;">{</span>
    <span style="color: #bc6ec5; font-weight: bold;">PseudoEither</span><span style="color: #bc6ec5;">(</span><span style="color: #4f97d7; font-weight: bold;">left</span>: a, <span style="color: #4f97d7; font-weight: bold;">right</span>: <span style="color: #a45bad;">nil</span><span style="color: #bc6ec5;">)</span>
<span style="color: #4f97d7;">}</span>

<span style="color: #4f97d7; font-weight: bold;">func</span> <span style="color: #4f97d7; font-weight: bold;">right</span>&lt;A, B&gt;<span style="color: #4f97d7;">(</span>b: B<span style="color: #4f97d7;">)</span>-&gt; PseudoEither&lt;A, B&gt; <span style="color: #4f97d7;">{</span>
    <span style="color: #bc6ec5; font-weight: bold;">PseudoEither</span><span style="color: #bc6ec5;">(</span><span style="color: #4f97d7; font-weight: bold;">left</span>: <span style="color: #a45bad;">nil</span>, <span style="color: #4f97d7; font-weight: bold;">right</span>: b<span style="color: #bc6ec5;">)</span>
<span style="color: #4f97d7;">}</span>

<span style="color: #4f97d7; font-weight: bold;">let</span> x: PseudoEither&lt;<span style="color: #4f97d7;">String</span>, <span style="color: #4f97d7;">Int</span>&gt; = <span style="color: #4f97d7; font-weight: bold;">left</span><span style="color: #4f97d7;">(</span>a: <span style="color: #2d9574;">"wuff"</span><span style="color: #4f97d7;">)</span>
<span style="color: #4f97d7; font-weight: bold;">let</span> y: PseudoEither&lt;<span style="color: #4f97d7;">String</span>, <span style="color: #4f97d7;">Int</span>&gt; = <span style="color: #4f97d7; font-weight: bold;">right</span><span style="color: #4f97d7;">(</span>b: <span style="color: #a45bad;">42</span><span style="color: #4f97d7;">)</span>
</pre>
</div>
<ol class="org-ol">
<li>nested map
</li>
</ol>
<div class="org-src-container">

<pre class="src src-swift"><span style="color: #4f97d7; font-weight: bold;">let</span> arr = <span style="color: #4f97d7;">[</span><span style="color: #bc6ec5;">[</span><span style="color: #a45bad;">1</span>, <span style="color: #a45bad;">2</span><span style="color: #bc6ec5;">]</span>, <span style="color: #bc6ec5;">[</span><span style="color: #a45bad;">3</span>, <span style="color: #a45bad;">4</span><span style="color: #bc6ec5;">]</span><span style="color: #4f97d7;">]</span>
<span style="color: #4f97d7;">(</span><span style="color: #bc6ec5;">(</span>map &gt;&gt;&gt; map<span style="color: #bc6ec5;">)</span> <span style="color: #bc6ec5;">{</span> $0 + <span style="color: #a45bad;">1</span> <span style="color: #bc6ec5;">}</span><span style="color: #4f97d7;">)</span> <span style="color: #4f97d7;">(</span>arr<span style="color: #4f97d7;">)</span> <span style="color: #2aa1ae; background-color: #292e34;">// </span><span style="color: #2aa1ae; background-color: #292e34;">[[2, 3], [4, 5]]</span>
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-sec-6" class="outline-2">
<h2 id="sec-6"><span class="section-number-2">6</span> Functional setters</h2>
<div class="outline-text-2" id="text-6">
<p>
If you modify data structures (by returning a copy), you will end up repeating a lot of code for transforming just one value.
Solution: Define generic functions for applying a function on a property.
This reduces boilerplate especially when types are modified, because you need a new copy everytime the type changes.
</p>
<div class="org-src-container">

<pre class="src src-swift">pair
  |&gt; <span style="color: #bc6ec5; font-weight: bold;">first</span><span style="color: #4f97d7;">(</span>incr<span style="color: #4f97d7;">)</span>
  |&gt; <span style="color: #bc6ec5; font-weight: bold;">first</span><span style="color: #4f97d7;">(</span><span style="color: #4f97d7;">String</span>.<span style="color: #4f97d7; font-weight: bold;">init</span><span style="color: #4f97d7;">)</span>
  |&gt; <span style="color: #bc6ec5; font-weight: bold;">second</span><span style="color: #4f97d7;">(</span><span style="color: #bc6ec5; font-weight: bold;">zurry</span><span style="color: #bc6ec5;">(</span><span style="color: #bc6ec5; font-weight: bold;">flip</span><span style="color: #2d9574;">(</span><span style="color: #4f97d7;">String</span>.<span style="color: #4f97d7;">uppercased</span><span style="color: #2d9574;">)</span><span style="color: #bc6ec5;">)</span><span style="color: #4f97d7;">)</span>
<span style="color: #2aa1ae; background-color: #292e34;">// </span><span style="color: #2aa1ae; background-color: #292e34;">("43", "SWIFT")</span>
</pre>
</div>
<p>
To compose functions within setters, we need to take care that it is done in the correct order.
E.g.
</p>
<div class="org-src-container">

<pre class="src src-swift">  <span style="color: #4f97d7; font-weight: bold;">let</span> nested = <span style="color: #4f97d7;">(</span><span style="color: #bc6ec5;">(</span><span style="color: #a45bad;">1</span>, <span style="color: #a45bad;">true</span><span style="color: #bc6ec5;">)</span>, <span style="color: #2d9574;">"Swift"</span><span style="color: #4f97d7;">)</span>
  nested
  |&gt; <span style="color: #4f97d7;">(</span>second &gt;&gt;&gt; first<span style="color: #4f97d7;">)</span> <span style="color: #4f97d7;">{</span> <span style="color: #a45bad;">!</span>$0 <span style="color: #4f97d7;">}</span>
<span style="color: #2aa1ae; background-color: #292e34;">// </span><span style="color: #2aa1ae; background-color: #292e34;">((1, false), "Swift")</span>
</pre>
</div>
<p>
Setter composition <i>composes backwards</i>.
Setters <i>lift</i> a transformation on an individual value into a function operating
on the surrounding datatype.
</p>
</div>
<div id="outline-container-sec-6-1" class="outline-3">
<h3 id="sec-6-1"><span class="section-number-3">6.1</span> Exercises</h3>
<div class="outline-text-3" id="text-6-1">
<ol class="org-ol">
<li>optional setters
</li>
</ol>
<div class="org-src-container">

<pre class="src src-swift"><span style="color: #4f97d7; font-weight: bold;">func</span> <span style="color: #bc6ec5; font-weight: bold;">map</span>&lt;A&gt;<span style="color: #4f97d7;">(</span>f: <span style="color: #4f97d7; font-weight: bold;">@escaping</span> <span style="color: #bc6ec5;">(</span><span style="color: #2d9574;">(</span>A<span style="color: #2d9574;">)</span>-&gt;A<span style="color: #bc6ec5;">)</span><span style="color: #4f97d7;">)</span> -&gt; <span style="color: #4f97d7;">(</span>A?<span style="color: #4f97d7;">)</span> -&gt; A? <span style="color: #4f97d7;">{</span>
    <span style="color: #bc6ec5;">{</span> <span style="color: #4f97d7; font-weight: bold;">optional</span> <span style="color: #4f97d7; font-weight: bold;">in</span>
        <span style="color: #4f97d7; font-weight: bold;">optional</span>.<span style="color: #4f97d7;">flatMap</span><span style="color: #2d9574;">(</span>f<span style="color: #2d9574;">)</span>
    <span style="color: #bc6ec5;">}</span>
<span style="color: #4f97d7;">}</span>
<span style="color: #4f97d7; font-weight: bold;">struct</span> <span style="color: #bc6ec5; font-weight: bold;">Dog</span> <span style="color: #4f97d7;">{</span>
    <span style="color: #4f97d7; font-weight: bold;">let</span> age: <span style="color: #4f97d7;">Int</span>?
    <span style="color: #4f97d7; font-weight: bold;">let</span> name: <span style="color: #4f97d7;">String</span>
<span style="color: #4f97d7;">}</span>

<span style="color: #4f97d7; font-weight: bold;">func</span> <span style="color: #bc6ec5; font-weight: bold;">propDogAge</span><span style="color: #4f97d7;">(</span>f: <span style="color: #4f97d7; font-weight: bold;">@escaping</span> <span style="color: #bc6ec5;">(</span><span style="color: #4f97d7;">Int</span><span style="color: #bc6ec5;">)</span> -&gt; <span style="color: #4f97d7;">Int</span><span style="color: #4f97d7;">)</span> -&gt; <span style="color: #4f97d7;">(</span>Dog<span style="color: #4f97d7;">)</span> -&gt; Dog <span style="color: #4f97d7;">{</span>
    <span style="color: #bc6ec5;">{</span> dog <span style="color: #4f97d7; font-weight: bold;">in</span>
        <span style="color: #bc6ec5; font-weight: bold;">Dog</span><span style="color: #2d9574;">(</span>age: <span style="color: #bc6ec5; font-weight: bold;">map</span><span style="color: #67b11d;">(</span>f: f<span style="color: #67b11d;">)(</span>dog.<span style="color: #4f97d7;">age</span><span style="color: #67b11d;">)</span>, name: dog.<span style="color: #4f97d7;">name</span><span style="color: #2d9574;">)</span>
    <span style="color: #bc6ec5;">}</span>
<span style="color: #4f97d7;">}</span>

<span style="color: #4f97d7; font-weight: bold;">let</span> snoopy = <span style="color: #bc6ec5; font-weight: bold;">Dog</span><span style="color: #4f97d7;">(</span>age: <span style="color: #a45bad;">1</span>, name: <span style="color: #2d9574;">"snoopy"</span><span style="color: #4f97d7;">)</span>

snoopy |&gt;
  <span style="color: #bc6ec5; font-weight: bold;">propDogAge</span><span style="color: #4f97d7;">(</span>f: <span style="color: #bc6ec5;">{</span> n <span style="color: #4f97d7; font-weight: bold;">in</span> n+<span style="color: #a45bad;">1</span> <span style="color: #bc6ec5;">}</span><span style="color: #4f97d7;">)</span>
</pre>
</div>
<ol class="org-ol">
<li>For the <code>Dog</code> struct above:
</li>
</ol>
<div class="org-src-container">

<pre class="src src-swift"><span style="color: #4f97d7; font-weight: bold;">func</span> <span style="color: #bc6ec5; font-weight: bold;">propDogName</span><span style="color: #4f97d7;">(</span>f: <span style="color: #4f97d7; font-weight: bold;">@escaping</span> <span style="color: #bc6ec5;">(</span><span style="color: #4f97d7;">String</span><span style="color: #bc6ec5;">)</span> -&gt; <span style="color: #4f97d7;">String</span><span style="color: #4f97d7;">)</span> -&gt; <span style="color: #4f97d7;">(</span>Dog<span style="color: #4f97d7;">)</span> -&gt; Dog <span style="color: #4f97d7;">{</span>
    <span style="color: #bc6ec5;">{</span> dog <span style="color: #4f97d7; font-weight: bold;">in</span>
        <span style="color: #bc6ec5; font-weight: bold;">Dog</span><span style="color: #2d9574;">(</span>age: dog.<span style="color: #4f97d7;">age</span>, name: <span style="color: #bc6ec5; font-weight: bold;">f</span><span style="color: #67b11d;">(</span>dog.<span style="color: #4f97d7;">name</span><span style="color: #67b11d;">)</span><span style="color: #2d9574;">)</span>
    <span style="color: #bc6ec5;">}</span>
<span style="color: #4f97d7;">}</span>
</pre>
</div>
<p>
Problems: Setters are a lot of boilerplate, and it doesn't scale well with many properties
</p>
<ol class="org-ol">
<li></li>
</ol>
<div class="org-src-container">

<pre class="src src-swift"><span style="color: #4f97d7; font-weight: bold;">struct</span> <span style="color: #bc6ec5; font-weight: bold;">Dog</span> <span style="color: #4f97d7;">{</span>
    <span style="color: #4f97d7; font-weight: bold;">let</span> name: <span style="color: #4f97d7;">String</span>
    <span style="color: #4f97d7; font-weight: bold;">let</span> location: Location
<span style="color: #4f97d7;">}</span>

<span style="color: #4f97d7; font-weight: bold;">struct</span> <span style="color: #bc6ec5; font-weight: bold;">Location</span> <span style="color: #4f97d7;">{</span>
    <span style="color: #4f97d7; font-weight: bold;">let</span> name: <span style="color: #4f97d7;">String</span>
<span style="color: #4f97d7;">}</span>

<span style="color: #4f97d7; font-weight: bold;">func</span> <span style="color: #bc6ec5; font-weight: bold;">dogLocationName</span><span style="color: #4f97d7;">(</span>f: <span style="color: #4f97d7; font-weight: bold;">@escaping</span> <span style="color: #bc6ec5;">(</span><span style="color: #4f97d7;">String</span><span style="color: #bc6ec5;">)</span> -&gt; <span style="color: #4f97d7;">String</span><span style="color: #4f97d7;">)</span> -&gt; <span style="color: #4f97d7;">(</span>Dog<span style="color: #4f97d7;">)</span> -&gt; Dog <span style="color: #4f97d7;">{</span>
    <span style="color: #bc6ec5;">{</span> dog <span style="color: #4f97d7; font-weight: bold;">in</span>
        <span style="color: #bc6ec5; font-weight: bold;">Dog</span><span style="color: #2d9574;">(</span>name: <span style="color: #bc6ec5; font-weight: bold;">f</span><span style="color: #67b11d;">(</span>dog.<span style="color: #4f97d7;">name</span><span style="color: #67b11d;">)</span>, location: <span style="color: #bc6ec5; font-weight: bold;">Location</span><span style="color: #67b11d;">(</span>name: <span style="color: #bc6ec5; font-weight: bold;">f</span><span style="color: #b1951d;">(</span>dog.<span style="color: #7590db;">location</span>.<span style="color: #4f97d7;">name</span><span style="color: #b1951d;">)</span><span style="color: #67b11d;">)</span><span style="color: #2d9574;">)</span>
    <span style="color: #bc6ec5;">}</span>
<span style="color: #4f97d7;">}</span>

<span style="color: #4f97d7; font-weight: bold;">func</span> <span style="color: #bc6ec5; font-weight: bold;">dogLocation</span><span style="color: #4f97d7;">(</span>f: <span style="color: #4f97d7; font-weight: bold;">@escaping</span> <span style="color: #bc6ec5;">(</span>Location<span style="color: #bc6ec5;">)</span> -&gt; Location<span style="color: #4f97d7;">)</span> -&gt; <span style="color: #4f97d7;">(</span>Dog<span style="color: #4f97d7;">)</span> -&gt; Dog <span style="color: #4f97d7;">{</span>
    <span style="color: #bc6ec5;">{</span> dog <span style="color: #4f97d7; font-weight: bold;">in</span>
        <span style="color: #bc6ec5; font-weight: bold;">Dog</span><span style="color: #2d9574;">(</span>name: dog.<span style="color: #4f97d7;">name</span>, location: <span style="color: #bc6ec5; font-weight: bold;">f</span><span style="color: #67b11d;">(</span>dog.<span style="color: #7590db;">location</span><span style="color: #67b11d;">)</span><span style="color: #2d9574;">)</span>
    <span style="color: #bc6ec5;">}</span>
<span style="color: #4f97d7;">}</span>

<span style="color: #4f97d7; font-weight: bold;">func</span> <span style="color: #bc6ec5; font-weight: bold;">locationName</span><span style="color: #4f97d7;">(</span>f: <span style="color: #4f97d7; font-weight: bold;">@escaping</span> <span style="color: #bc6ec5;">(</span><span style="color: #4f97d7;">String</span><span style="color: #bc6ec5;">)</span> -&gt; <span style="color: #4f97d7;">String</span><span style="color: #4f97d7;">)</span> -&gt; <span style="color: #4f97d7;">(</span>Location<span style="color: #4f97d7;">)</span> -&gt; Location <span style="color: #4f97d7;">{</span>
    <span style="color: #bc6ec5;">{</span> location <span style="color: #4f97d7; font-weight: bold;">in</span>
        <span style="color: #bc6ec5; font-weight: bold;">Location</span><span style="color: #2d9574;">(</span>name: <span style="color: #bc6ec5; font-weight: bold;">f</span><span style="color: #67b11d;">(</span>location.<span style="color: #4f97d7;">name</span><span style="color: #67b11d;">)</span><span style="color: #2d9574;">)</span>
    <span style="color: #bc6ec5;">}</span>
<span style="color: #4f97d7;">}</span>

<span style="color: #4f97d7; font-weight: bold;">let</span> snoopy = <span style="color: #bc6ec5; font-weight: bold;">Dog</span><span style="color: #4f97d7;">(</span>name: <span style="color: #2d9574;">"snoopy"</span>, location: <span style="color: #bc6ec5; font-weight: bold;">Location</span><span style="color: #bc6ec5;">(</span>name: <span style="color: #2d9574;">"central park"</span><span style="color: #bc6ec5;">)</span><span style="color: #4f97d7;">)</span>

snoopy |&gt; dogLocationName <span style="color: #4f97d7;">{</span> $0 + <span style="color: #2d9574;">"!"</span> <span style="color: #4f97d7;">}</span>
snoopy |&gt; <span style="color: #4f97d7;">(</span>locationName &gt;&gt;&gt; dogLocation<span style="color: #4f97d7;">)</span> <span style="color: #4f97d7;">{</span> $0 + <span style="color: #2d9574;">"!"</span> <span style="color: #4f97d7;">}</span>
snoopy |&gt; <span style="color: #4f97d7;">(</span>dogLocation &lt;&lt;&lt; locationName<span style="color: #4f97d7;">)</span> <span style="color: #4f97d7;">{</span> $0 + <span style="color: #2d9574;">"!"</span> <span style="color: #4f97d7;">}</span>
</pre>
</div>
<ol class="org-ol">
<li>Yes we can, but for each tuple type you have to write these functions again.
</li>
<li>and 6.
</li>
</ol>
<div class="org-src-container">

<pre class="src src-swift"><span style="color: #4f97d7; font-weight: bold;">func</span> <span style="color: #bc6ec5; font-weight: bold;">setKey</span>&lt;K, V&gt;<span style="color: #4f97d7;">(</span>f: <span style="color: #4f97d7; font-weight: bold;">@escaping</span> <span style="color: #bc6ec5;">(</span>V?<span style="color: #bc6ec5;">)</span>-&gt;V?<span style="color: #4f97d7;">)</span> -&gt; <span style="color: #4f97d7;">(</span>K<span style="color: #4f97d7;">)</span> -&gt; <span style="color: #4f97d7;">(</span><span style="color: #4f97d7;">Dictionary</span>&lt;K, V&gt;<span style="color: #4f97d7;">)</span> -&gt; <span style="color: #4f97d7;">Dictionary</span>&lt;K, V&gt; <span style="color: #4f97d7;">{</span>
<span style="color: #bc6ec5;">{</span>
    key <span style="color: #4f97d7; font-weight: bold;">in</span>
    <span style="color: #2d9574;">{</span> dict <span style="color: #4f97d7; font-weight: bold;">in</span> 
        <span style="color: #4f97d7; font-weight: bold;">var</span> dict = dict
        <span style="color: #4f97d7; font-weight: bold;">if</span> dict<span style="color: #67b11d;">[</span>key<span style="color: #67b11d;">]</span> !=  <span style="color: #a45bad;">nil</span> <span style="color: #67b11d;">{</span> <span style="color: #2aa1ae; background-color: #292e34;">// </span><span style="color: #2aa1ae; background-color: #292e34;">6.</span>
            dict<span style="color: #b1951d;">[</span>key<span style="color: #b1951d;">]</span> = <span style="color: #bc6ec5; font-weight: bold;">f</span><span style="color: #b1951d;">(</span>dict<span style="color: #4f97d7;">[</span>key<span style="color: #4f97d7;">]</span><span style="color: #b1951d;">)</span>
        <span style="color: #67b11d;">}</span>
        <span style="color: #4f97d7; font-weight: bold;">return</span> dict
    <span style="color: #2d9574;">}</span>
<span style="color: #bc6ec5;">}</span>
<span style="color: #4f97d7;">}</span>
</pre>
</div>
<ol class="org-ol">
<li>The former is the signature of a setter, with the transformation as first argument. The latter can not be a setter,
because it does not allow for the passing of a transformation value.
In other words: The first signature receives a transformation function \(A \rightarrow B\) whereas the second
receives two values, one of type \(A\) and one of type \(B\).
</li>
</ol>
</div>
</div>
</div>
<div id="outline-container-sec-7" class="outline-2">
<h2 id="sec-7"><span class="section-number-2">7</span> Setters and key paths</h2>
<div class="outline-text-2" id="text-7">
<p>
Key paths are generic over type they apply to, and the specific value, eg.
</p>
<div class="org-src-container">

<pre class="src src-swift"><span style="color: #4f97d7;">KeyPath</span>&lt;User, <span style="color: #4f97d7;">String</span>&gt;
</pre>
</div>
<p>
you can use a keypath with array syntax!
</p>
<div class="org-src-container">

<pre class="src src-swift">user<span style="color: #4f97d7;">[</span>keyPath: \User.<span style="color: #4f97d7;">name</span><span style="color: #4f97d7;">]</span>
</pre>
</div>
<p>
Key paths are compiler generated (generate setters/getters under the hood)
</p>


<p>
Use prop to compose functions over key paths
</p>
<div class="org-src-container">

<pre class="src src-swift"><span style="color: #4f97d7; font-weight: bold;">func</span> <span style="color: #bc6ec5; font-weight: bold;">prop</span>&lt;Root, <span style="color: #4f97d7;">Value</span>&gt;<span style="color: #4f97d7;">(</span>_ kp: <span style="color: #4f97d7;">WritableKeyPath</span>&lt;Root, <span style="color: #4f97d7;">Value</span>&gt;<span style="color: #4f97d7;">)</span>
  -&gt; <span style="color: #4f97d7;">(</span><span style="color: #4f97d7; font-weight: bold;">@escaping</span> <span style="color: #bc6ec5;">(</span><span style="color: #4f97d7;">Value</span><span style="color: #bc6ec5;">)</span> -&gt; <span style="color: #4f97d7;">Value</span><span style="color: #4f97d7;">)</span>
  -&gt; <span style="color: #4f97d7;">(</span>Root<span style="color: #4f97d7;">)</span>
  -&gt; Root

<span style="color: #4f97d7;">(</span><span style="color: #bc6ec5; font-weight: bold;">prop</span><span style="color: #bc6ec5;">(</span>\User.<span style="color: #4f97d7;">name</span><span style="color: #bc6ec5;">)</span><span style="color: #4f97d7;">)</span> <span style="color: #4f97d7;">{</span> $0.<span style="color: #4f97d7;">uppercased</span><span style="color: #bc6ec5;">()</span> <span style="color: #4f97d7;">}</span> <span style="color: #2aa1ae; background-color: #292e34;">// </span><span style="color: #2aa1ae; background-color: #292e34;">User -&gt; User</span>
<span style="color: #2aa1ae; background-color: #292e34;">// </span><span style="color: #2aa1ae; background-color: #292e34;">composing:</span>
<span style="color: #bc6ec5; font-weight: bold;">prop</span><span style="color: #4f97d7;">(</span>\User.<span style="color: #7590db;">location</span><span style="color: #4f97d7;">)</span> &lt;&lt;&lt; <span style="color: #bc6ec5; font-weight: bold;">prop</span><span style="color: #4f97d7;">(</span>\Location.<span style="color: #4f97d7;">name</span><span style="color: #4f97d7;">)</span>
<span style="color: #2aa1ae; background-color: #292e34;">// </span><span style="color: #2aa1ae; background-color: #292e34;">((String) -&gt; String) -&gt; (User) -&gt; User</span>
<span style="color: #2aa1ae; background-color: #292e34;">// </span><span style="color: #2aa1ae; background-color: #292e34;">Even though that's equivalent to \User.location.name</span>
</pre>
</div>

<p>
<code>prop</code> allows you to write neat date formatters, URLrequest configurations etc.
pointfree in one expression (without computed props/stateful funcs)..
</p>
</div>
<div id="outline-container-sec-7-1" class="outline-3">
<h3 id="sec-7-1"><span class="section-number-3">7.1</span> Exercises</h3>
<div class="outline-text-3" id="text-7-1">
<ol class="org-ol">
<li>Dictionary’s subscript key path.
<div class="org-src-container">

<pre class="src src-swift"><span style="color: #4f97d7;">(</span><span style="color: #bc6ec5;">(</span><span style="color: #4f97d7;">Value</span>?<span style="color: #bc6ec5;">)</span> -&gt; <span style="color: #4f97d7;">Value</span>?<span style="color: #4f97d7;">)</span> -&gt; <span style="color: #4f97d7;">Dictionary</span>&lt;<span style="color: #4f97d7;">Key</span>, <span style="color: #4f97d7;">Value</span>&gt; -&gt; <span style="color: #4f97d7;">Dictionary</span>&lt;<span style="color: #4f97d7;">Key</span>, <span style="color: #4f97d7;">Value</span>&gt;
</pre>
</div>
<p>
The difference when piping map is that the optional in the signature vanishes, because we lift the
transformation in it's monadic context (the monad being the maybe monad).
</p>
</li>
<li>Functional setters for sets
<div class="org-src-container">

<pre class="src src-swift"><span style="color: #4f97d7; font-weight: bold;">func</span> <span style="color: #bc6ec5; font-weight: bold;">elem</span>&lt;A&gt;<span style="color: #4f97d7;">(</span>_ a: <span style="color: #bc6ec5;">(</span>A<span style="color: #bc6ec5;">)</span><span style="color: #4f97d7;">)</span> -&gt; <span style="color: #4f97d7;">(</span><span style="color: #4f97d7; font-weight: bold;">@escaping</span> <span style="color: #bc6ec5;">(</span><span style="color: #4f97d7;">Bool</span><span style="color: #bc6ec5;">)</span> -&gt; <span style="color: #4f97d7;">Bool</span><span style="color: #4f97d7;">)</span> -&gt; <span style="color: #4f97d7;">(</span><span style="color: #4f97d7;">Set</span>&lt;A&gt;<span style="color: #4f97d7;">)</span> -&gt; <span style="color: #4f97d7;">Set</span>&lt;A&gt; <span style="color: #4f97d7;">{</span>
    <span style="color: #bc6ec5;">{</span> f <span style="color: #4f97d7; font-weight: bold;">in</span>
        <span style="color: #2d9574;">{</span> <span style="color: #4f97d7; font-weight: bold;">set</span> <span style="color: #4f97d7; font-weight: bold;">in</span>
            <span style="color: #4f97d7; font-weight: bold;">var</span> <span style="color: #4f97d7; font-weight: bold;">set</span> = <span style="color: #4f97d7; font-weight: bold;">set</span>
            <span style="color: #4f97d7; font-weight: bold;">if</span> <span style="color: #67b11d;">(</span><span style="color: #bc6ec5; font-weight: bold;">f</span><span style="color: #b1951d;">(</span><span style="color: #4f97d7; font-weight: bold;">set</span>.<span style="color: #4f97d7;">contains</span><span style="color: #4f97d7;">(</span>a<span style="color: #4f97d7;">)</span><span style="color: #b1951d;">)</span><span style="color: #67b11d;">)</span> <span style="color: #67b11d;">{</span>
                <span style="color: #4f97d7; font-weight: bold;">set</span>.<span style="color: #4f97d7;">insert</span><span style="color: #b1951d;">(</span>a<span style="color: #b1951d;">)</span>
            <span style="color: #67b11d;">}</span>
            <span style="color: #4f97d7; font-weight: bold;">return</span> <span style="color: #4f97d7; font-weight: bold;">set</span>
        <span style="color: #2d9574;">}</span>
    <span style="color: #bc6ec5;">}</span>
<span style="color: #4f97d7;">}</span>
</pre>
</div>
</li>
<li>Array subscript key path on user
Guess i misunderstood the task
<div class="org-src-container">

<pre class="src src-swift"><span style="color: #bc6ec5; font-weight: bold;">prop</span><span style="color: #4f97d7;">(</span>\User.<span style="color: #7590db;">favoriteFoods</span><span style="color: #4f97d7;">)(</span><span style="color: #bc6ec5;">{</span>
    <span style="color: #4f97d7; font-weight: bold;">if</span> $0.<span style="color: #4f97d7;">isEmpty</span> <span style="color: #2d9574;">{</span>
        <span style="color: #4f97d7; font-weight: bold;">return</span> <span style="color: #67b11d;">[]</span>
    <span style="color: #2d9574;">}</span> <span style="color: #4f97d7; font-weight: bold;">else</span> <span style="color: #2d9574;">{</span>
        <span style="color: #4f97d7; font-weight: bold;">return</span> <span style="color: #67b11d;">[</span>$0.<span style="color: #4f97d7;">first</span>!.<span style="color: #4f97d7;">uppercased</span><span style="color: #b1951d;">()</span><span style="color: #67b11d;">]</span> + <span style="color: #4f97d7;">Array</span><span style="color: #67b11d;">(</span>$0.<span style="color: #4f97d7;">dropFirst</span><span style="color: #b1951d;">()</span><span style="color: #67b11d;">)</span>
    <span style="color: #2d9574;">}</span>
<span style="color: #bc6ec5;">}</span><span style="color: #4f97d7;">)</span>
</pre>
</div>
<p>
correctAnswer:
</p>
<div class="org-src-container">

<pre class="src src-swift"><span style="color: #4f97d7;">(</span><span style="color: #bc6ec5; font-weight: bold;">prop</span><span style="color: #bc6ec5;">(</span>\User.<span style="color: #7590db;">favoriteFoods</span><span style="color: #2d9574;">[</span><span style="color: #a45bad;">0</span><span style="color: #2d9574;">]</span>.<span style="color: #4f97d7;">name</span><span style="color: #bc6ec5;">)</span><span style="color: #4f97d7;">)</span> <span style="color: #4f97d7;">{</span> $0.<span style="color: #4f97d7;">uppercased</span><span style="color: #bc6ec5;">()</span> <span style="color: #4f97d7;">}</span>
</pre>
</div>
</li>
<li>filtering in place
<div class="org-src-container">

<pre class="src src-swift"><span style="color: #4f97d7;">(</span><span style="color: #bc6ec5; font-weight: bold;">prop</span><span style="color: #bc6ec5;">(</span>\User.<span style="color: #7590db;">favoriteFoods</span><span style="color: #bc6ec5;">)</span> &lt;&lt;&lt; filter<span style="color: #4f97d7;">)</span> <span style="color: #2aa1ae; background-color: #292e34;">// </span><span style="color: #2aa1ae; background-color: #292e34;">(String -&gt; Bool) -&gt; User -&gt; User</span>
</pre>
</div>
</li>
<li>We will use <code>Result&lt;Value, Error&gt;</code> from <code>Foundation</code>.
<div class="org-src-container">

<pre class="src src-swift"><span style="color: #4f97d7; font-weight: bold;">let</span> result = <span style="color: #4f97d7;">Result</span>&lt;<span style="color: #4f97d7;">Int</span>, <span style="color: #4f97d7;">Error</span>&gt;.<span style="color: #4f97d7;">success</span><span style="color: #4f97d7;">(</span><span style="color: #a45bad;">1</span><span style="color: #4f97d7;">)</span>
<span style="color: #4f97d7; font-weight: bold;">func</span> <span style="color: #bc6ec5; font-weight: bold;">value</span>&lt;V, E&gt;<span style="color: #4f97d7;">(</span>f: <span style="color: #4f97d7; font-weight: bold;">@escaping</span> <span style="color: #bc6ec5;">(</span><span style="color: #2d9574;">(</span>V<span style="color: #2d9574;">)</span>-&gt;V<span style="color: #bc6ec5;">)</span><span style="color: #4f97d7;">)</span> -&gt; <span style="color: #4f97d7;">(</span><span style="color: #4f97d7;">Result</span>&lt;V, E&gt;<span style="color: #4f97d7;">)</span> -&gt; <span style="color: #4f97d7;">(</span><span style="color: #4f97d7;">Result</span>&lt;V, E&gt;<span style="color: #4f97d7;">)</span> <span style="color: #4f97d7;">{</span>
    <span style="color: #bc6ec5;">{</span> res <span style="color: #4f97d7; font-weight: bold;">in</span>
        <span style="color: #4f97d7; font-weight: bold;">switch</span> res <span style="color: #2d9574;">{</span>
        <span style="color: #4f97d7; font-weight: bold;">case</span> .<span style="color: #4f97d7;">failure</span>:
            <span style="color: #4f97d7; font-weight: bold;">return</span> res
        <span style="color: #4f97d7; font-weight: bold;">case</span> .<span style="color: #4f97d7;">success</span><span style="color: #67b11d;">(</span><span style="color: #4f97d7; font-weight: bold;">let</span> v<span style="color: #67b11d;">)</span>:
            <span style="color: #4f97d7; font-weight: bold;">return</span> <span style="color: #4f97d7;">Result</span>&lt;V, E&gt;.<span style="color: #4f97d7;">success</span><span style="color: #67b11d;">(</span><span style="color: #bc6ec5; font-weight: bold;">f</span><span style="color: #b1951d;">(</span>v<span style="color: #b1951d;">)</span><span style="color: #67b11d;">)</span>
        <span style="color: #2d9574;">}</span>
    <span style="color: #bc6ec5;">}</span>
<span style="color: #4f97d7;">}</span>
<span style="color: #2aa1ae; background-color: #292e34;">// </span><span style="color: #2aa1ae; background-color: #292e34;">Error defined equivalently for failure case.</span>
</pre>
</div>
<ol class="org-ol">
<li>No, there are no key paths for structs (Case paths from pointfree as an alternative)
</li>
<li>e.g. for prop, the mapper function returns Void, and we simply need to call it, rather than re-assigning.
<div class="org-src-container">

<pre class="src src-swift"><span style="color: #4f97d7; font-weight: bold;">func</span> <span style="color: #bc6ec5; font-weight: bold;">inoutProp</span>&lt;Root, <span style="color: #4f97d7;">Value</span>&gt;<span style="color: #4f97d7;">(</span>_ kp: <span style="color: #4f97d7;">WritableKeyPath</span>&lt;Root, <span style="color: #4f97d7;">Value</span>&gt;<span style="color: #4f97d7;">)</span>
-&gt; <span style="color: #4f97d7;">(</span><span style="color: #4f97d7; font-weight: bold;">@escaping</span> <span style="color: #bc6ec5;">(</span><span style="color: #4f97d7; font-weight: bold;">inout</span> <span style="color: #4f97d7;">Value</span><span style="color: #bc6ec5;">)</span> -&gt; <span style="color: #bc6ec5;">()</span><span style="color: #4f97d7;">)</span>
-&gt; <span style="color: #4f97d7;">(</span>Root<span style="color: #4f97d7;">)</span>
-&gt; Root <span style="color: #4f97d7;">{</span>
    <span style="color: #bc6ec5;">{</span> f <span style="color: #4f97d7; font-weight: bold;">in</span>
        <span style="color: #2d9574;">{</span> root <span style="color: #4f97d7; font-weight: bold;">in</span>
            <span style="color: #4f97d7; font-weight: bold;">var</span> root = root
            <span style="color: #bc6ec5; font-weight: bold;">f</span><span style="color: #67b11d;">(</span>&amp;root<span style="color: #b1951d;">[</span>keyPath: kp<span style="color: #b1951d;">]</span><span style="color: #67b11d;">)</span>
            <span style="color: #4f97d7; font-weight: bold;">return</span> root
        <span style="color: #2d9574;">}</span>
    <span style="color: #bc6ec5;">}</span>
<span style="color: #4f97d7;">}</span>
</pre>
</div>
</li>
</ol>
</li>
</ol>
</div>
</div>
</div>

<div id="outline-container-sec-8" class="outline-2">
<h2 id="sec-8"><span class="section-number-2">8</span> Getters and key paths</h2>
<div class="outline-text-2" id="text-8">
<p>
Use <code>get</code> wrapper to bridge between function and keypath world
</p>
<div class="org-src-container">

<pre class="src src-swift"><span style="color: #4f97d7; font-weight: bold;">func</span> <span style="color: #4f97d7; font-weight: bold;">get</span>&lt;Root, <span style="color: #4f97d7;">Value</span>&gt;<span style="color: #4f97d7;">(</span>_ kp: <span style="color: #4f97d7;">KeyPath</span>&lt;Root, <span style="color: #4f97d7;">Value</span>&gt;<span style="color: #4f97d7;">)</span> -&gt; <span style="color: #4f97d7;">(</span>Root<span style="color: #4f97d7;">)</span> -&gt; <span style="color: #4f97d7;">Value</span> <span style="color: #4f97d7;">{</span>
  <span style="color: #4f97d7; font-weight: bold;">return</span> <span style="color: #bc6ec5;">{</span> root <span style="color: #4f97d7; font-weight: bold;">in</span>
    root<span style="color: #2d9574;">[</span>keyPath: kp<span style="color: #2d9574;">]</span>
  <span style="color: #bc6ec5;">}</span>
<span style="color: #4f97d7;">}</span>
</pre>
</div>
<p>
this is nice:
</p>
<div class="org-src-container">

<pre class="src src-swift">users
  .<span style="color: #4f97d7;">filter</span><span style="color: #4f97d7;">(</span><span style="color: #4f97d7; font-weight: bold;">get</span><span style="color: #bc6ec5;">(</span>\.<span style="color: #7590db;">isStaff</span><span style="color: #bc6ec5;">)</span> &gt;&gt;&gt; <span style="color: #bc6ec5;">(</span><span style="color: #a45bad;">!</span><span style="color: #bc6ec5;">)</span><span style="color: #4f97d7;">)</span>
</pre>
</div>
<p>
you can do operators as functions 💡.
</p>

<p>
Generic getters can also be helpful for sorting, max etc. because there you need a compare function
<code>A -&gt; A -&gt; Bool</code>.
With <code>their</code>, we can write
</p>
<div class="org-src-container">

<pre class="src src-swift">users
  .<span style="color: #4f97d7;">max</span><span style="color: #4f97d7;">(</span>by: <span style="color: #bc6ec5; font-weight: bold;">their</span><span style="color: #bc6ec5;">(</span><span style="color: #4f97d7; font-weight: bold;">get</span><span style="color: #2d9574;">(</span>\.<span style="color: #7590db;">email</span><span style="color: #2d9574;">)</span>, &lt;<span style="color: #bc6ec5;">)</span><span style="color: #4f97d7;">)</span> <span style="color: #2aa1ae; background-color: #292e34;">// </span><span style="color: #2aa1ae; background-color: #292e34;">we can also use Comparable instead of passing the compare fn.</span>
</pre>
</div>

<p>
We can also write a wrapper for combining elements in <code>reduce</code>:
</p>
<div class="org-src-container">

<pre class="src src-swift">episodes.<span style="color: #4f97d7;">reduce</span><span style="color: #4f97d7;">(</span><span style="color: #a45bad;">0</span>, <span style="color: #bc6ec5; font-weight: bold;">combining</span><span style="color: #bc6ec5;">(</span><span style="color: #4f97d7; font-weight: bold;">get</span><span style="color: #2d9574;">(</span>\.<span style="color: #7590db;">viewCount</span><span style="color: #2d9574;">)</span>, by: +<span style="color: #bc6ec5;">)</span><span style="color: #4f97d7;">)</span>
</pre>
</div>
<p>
We use get a lot, so you might consider using an operator <code>^</code> as prefix operator.
</p>
</div>

<div id="outline-container-sec-8-1" class="outline-3">
<h3 id="sec-8-1"><span class="section-number-3">8.1</span> Exercises</h3>
<div class="outline-text-3" id="text-8-1">
<ol class="org-ol">
<li>Find three more standard library APIs that can be used with our get and ^ helpers:
<ul class="org-ul">
<li><code>filter</code> a list of items on a boolean property
</li>
<li><code>Dictionary&lt;A, B&gt;.init(grouping:, by:)</code>, grouping by an int property
</li>
<li><code>contains(where:)</code>
</li>
<li>other maps such as <code>compact</code> or <code>flatMap</code>, <code>mapValues</code> etc.
</li>
</ul>
</li>
<li>A getter key-path for zero-argument functions wrapping a property&#x2026;
cant think of others
</li>
<li>I am not sure if this is what is meant:
<div class="org-src-container">

<pre class="src src-swift"><span style="color: #4f97d7; font-weight: bold;">func</span> <span style="color: #bc6ec5; font-weight: bold;">getFoodAttr</span>&lt;T&gt;<span style="color: #4f97d7;">(</span>f: <span style="color: #4f97d7;">KeyPath</span>&lt;Food, T&gt;<span style="color: #4f97d7;">)</span> -&gt; <span style="color: #4f97d7;">(</span>User<span style="color: #4f97d7;">)</span> -&gt; <span style="color: #4f97d7;">[</span>T<span style="color: #4f97d7;">]</span> <span style="color: #4f97d7;">{</span>
    <span style="color: #bc6ec5;">{</span> user <span style="color: #4f97d7; font-weight: bold;">in</span>
        <span style="color: #bc6ec5; font-weight: bold;">map</span><span style="color: #2d9574;">(</span>f: <span style="color: #4f97d7; font-weight: bold;">get</span><span style="color: #67b11d;">(</span>f<span style="color: #67b11d;">)</span><span style="color: #2d9574;">)(</span>user.<span style="color: #7590db;">favoriteFoods</span><span style="color: #2d9574;">)</span>
    <span style="color: #bc6ec5;">}</span>
<span style="color: #4f97d7;">}</span>
<span style="color: #bc6ec5; font-weight: bold;">getFoodAttr</span><span style="color: #4f97d7;">(</span>f: \.<span style="color: #4f97d7;">name</span><span style="color: #4f97d7;">)(</span>user<span style="color: #4f97d7;">)</span> <span style="color: #2aa1ae; background-color: #292e34;">// </span><span style="color: #2aa1ae; background-color: #292e34;">Tacos, Nachos</span>
</pre>
</div>
</li>
<li>Key paths support optional chaining
<div class="org-src-container">

<pre class="src src-swift"><span style="color: #4f97d7; font-weight: bold;">func</span> <span style="color: #bc6ec5; font-weight: bold;">getLocationAttr</span>&lt;T&gt;<span style="color: #4f97d7;">(</span>f: <span style="color: #4f97d7;">KeyPath</span>&lt;Location, T&gt;<span style="color: #4f97d7;">)</span> -&gt; <span style="color: #4f97d7;">(</span>User<span style="color: #4f97d7;">)</span> -&gt; T? <span style="color: #4f97d7;">{</span>
    <span style="color: #bc6ec5;">{</span> user <span style="color: #4f97d7; font-weight: bold;">in</span>
        <span style="color: #bc6ec5; font-weight: bold;">map</span><span style="color: #2d9574;">(</span>f: <span style="color: #4f97d7; font-weight: bold;">get</span><span style="color: #67b11d;">(</span>f<span style="color: #67b11d;">)</span><span style="color: #2d9574;">)(</span>user.<span style="color: #7590db;">location</span><span style="color: #2d9574;">)</span>
    <span style="color: #bc6ec5;">}</span>
<span style="color: #4f97d7;">}</span>
<span style="color: #bc6ec5; font-weight: bold;">getLocationAttr</span><span style="color: #4f97d7;">(</span>f: \.<span style="color: #4f97d7;">name</span><span style="color: #4f97d7;">)(</span>user<span style="color: #4f97d7;">)</span>
<span style="color: #4f97d7; font-weight: bold;">let</span> user2 = <span style="color: #bc6ec5; font-weight: bold;">User</span><span style="color: #4f97d7;">(</span>
    favoriteFoods: <span style="color: #bc6ec5;">[]</span>,
    location: <span style="color: #a45bad;">nil</span>,
    name: <span style="color: #2d9574;">"Blob"</span>
<span style="color: #4f97d7;">)</span>
<span style="color: #4f97d7; font-weight: bold;">get</span><span style="color: #4f97d7;">(</span>\User.<span style="color: #7590db;">location</span>?.<span style="color: #4f97d7;">name</span><span style="color: #4f97d7;">)(</span>user2<span style="color: #4f97d7;">)</span>
</pre>
</div>
</li>
<li>Like this?
<div class="org-src-container">

<pre class="src src-swift"><span style="color: #4f97d7; font-weight: bold;">func</span> <span style="color: #bc6ec5; font-weight: bold;">pluck</span>&lt;V, E&gt;<span style="color: #4f97d7;">(</span>r: <span style="color: #4f97d7;">Result</span>&lt;V, E&gt;<span style="color: #4f97d7;">)</span> -&gt; V? <span style="color: #4f97d7;">{</span>
    <span style="color: #4f97d7; font-weight: bold;">switch</span> r <span style="color: #bc6ec5;">{</span>
    <span style="color: #4f97d7; font-weight: bold;">case</span> .<span style="color: #4f97d7;">success</span><span style="color: #2d9574;">(</span><span style="color: #4f97d7; font-weight: bold;">let</span> v<span style="color: #2d9574;">)</span>:
        <span style="color: #4f97d7; font-weight: bold;">return</span> v
    <span style="color: #4f97d7; font-weight: bold;">default</span>: <span style="color: #4f97d7; font-weight: bold;">return</span> <span style="color: #a45bad;">nil</span>
    <span style="color: #bc6ec5;">}</span>
<span style="color: #4f97d7;">}</span>
<span style="color: #4f97d7; font-weight: bold;">let</span> res: <span style="color: #4f97d7;">Result</span>&lt;User, <span style="color: #4f97d7;">Error</span>&gt; = .<span style="color: #4f97d7;">success</span><span style="color: #4f97d7;">(</span>user<span style="color: #4f97d7;">)</span>
<span style="color: #bc6ec5; font-weight: bold;">map</span><span style="color: #4f97d7;">(</span>f: <span style="color: #4f97d7; font-weight: bold;">get</span><span style="color: #bc6ec5;">(</span>\User.<span style="color: #4f97d7;">name</span><span style="color: #bc6ec5;">)</span><span style="color: #4f97d7;">)(</span><span style="color: #bc6ec5; font-weight: bold;">pluck</span><span style="color: #bc6ec5;">(</span>r: res<span style="color: #bc6ec5;">)</span><span style="color: #4f97d7;">)</span>
</pre>
</div>
</li>
</ol>
<p>
TODO: i don't really understand what is meant with 6,7,8 exercises.
</p>
</div>
</div>
</div>
<div id="outline-container-sec-9" class="outline-2">
<h2 id="sec-9"><span class="section-number-2">9</span> Algebraic Data Types: Exponents</h2>
<div class="outline-text-2" id="text-9">
<p>
As we learned in the exercises from "Algebraic Data Types",
there are \(B^A\) functions of type \(A->B\).
Since \(a^b^c = a^(b*c)\), we can derive that
<code>C-&gt;B-&gt;A = (B, C) -&gt; A</code>.
Shows that curry and uncurry are elemental operations.
Since \(a^1 = a\), we can derive zurry and unzurry.
</p>

<p>
What happens with \(a^0=1\)?
<code>Never -&gt; A = Void</code>
We can define absurd in swift!
</p>

<div class="org-src-container">

<pre class="src src-swift"><span style="color: #4f97d7; font-weight: bold;">func</span> <span style="color: #bc6ec5; font-weight: bold;">to</span>&lt;A&gt;<span style="color: #4f97d7;">(</span>_ f: <span style="color: #bc6ec5;">(</span><span style="color: #4f97d7;">Never</span><span style="color: #bc6ec5;">)</span> -&gt; A<span style="color: #4f97d7;">)</span> -&gt; <span style="color: #4f97d7;">Void</span> <span style="color: #4f97d7;">{</span>
  <span style="color: #4f97d7; font-weight: bold;">return</span> <span style="color: #bc6ec5;">()</span>
<span style="color: #4f97d7;">}</span>
</pre>
</div>
<div class="org-src-container">

<pre class="src src-swift"><span style="color: #4f97d7; font-weight: bold;">func</span> <span style="color: #bc6ec5; font-weight: bold;">from</span>&lt;A&gt;<span style="color: #4f97d7;">(</span>_ x: <span style="color: #4f97d7;">Void</span><span style="color: #4f97d7;">)</span> -&gt; <span style="color: #4f97d7;">(</span><span style="color: #4f97d7;">Never</span><span style="color: #4f97d7;">)</span> -&gt; A <span style="color: #4f97d7;">{</span>
  <span style="color: #4f97d7; font-weight: bold;">return</span> <span style="color: #bc6ec5;">{</span> never <span style="color: #4f97d7; font-weight: bold;">in</span>
    <span style="color: #4f97d7; font-weight: bold;">switch</span> never <span style="color: #2d9574;">{</span>
    <span style="color: #2d9574;">}</span>
  <span style="color: #bc6ec5;">}</span>
<span style="color: #4f97d7;">}</span>
</pre>
</div>
<p>
This can actually be useful, eg. in case of <code>Result&lt;Int, Never&gt;</code>.
</p>

<p>
Remember that <code>inout A -&gt; Void</code> can be transformed to <code>A-&gt;A</code>?
This means that you can refactor <code>(A,B) -&gt; A</code> into <code>(inout A, B) -&gt; Void</code>,
<code>(A, inout B) -&gt; C</code> to <code>(A, B) -&gt; (C, B)</code> and such.
</p>

<p>
We can also see a correspondence between <code>throws</code> and <code>Result&lt;A, Error&gt;</code>.
</p>

<p>
There is also the power law \(a^(b+c) = a^b * a ^ c\), equivalent to
<code>Either&lt;B, C&gt; -&gt; A = (B -&gt; A, C -&gt; A)</code>
</p>

<p>
💡We can use exponent laws to understand which functions can't and can not be simplified.
</p>
</div>

<div id="outline-container-sec-9-1" class="outline-3">
<h3 id="sec-9-1"><span class="section-number-3">9.1</span> Exercises</h3>
<div class="outline-text-3" id="text-9-1">
<ol class="org-ol">
<li>\(1^a = 1\)
<code>Void &lt;- a = Void</code>
<code>a -&gt; Void = Void</code>
<div class="org-src-container">

<pre class="src src-swift"><span style="color: #4f97d7; font-weight: bold;">func</span> <span style="color: #bc6ec5; font-weight: bold;">to</span>&lt;A&gt;<span style="color: #4f97d7;">(</span>a: A<span style="color: #4f97d7;">)</span> -&gt; <span style="color: #4f97d7;">(</span><span style="color: #4f97d7;">Void</span><span style="color: #4f97d7;">)</span> -&gt; <span style="color: #4f97d7;">Void</span> <span style="color: #4f97d7;">{</span>
    <span style="color: #bc6ec5;">{</span> void <span style="color: #4f97d7; font-weight: bold;">in</span> void <span style="color: #bc6ec5;">}</span>
<span style="color: #4f97d7;">}</span>

<span style="color: #4f97d7; font-weight: bold;">func</span> <span style="color: #bc6ec5; font-weight: bold;">from</span>&lt;A&gt;<span style="color: #4f97d7;">(</span>void: <span style="color: #4f97d7;">Void</span><span style="color: #4f97d7;">)</span> -&gt; <span style="color: #4f97d7;">(</span>A<span style="color: #4f97d7;">)</span> -&gt; <span style="color: #4f97d7;">Void</span> <span style="color: #4f97d7;">{</span>
    <span style="color: #bc6ec5;">{</span> a <span style="color: #4f97d7; font-weight: bold;">in</span> void <span style="color: #bc6ec5;">}</span>
<span style="color: #4f97d7;">}</span>
</pre>
</div>
</li>
<li>Case 1: \(0^a = 0 | a != 0\)
<code>a -&gt; Never = Never</code>
<div class="org-src-container">

<pre class="src src-swift"><span style="color: #4f97d7; font-weight: bold;">func</span> <span style="color: #bc6ec5; font-weight: bold;">from</span>&lt;A&gt;<span style="color: #4f97d7;">(</span>a: A<span style="color: #4f97d7;">)</span> -&gt; <span style="color: #4f97d7;">(</span><span style="color: #4f97d7;">Never</span><span style="color: #4f97d7;">)</span> -&gt; <span style="color: #4f97d7;">(</span><span style="color: #4f97d7;">Never</span><span style="color: #4f97d7;">)</span> <span style="color: #4f97d7;">{</span>
    <span style="color: #bc6ec5;">{</span> never <span style="color: #4f97d7; font-weight: bold;">in</span>
        never
    <span style="color: #bc6ec5;">}</span>
<span style="color: #4f97d7;">}</span>

<span style="color: #4f97d7; font-weight: bold;">func</span> <span style="color: #bc6ec5; font-weight: bold;">to</span>&lt;A&gt;<span style="color: #4f97d7;">(</span>never: <span style="color: #4f97d7;">Never</span><span style="color: #4f97d7;">)</span> -&gt; <span style="color: #4f97d7;">(</span>A<span style="color: #4f97d7;">)</span> -&gt; <span style="color: #4f97d7;">(</span><span style="color: #4f97d7;">Never</span><span style="color: #4f97d7;">)</span> <span style="color: #4f97d7;">{</span>
    <span style="color: #bc6ec5;">{</span> a <span style="color: #4f97d7; font-weight: bold;">in</span>
        never
    <span style="color: #bc6ec5;">}</span>
<span style="color: #4f97d7;">}</span>
</pre>
</div>
<p>
Case 2: \(0^a = undefined | a = 0\)
</p>
</li>
<li>We will know in the next "Algebraic data types" episode 😌
</li>
<li><code>2^A = Set&lt;A&gt;</code>
<code>A -&gt; Bool = Set&lt;A&gt;</code>
So we can interpret a set as a function from A to Bool,
that returns true if the element is contained, and false otherwise.
</li>
<li><div class="org-src-container">

<pre class="src src-swift"><span style="color: #4f97d7; font-weight: bold;">func</span> <span style="color: #bc6ec5; font-weight: bold;">intersection</span>&lt;A&gt;<span style="color: #4f97d7;">(</span>a: <span style="color: #4f97d7; font-weight: bold;">@escaping</span> <span style="color: #bc6ec5;">(</span><span style="color: #2d9574;">(</span>A<span style="color: #2d9574;">)</span> -&gt; <span style="color: #4f97d7;">Bool</span><span style="color: #bc6ec5;">)</span>, b: <span style="color: #4f97d7; font-weight: bold;">@escaping</span> <span style="color: #bc6ec5;">(</span>A<span style="color: #bc6ec5;">)</span> -&gt; <span style="color: #bc6ec5;">(</span><span style="color: #4f97d7;">Bool</span><span style="color: #bc6ec5;">)</span><span style="color: #4f97d7;">)</span> -&gt; <span style="color: #4f97d7;">(</span>A<span style="color: #4f97d7;">)</span> -&gt; <span style="color: #4f97d7;">Bool</span> <span style="color: #4f97d7;">{</span>
    <span style="color: #bc6ec5;">{</span> e <span style="color: #4f97d7; font-weight: bold;">in</span>
        <span style="color: #4f97d7; font-weight: bold;">return</span> <span style="color: #bc6ec5; font-weight: bold;">a</span><span style="color: #2d9574;">(</span>e<span style="color: #2d9574;">)</span> &amp;&amp; <span style="color: #bc6ec5; font-weight: bold;">b</span><span style="color: #2d9574;">(</span>e<span style="color: #2d9574;">)</span>
    <span style="color: #bc6ec5;">}</span>
<span style="color: #4f97d7;">}</span>

<span style="color: #4f97d7; font-weight: bold;">func</span> <span style="color: #bc6ec5; font-weight: bold;">union</span>&lt;A&gt;<span style="color: #4f97d7;">(</span>a: <span style="color: #4f97d7; font-weight: bold;">@escaping</span> <span style="color: #bc6ec5;">(</span><span style="color: #2d9574;">(</span>A<span style="color: #2d9574;">)</span> -&gt; <span style="color: #4f97d7;">Bool</span><span style="color: #bc6ec5;">)</span>, b: <span style="color: #4f97d7; font-weight: bold;">@escaping</span> <span style="color: #bc6ec5;">(</span>A<span style="color: #bc6ec5;">)</span> -&gt; <span style="color: #bc6ec5;">(</span><span style="color: #4f97d7;">Bool</span><span style="color: #bc6ec5;">)</span><span style="color: #4f97d7;">)</span> -&gt; <span style="color: #4f97d7;">(</span>A<span style="color: #4f97d7;">)</span> -&gt; <span style="color: #4f97d7;">Bool</span> <span style="color: #4f97d7;">{</span>
    <span style="color: #bc6ec5;">{</span> e <span style="color: #4f97d7; font-weight: bold;">in</span>
        <span style="color: #4f97d7; font-weight: bold;">return</span> <span style="color: #bc6ec5; font-weight: bold;">a</span><span style="color: #2d9574;">(</span>e<span style="color: #2d9574;">)</span> || <span style="color: #bc6ec5; font-weight: bold;">b</span><span style="color: #2d9574;">(</span>e<span style="color: #2d9574;">)</span>
    <span style="color: #bc6ec5;">}</span>
<span style="color: #4f97d7;">}</span>
</pre>
</div>
</li>
<li>\((1+V)^K\)
Because we map from the key space to the value space with one additional element <code>nil</code>.
</li>
<li><div class="org-src-container">

<pre class="src src-swift"><span style="color: #4f97d7; font-weight: bold;">func</span> <span style="color: #bc6ec5; font-weight: bold;">to</span>&lt;A, B, C&gt;<span style="color: #4f97d7;">(</span>_ f: <span style="color: #4f97d7; font-weight: bold;">@escaping</span> <span style="color: #bc6ec5;">(</span>Either&lt;B, C&gt;<span style="color: #bc6ec5;">)</span> -&gt; A<span style="color: #4f97d7;">)</span> -&gt; <span style="color: #4f97d7;">(</span><span style="color: #bc6ec5;">(</span>B<span style="color: #bc6ec5;">)</span> -&gt; A, <span style="color: #bc6ec5;">(</span>C<span style="color: #bc6ec5;">)</span> -&gt; A<span style="color: #4f97d7;">)</span> <span style="color: #4f97d7;">{</span>
    <span style="color: #bc6ec5;">(</span> <span style="color: #2d9574;">{</span> b <span style="color: #4f97d7; font-weight: bold;">in</span> <span style="color: #bc6ec5; font-weight: bold;">f</span><span style="color: #67b11d;">(</span>.<span style="color: #4f97d7; font-weight: bold;">left</span><span style="color: #b1951d;">(</span>b<span style="color: #b1951d;">)</span><span style="color: #67b11d;">)</span> <span style="color: #2d9574;">}</span>
        ,
      <span style="color: #2d9574;">{</span> c <span style="color: #4f97d7; font-weight: bold;">in</span> <span style="color: #bc6ec5; font-weight: bold;">f</span><span style="color: #67b11d;">(</span>.<span style="color: #4f97d7; font-weight: bold;">right</span><span style="color: #b1951d;">(</span>c<span style="color: #b1951d;">)</span><span style="color: #67b11d;">)</span> <span style="color: #2d9574;">}</span>
    <span style="color: #bc6ec5;">)</span>
<span style="color: #4f97d7;">}</span>

<span style="color: #4f97d7; font-weight: bold;">func</span> <span style="color: #bc6ec5; font-weight: bold;">from</span>&lt;A, B, C&gt;<span style="color: #4f97d7;">(</span>_ f: <span style="color: #bc6ec5;">(</span><span style="color: #2d9574;">(</span>B<span style="color: #2d9574;">)</span> -&gt; A, <span style="color: #2d9574;">(</span>C<span style="color: #2d9574;">)</span> -&gt; A<span style="color: #bc6ec5;">)</span><span style="color: #4f97d7;">)</span> -&gt; <span style="color: #4f97d7;">(</span>Either&lt;B, C&gt;<span style="color: #4f97d7;">)</span> -&gt; A <span style="color: #4f97d7;">{</span>
    <span style="color: #4f97d7; font-weight: bold;">let</span> <span style="color: #bc6ec5;">(</span>bToA, cToA<span style="color: #bc6ec5;">)</span> = f
    <span style="color: #4f97d7; font-weight: bold;">return</span> <span style="color: #bc6ec5;">{</span> bc <span style="color: #4f97d7; font-weight: bold;">in</span>
        <span style="color: #4f97d7; font-weight: bold;">switch</span> bc <span style="color: #2d9574;">{</span>
        <span style="color: #4f97d7; font-weight: bold;">case</span> .<span style="color: #4f97d7; font-weight: bold;">left</span><span style="color: #67b11d;">(</span><span style="color: #4f97d7; font-weight: bold;">let</span> b<span style="color: #67b11d;">)</span>:
            <span style="color: #4f97d7; font-weight: bold;">return</span> <span style="color: #bc6ec5; font-weight: bold;">bToA</span><span style="color: #67b11d;">(</span>b<span style="color: #67b11d;">)</span>
        <span style="color: #4f97d7; font-weight: bold;">case</span> .<span style="color: #4f97d7; font-weight: bold;">right</span><span style="color: #67b11d;">(</span><span style="color: #4f97d7; font-weight: bold;">let</span> c<span style="color: #67b11d;">)</span>:
            <span style="color: #4f97d7; font-weight: bold;">return</span> <span style="color: #bc6ec5; font-weight: bold;">cToA</span><span style="color: #67b11d;">(</span>c<span style="color: #67b11d;">)</span>
        <span style="color: #2d9574;">}</span>
    <span style="color: #bc6ec5;">}</span>
<span style="color: #4f97d7;">}</span>
</pre>
</div>
</li>
<li><div class="org-src-container">

<pre class="src src-swift"><span style="color: #4f97d7; font-weight: bold;">func</span> <span style="color: #bc6ec5; font-weight: bold;">to</span>&lt;A, B, C&gt;<span style="color: #4f97d7;">(</span>_ f: <span style="color: #4f97d7; font-weight: bold;">@escaping</span> <span style="color: #bc6ec5;">(</span>C<span style="color: #bc6ec5;">)</span> -&gt; <span style="color: #bc6ec5;">(</span>A, B<span style="color: #bc6ec5;">)</span><span style="color: #4f97d7;">)</span> -&gt; <span style="color: #4f97d7;">(</span><span style="color: #bc6ec5;">(</span>C<span style="color: #bc6ec5;">)</span> -&gt; A, <span style="color: #bc6ec5;">(</span>C<span style="color: #bc6ec5;">)</span> -&gt; B<span style="color: #4f97d7;">)</span> <span style="color: #4f97d7;">{</span>
    <span style="color: #bc6ec5;">(</span> <span style="color: #2d9574;">{</span> c <span style="color: #4f97d7; font-weight: bold;">in</span> <span style="color: #bc6ec5; font-weight: bold;">f</span><span style="color: #67b11d;">(</span>c<span style="color: #67b11d;">)</span>.<span style="color: #a45bad;">0</span> <span style="color: #2d9574;">}</span>
        ,
      <span style="color: #2d9574;">{</span> c <span style="color: #4f97d7; font-weight: bold;">in</span> <span style="color: #bc6ec5; font-weight: bold;">f</span><span style="color: #67b11d;">(</span>c<span style="color: #67b11d;">)</span>.<span style="color: #a45bad;">1</span> <span style="color: #2d9574;">}</span>
    <span style="color: #bc6ec5;">)</span>
<span style="color: #4f97d7;">}</span>

        <span style="color: #4f97d7; font-weight: bold;">func</span> <span style="color: #bc6ec5; font-weight: bold;">from</span>&lt;A, B, C&gt;<span style="color: #4f97d7;">(</span>_ f: <span style="color: #bc6ec5;">(</span><span style="color: #2d9574;">(</span>C<span style="color: #2d9574;">)</span> -&gt; A, <span style="color: #2d9574;">(</span>C<span style="color: #2d9574;">)</span> -&gt; B<span style="color: #bc6ec5;">)</span><span style="color: #4f97d7;">)</span> -&gt; <span style="color: #4f97d7;">(</span>C<span style="color: #4f97d7;">)</span> -&gt; <span style="color: #4f97d7;">(</span>A, B<span style="color: #4f97d7;">)</span> <span style="color: #4f97d7;">{</span>
    <span style="color: #4f97d7; font-weight: bold;">let</span> <span style="color: #bc6ec5;">(</span>cToA, cToB<span style="color: #bc6ec5;">)</span> = f
    <span style="color: #4f97d7; font-weight: bold;">return</span> <span style="color: #bc6ec5;">{</span> c <span style="color: #4f97d7; font-weight: bold;">in</span>
        <span style="color: #2d9574;">(</span><span style="color: #bc6ec5; font-weight: bold;">cToA</span><span style="color: #67b11d;">(</span>c<span style="color: #67b11d;">)</span>, <span style="color: #bc6ec5; font-weight: bold;">cToB</span><span style="color: #67b11d;">(</span>c<span style="color: #67b11d;">)</span><span style="color: #2d9574;">)</span>
    <span style="color: #bc6ec5;">}</span>
<span style="color: #4f97d7;">}</span>

</pre>
</div>
</li>
</ol>
</div>
</div>
</div>

<div id="outline-container-sec-10" class="outline-2">
<h2 id="sec-10"><span class="section-number-2">10</span> A tale of two flat maps</h2>
<div class="outline-text-2" id="text-10">
<p>
<code>flatMap</code> is the mondaic bind.
use <code>compactMap</code> to filter nil values.
</p>
</div>
<div id="outline-container-sec-10-1" class="outline-3">
<h3 id="sec-10-1"><span class="section-number-3">10.1</span> Exercises</h3>
<div class="outline-text-3" id="text-10-1">
<ol class="org-ol">
<li>filtered:
<div class="org-src-container">

<pre class="src src-swift"><span style="color: #4f97d7; font-weight: bold;">func</span> <span style="color: #bc6ec5; font-weight: bold;">filtered</span>&lt;A&gt;<span style="color: #4f97d7;">(</span>_ lst: <span style="color: #bc6ec5;">[</span>A?<span style="color: #bc6ec5;">]</span><span style="color: #4f97d7;">)</span> -&gt; <span style="color: #4f97d7;">[</span>A<span style="color: #4f97d7;">]</span> <span style="color: #4f97d7;">{</span>
    lst.<span style="color: #4f97d7;">compactMap</span> <span style="color: #bc6ec5;">{</span> x <span style="color: #4f97d7; font-weight: bold;">in</span> x <span style="color: #bc6ec5;">}</span>
<span style="color: #4f97d7;">}</span>
</pre>
</div>
</li>
<li><div class="org-src-container">

<pre class="src src-swift"><span style="color: #4f97d7; font-weight: bold;">func</span> <span style="color: #4f97d7; font-weight: bold;">left</span>&lt;A, B&gt;<span style="color: #4f97d7;">(</span>_ either: Either&lt;A, B&gt;<span style="color: #4f97d7;">)</span> -&gt; A? <span style="color: #4f97d7;">{</span>
    <span style="color: #4f97d7; font-weight: bold;">switch</span> either <span style="color: #bc6ec5;">{</span>
    <span style="color: #4f97d7; font-weight: bold;">case</span> .<span style="color: #4f97d7; font-weight: bold;">left</span><span style="color: #2d9574;">(</span><span style="color: #4f97d7; font-weight: bold;">let</span> l<span style="color: #2d9574;">)</span>:
        <span style="color: #4f97d7; font-weight: bold;">return</span> l
    <span style="color: #4f97d7; font-weight: bold;">default</span>:
        <span style="color: #4f97d7; font-weight: bold;">return</span> <span style="color: #a45bad;">nil</span>
    <span style="color: #bc6ec5;">}</span>
<span style="color: #4f97d7;">}</span>

<span style="color: #4f97d7; font-weight: bold;">func</span> <span style="color: #4f97d7; font-weight: bold;">right</span>&lt;A, B&gt;<span style="color: #4f97d7;">(</span>_ either: Either&lt;A, B&gt;<span style="color: #4f97d7;">)</span> -&gt; B? <span style="color: #4f97d7;">{</span>
    <span style="color: #4f97d7; font-weight: bold;">switch</span> either <span style="color: #bc6ec5;">{</span>
    <span style="color: #4f97d7; font-weight: bold;">case</span> .<span style="color: #4f97d7; font-weight: bold;">right</span><span style="color: #2d9574;">(</span><span style="color: #4f97d7; font-weight: bold;">let</span> r<span style="color: #2d9574;">)</span>:
        <span style="color: #4f97d7; font-weight: bold;">return</span> r
    <span style="color: #4f97d7; font-weight: bold;">default</span>:
        <span style="color: #4f97d7; font-weight: bold;">return</span> <span style="color: #a45bad;">nil</span>
    <span style="color: #bc6ec5;">}</span>
<span style="color: #4f97d7;">}</span>

<span style="color: #4f97d7; font-weight: bold;">func</span> <span style="color: #bc6ec5; font-weight: bold;">partitioned</span>&lt;A, B&gt;<span style="color: #4f97d7;">(</span>_ either: <span style="color: #bc6ec5;">[</span>Either&lt;A,B&gt;<span style="color: #bc6ec5;">]</span><span style="color: #4f97d7;">)</span> -&gt; <span style="color: #4f97d7;">(</span><span style="color: #4f97d7; font-weight: bold;">left</span>: <span style="color: #bc6ec5;">[</span>A<span style="color: #bc6ec5;">]</span>, <span style="color: #4f97d7; font-weight: bold;">right</span>: <span style="color: #bc6ec5;">[</span>B<span style="color: #bc6ec5;">]</span><span style="color: #4f97d7;">)</span> <span style="color: #4f97d7;">{</span>
    <span style="color: #bc6ec5;">(</span> either.<span style="color: #4f97d7;">compactMap</span><span style="color: #2d9574;">(</span><span style="color: #4f97d7; font-weight: bold;">left</span><span style="color: #2d9574;">)</span>
        ,
      either.<span style="color: #4f97d7;">compactMap</span><span style="color: #2d9574;">(</span><span style="color: #4f97d7; font-weight: bold;">right</span><span style="color: #2d9574;">)</span>
    <span style="color: #bc6ec5;">)</span>
<span style="color: #4f97d7;">}</span>

</pre>
</div>
</li>
<li><div class="org-src-container">

<pre class="src src-swift"><span style="color: #4f97d7; font-weight: bold;">func</span> <span style="color: #bc6ec5; font-weight: bold;">partitionMap</span>&lt;A, B, C&gt;<span style="color: #4f97d7;">(</span>
    _ <span style="color: #4f97d7; font-weight: bold;">optional</span>: <span style="color: #4f97d7;">Optional</span>&lt;A&gt;,
    _ f: <span style="color: #4f97d7; font-weight: bold;">@escaping</span> <span style="color: #bc6ec5;">(</span><span style="color: #2d9574;">(</span>A<span style="color: #2d9574;">)</span> -&gt; Either&lt;B, C&gt;<span style="color: #bc6ec5;">)</span><span style="color: #4f97d7;">)</span> -&gt; <span style="color: #4f97d7;">(</span><span style="color: #4f97d7;">Optional</span>&lt;B&gt;, <span style="color: #4f97d7;">Optional</span>&lt;C&gt;<span style="color: #4f97d7;">)</span> <span style="color: #4f97d7;">{</span>
    <span style="color: #bc6ec5;">(</span> <span style="color: #4f97d7; font-weight: bold;">optional</span>.<span style="color: #4f97d7;">flatMap</span><span style="color: #2d9574;">(</span>f &gt;&gt;&gt; <span style="color: #4f97d7; font-weight: bold;">left</span><span style="color: #2d9574;">)</span>
        ,
      <span style="color: #4f97d7; font-weight: bold;">optional</span>.<span style="color: #4f97d7;">flatMap</span><span style="color: #2d9574;">(</span>f &gt;&gt;&gt; <span style="color: #4f97d7; font-weight: bold;">right</span><span style="color: #2d9574;">)</span>
    <span style="color: #bc6ec5;">)</span>
<span style="color: #4f97d7;">}</span>
</pre>
</div>
</li>
<li><div class="org-src-container">

<pre class="src src-swift"><span style="color: #4f97d7; font-weight: bold;">func</span> <span style="color: #bc6ec5; font-weight: bold;">filterMapValues</span>&lt;K, V, R&gt;<span style="color: #4f97d7;">(</span>_ d: <span style="color: #4f97d7;">Dictionary</span>&lt;K, V&gt;<span style="color: #4f97d7;">)</span> -&gt; <span style="color: #4f97d7;">(</span><span style="color: #bc6ec5;">(</span>V<span style="color: #bc6ec5;">)</span> -&gt; R?<span style="color: #4f97d7;">)</span> -&gt; <span style="color: #4f97d7;">[</span>R<span style="color: #4f97d7;">]</span> <span style="color: #4f97d7;">{</span> <span style="color: #bc6ec5;">{</span> f <span style="color: #4f97d7; font-weight: bold;">in</span>
    d.<span style="color: #4f97d7;">values</span>.<span style="color: #4f97d7;">compactMap</span><span style="color: #2d9574;">(</span>f<span style="color: #2d9574;">)</span>
<span style="color: #bc6ec5;">}</span>
<span style="color: #4f97d7;">}</span>
</pre>
</div>
</li>
<li><div class="org-src-container">

<pre class="src src-swift"><span style="color: #4f97d7; font-weight: bold;">func</span> <span style="color: #bc6ec5; font-weight: bold;">partitionMapValues</span>&lt;K, V, A, B&gt;<span style="color: #4f97d7;">(</span>_ d: <span style="color: #4f97d7;">Dictionary</span>&lt;K, V&gt;<span style="color: #4f97d7;">)</span> -&gt; <span style="color: #4f97d7;">(</span><span style="color: #bc6ec5;">(</span>V<span style="color: #bc6ec5;">)</span> -&gt; Either&lt;A, B&gt;<span style="color: #4f97d7;">)</span> -&gt; <span style="color: #4f97d7;">(</span>lefts: <span style="color: #bc6ec5;">[</span>A<span style="color: #bc6ec5;">]</span>, rights: <span style="color: #bc6ec5;">[</span>B<span style="color: #bc6ec5;">]</span><span style="color: #4f97d7;">)</span> <span style="color: #4f97d7;">{</span>
    <span style="color: #bc6ec5;">{</span> f <span style="color: #4f97d7; font-weight: bold;">in</span>
        <span style="color: #4f97d7;">Array</span><span style="color: #2d9574;">(</span>d.<span style="color: #4f97d7;">values</span><span style="color: #2d9574;">)</span>.<span style="color: #bc6ec5; font-weight: bold;">partitionMap</span><span style="color: #2d9574;">(</span>f<span style="color: #2d9574;">)</span>
    <span style="color: #bc6ec5;">}</span>
<span style="color: #4f97d7;">}</span>
</pre>
</div>
</li>
<li><div class="org-src-container">

<pre class="src src-swift"><span style="color: #4f97d7; font-weight: bold;">func</span> <span style="color: #bc6ec5; font-weight: bold;">optionalEither</span>&lt;A, B&gt;<span style="color: #4f97d7;">(</span>_ f: <span style="color: #4f97d7; font-weight: bold;">@escaping</span> <span style="color: #bc6ec5;">(</span><span style="color: #2d9574;">(</span>A<span style="color: #2d9574;">)</span> -&gt; B?<span style="color: #bc6ec5;">)</span><span style="color: #4f97d7;">)</span> -&gt; <span style="color: #4f97d7;">(</span>A<span style="color: #4f97d7;">)</span> -&gt; Either&lt;B, <span style="color: #4f97d7;">Void</span>&gt; <span style="color: #4f97d7;">{</span>
    <span style="color: #bc6ec5;">{</span> a <span style="color: #4f97d7; font-weight: bold;">in</span>
        <span style="color: #4f97d7; font-weight: bold;">if</span> <span style="color: #4f97d7; font-weight: bold;">let</span> r = <span style="color: #bc6ec5; font-weight: bold;">f</span><span style="color: #2d9574;">(</span>a<span style="color: #2d9574;">)</span> <span style="color: #2d9574;">{</span>
            <span style="color: #4f97d7; font-weight: bold;">return</span> .<span style="color: #4f97d7; font-weight: bold;">left</span><span style="color: #67b11d;">(</span>r<span style="color: #67b11d;">)</span>
        <span style="color: #2d9574;">}</span> <span style="color: #4f97d7; font-weight: bold;">else</span> <span style="color: #2d9574;">{</span>
            <span style="color: #4f97d7; font-weight: bold;">return</span> .<span style="color: #4f97d7; font-weight: bold;">right</span><span style="color: #67b11d;">(</span><span style="color: #b1951d;">()</span><span style="color: #67b11d;">)</span>
        <span style="color: #2d9574;">}</span>
    <span style="color: #bc6ec5;">}</span>
<span style="color: #4f97d7;">}</span>

<span style="color: #4f97d7; font-weight: bold;">func</span> <span style="color: #bc6ec5; font-weight: bold;">filterMap</span>&lt;A, B&gt;<span style="color: #4f97d7;">(</span>_ f: <span style="color: #4f97d7; font-weight: bold;">@escaping</span> <span style="color: #bc6ec5;">(</span><span style="color: #2d9574;">(</span>A<span style="color: #2d9574;">)</span> -&gt; B?<span style="color: #bc6ec5;">)</span>, _ a: <span style="color: #bc6ec5;">[</span>A<span style="color: #bc6ec5;">]</span><span style="color: #4f97d7;">)</span> -&gt; <span style="color: #4f97d7;">[</span>B<span style="color: #4f97d7;">]</span> <span style="color: #4f97d7;">{</span>
    a.<span style="color: #bc6ec5; font-weight: bold;">partitionMap</span><span style="color: #bc6ec5;">(</span><span style="color: #bc6ec5; font-weight: bold;">optionalEither</span><span style="color: #2d9574;">(</span>f<span style="color: #2d9574;">)</span><span style="color: #bc6ec5;">)</span>.<span style="color: #7590db;">lefts</span>
<span style="color: #4f97d7;">}</span>

<span style="color: #4f97d7; font-weight: bold;">func</span> <span style="color: #bc6ec5; font-weight: bold;">predicateOptional</span>&lt;A&gt;<span style="color: #4f97d7;">(</span>_ f: <span style="color: #4f97d7; font-weight: bold;">@escaping</span> <span style="color: #bc6ec5;">(</span>A<span style="color: #bc6ec5;">)</span> -&gt; <span style="color: #4f97d7;">Bool</span><span style="color: #4f97d7;">)</span> -&gt; <span style="color: #4f97d7;">(</span>A<span style="color: #4f97d7;">)</span> -&gt; A? <span style="color: #4f97d7;">{</span>
    <span style="color: #bc6ec5;">{</span> a <span style="color: #4f97d7; font-weight: bold;">in</span>
        <span style="color: #bc6ec5; font-weight: bold;">f</span><span style="color: #2d9574;">(</span>a<span style="color: #2d9574;">)</span> ? a : <span style="color: #a45bad;">nil</span>
    <span style="color: #bc6ec5;">}</span>
<span style="color: #4f97d7;">}</span>

<span style="color: #4f97d7; font-weight: bold;">func</span> <span style="color: #bc6ec5; font-weight: bold;">filter</span>&lt;A&gt;<span style="color: #4f97d7;">(</span>_ f: <span style="color: #4f97d7; font-weight: bold;">@escaping</span> <span style="color: #bc6ec5;">(</span><span style="color: #2d9574;">(</span>A<span style="color: #2d9574;">)</span> -&gt; <span style="color: #4f97d7;">Bool</span><span style="color: #bc6ec5;">)</span>, _ a: <span style="color: #bc6ec5;">[</span>A<span style="color: #bc6ec5;">]</span><span style="color: #4f97d7;">)</span> -&gt; <span style="color: #4f97d7;">[</span>A<span style="color: #4f97d7;">]</span> <span style="color: #4f97d7;">{</span>
    a.<span style="color: #bc6ec5; font-weight: bold;">partitionMap</span><span style="color: #bc6ec5;">(</span><span style="color: #bc6ec5; font-weight: bold;">optionalEither</span><span style="color: #2d9574;">(</span><span style="color: #bc6ec5; font-weight: bold;">predicateOptional</span><span style="color: #67b11d;">(</span>f<span style="color: #67b11d;">)</span><span style="color: #2d9574;">)</span><span style="color: #bc6ec5;">)</span>.<span style="color: #7590db;">lefts</span>
<span style="color: #4f97d7;">}</span>
</pre>
</div>
</li>
<li>Depends on what is allowed. You'd have to pass it two transformation functions for the left and the right case,
that have the same <code>Either&lt;A,B&gt;</code> return type. Then you can partition into <code>(Optional&lt;A&gt;, Optional&lt;B&gt;)</code>.
</li>
</ol>
</div>
</div>
</div>

<div id="outline-container-sec-11" class="outline-2">
<h2 id="sec-11"><span class="section-number-2">11</span> Composition without operators</h2>
<div class="outline-text-2" id="text-11">
<p>
If operators are not the way to go, you can use named functions.
The problem is that you need an overload for any number of arguments.
This might change in the future for variadic generics.
</p>
</div>
<div id="outline-container-sec-11-1" class="outline-3">
<h3 id="sec-11-1"><span class="section-number-3">11.1</span> Exercises</h3>
<div class="outline-text-3" id="text-11-1">
<ol class="org-ol">
<li><div class="org-src-container">

<pre class="src src-swift"><span style="color: #4f97d7; font-weight: bold;">func</span> <span style="color: #bc6ec5; font-weight: bold;">concat</span>&lt;A: <span style="color: #4f97d7;">AnyObject</span>&gt;<span style="color: #4f97d7;">(</span>
    _ fs: <span style="color: #bc6ec5;">(</span><span style="color: #2d9574;">(</span><span style="color: #4f97d7; font-weight: bold;">inout</span> A<span style="color: #2d9574;">)</span> -&gt; <span style="color: #4f97d7;">Void</span><span style="color: #bc6ec5;">)</span>...
<span style="color: #4f97d7;">)</span>
-&gt; <span style="color: #4f97d7;">(</span><span style="color: #4f97d7; font-weight: bold;">inout</span> A<span style="color: #4f97d7;">)</span> -&gt; <span style="color: #4f97d7;">Void</span> <span style="color: #4f97d7;">{</span>
    <span style="color: #bc6ec5;">{</span> a <span style="color: #4f97d7; font-weight: bold;">in</span> fs.<span style="color: #4f97d7;">forEach</span> <span style="color: #2d9574;">{</span> $<span style="color: #bc6ec5; font-weight: bold;">0</span><span style="color: #67b11d;">(</span>&amp;a<span style="color: #67b11d;">)</span> <span style="color: #2d9574;">}</span> <span style="color: #bc6ec5;">}</span>
<span style="color: #4f97d7;">}</span>
</pre>
</div>
</li>
<li><div class="org-src-container">

<pre class="src src-swift"><span style="color: #4f97d7; font-weight: bold;">func</span> <span style="color: #bc6ec5; font-weight: bold;">concat</span>&lt;A: <span style="color: #4f97d7;">AnyObject</span>&gt;<span style="color: #4f97d7;">(</span>
    _ fs: <span style="color: #bc6ec5;">(</span><span style="color: #2d9574;">(</span>A<span style="color: #2d9574;">)</span> -&gt; A<span style="color: #bc6ec5;">)</span>...
<span style="color: #4f97d7;">)</span>
-&gt; <span style="color: #4f97d7;">(</span>A<span style="color: #4f97d7;">)</span> -&gt; A <span style="color: #4f97d7;">{</span>
    <span style="color: #bc6ec5;">{</span> x <span style="color: #4f97d7; font-weight: bold;">in</span>
        <span style="color: #4f97d7; font-weight: bold;">return</span> <span style="color: #bc6ec5; font-weight: bold;">reduce</span><span style="color: #2d9574;">(</span>f: <span style="color: #67b11d;">{</span> a, f <span style="color: #4f97d7; font-weight: bold;">in</span> <span style="color: #bc6ec5; font-weight: bold;">f</span><span style="color: #b1951d;">(</span>a<span style="color: #b1951d;">)</span> <span style="color: #67b11d;">}</span><span style="color: #2d9574;">)(</span>fs<span style="color: #2d9574;">)(</span>x<span style="color: #2d9574;">)</span>
    <span style="color: #bc6ec5;">}</span>
<span style="color: #4f97d7;">}</span>
</pre>
</div>
</li>
<li><div class="org-src-container">

<pre class="src src-swift"><span style="color: #4f97d7; font-weight: bold;">func</span> <span style="color: #bc6ec5; font-weight: bold;">compose</span>&lt;A, B, C&gt;<span style="color: #4f97d7;">(</span>_ f: <span style="color: #4f97d7; font-weight: bold;">@escaping</span> <span style="color: #bc6ec5;">(</span>B<span style="color: #bc6ec5;">)</span>-&gt;C, _ g: <span style="color: #4f97d7; font-weight: bold;">@escaping</span><span style="color: #bc6ec5;">(</span>A<span style="color: #bc6ec5;">)</span> -&gt; B<span style="color: #4f97d7;">)</span> -&gt; <span style="color: #4f97d7;">(</span><span style="color: #bc6ec5;">(</span>A<span style="color: #bc6ec5;">)</span> -&gt; C<span style="color: #4f97d7;">)</span> <span style="color: #4f97d7;">{</span>
    <span style="color: #bc6ec5;">{</span> a <span style="color: #4f97d7; font-weight: bold;">in</span> <span style="color: #bc6ec5; font-weight: bold;">f</span><span style="color: #2d9574;">(</span><span style="color: #bc6ec5; font-weight: bold;">g</span><span style="color: #67b11d;">(</span>a<span style="color: #67b11d;">)</span><span style="color: #2d9574;">)</span> <span style="color: #bc6ec5;">}</span>
<span style="color: #4f97d7;">}</span>

<span style="color: #4f97d7; font-weight: bold;">struct</span> <span style="color: #bc6ec5; font-weight: bold;">Dog</span> <span style="color: #4f97d7;">{</span>
    <span style="color: #4f97d7; font-weight: bold;">var</span> favoriteFood: DogFood
<span style="color: #4f97d7;">}</span>

<span style="color: #4f97d7; font-weight: bold;">struct</span> <span style="color: #bc6ec5; font-weight: bold;">DogFood</span> <span style="color: #4f97d7;">{</span>
    <span style="color: #4f97d7; font-weight: bold;">var</span> name: <span style="color: #4f97d7;">String</span>
    <span style="color: #4f97d7; font-weight: bold;">var</span> scrumptiousness: <span style="color: #4f97d7;">Int</span>
<span style="color: #4f97d7;">}</span>

<span style="color: #4f97d7; font-weight: bold;">let</span> doggieBoy: Dog = <span style="color: #bc6ec5; font-weight: bold;">compose</span><span style="color: #4f97d7;">(</span>
  <span style="color: #bc6ec5; font-weight: bold;">prop</span><span style="color: #bc6ec5;">(</span>\Dog.<span style="color: #7590db;">favoriteFood</span><span style="color: #bc6ec5;">)</span>,
   <span style="color: #bc6ec5; font-weight: bold;">prop</span><span style="color: #bc6ec5;">(</span>\DogFood.<span style="color: #7590db;">scrumptiousness</span><span style="color: #bc6ec5;">)</span><span style="color: #4f97d7;">)(</span><span style="color: #bc6ec5;">{</span>$0+<span style="color: #a45bad;">1</span><span style="color: #bc6ec5;">}</span><span style="color: #4f97d7;">)(</span>
  <span style="color: #bc6ec5; font-weight: bold;">Dog</span><span style="color: #bc6ec5;">(</span>favoriteFood: <span style="color: #bc6ec5; font-weight: bold;">DogFood</span><span style="color: #2d9574;">(</span>name: <span style="color: #2d9574;">"nuggers"</span>, scrumptiousness: <span style="color: #a45bad;">1999</span><span style="color: #2d9574;">)</span>
<span style="color: #bc6ec5;">)</span><span style="color: #4f97d7;">)</span>
</pre>
</div>
</li>
</ol>
</div>
</div>
</div>

<div id="outline-container-sec-12" class="outline-2">
<h2 id="sec-12"><span class="section-number-2">12</span> A Tour of the Composable Architecture: Part 1</h2>
<div class="outline-text-2" id="text-12">
<ul class="org-ul">
<li>Cohesive package to solve some problems that Swift UI has
</li>
<li>Opinionated
</li>
<li>Focus on modularization and composability
</li>
<li>Very restrictive regarding side effects.
</li>
<li>Assertion helper to test the composable architecture, that forces you to deal with all effects
</li>
<li>Debugging capabilities (.debug to print all actions)
</li>
<li>Range of example projects
</li>
</ul>

<p>
<i>Why view store?</i>
</p>
<ul class="org-ul">
<li>Hide state of sub-views so that the current view is only re-rendered when it's own state changes
</li>
<li>More flexibility binding different front-ends to the state (platform-specific)
</li>
</ul>

<p>
Equatable for duplicate filtering
Bindings
For a list of states, there is a lot of index juggling in bare-metal CA
</p>
</div>
</div>
<div id="outline-container-sec-13" class="outline-2">
<h2 id="sec-13"><span class="section-number-2">13</span> A Tour of the Composable Architecture: Part 2</h2>
<div class="outline-text-2" id="text-13">
<p>
We can get rid of index juggling with <code>ForEachStore</code>
On the reducer side we need to call forEach that supplies
</p>
<ul class="org-ul">
<li>Writable key path to a random access collection of subview-states
</li>
<li>Case path of an action that embeds an index and action into a subview-action
(could write this yourself with <code>embed</code> and <code>extract</code>, but CasePaths supplies the backslash for this)
</li>
<li>Function to create the environment. Or key path
</li>
</ul>

<p>
Strong type level guarantees
</p>

<p>
ForEachStore can be used with stores that only knows about the collection, and the indexed actions.
This is done with <code>scope</code>, that extracts the list out of the state, and embeds an index action into the global actions.
(<i>Extract global state into local, and embed local state into global</i>)
</p>

<p>
Then extracting the subviews into their seperate views, the code becomes very short:
</p>
<div class="org-src-container">

<pre class="src src-swift"><span style="color: #bc6ec5; font-weight: bold;">ForEachStore</span><span style="color: #4f97d7;">(</span>
              <span style="color: #4f97d7; font-weight: bold;">self</span>.<span style="color: #7590db;">store</span>.<span style="color: #bc6ec5; font-weight: bold;">scope</span><span style="color: #bc6ec5;">(</span>
                  state: \.<span style="color: #7590db;">tiles</span>,
                  action: MyActions.<span style="color: #7590db;">tileAction</span><span style="color: #bc6ec5;">)</span>,
              content: TileView.<span style="color: #4f97d7; font-weight: bold;">init</span><span style="color: #4f97d7;">)</span>
</pre>
</div>
<p>
<code>combine</code> multiple stores, if the global store also needs to handle some logic, that is unrelated to the list of subviews.
</p>
</div>
</div>
<div id="outline-container-sec-14" class="outline-2">
<h2 id="sec-14"><span class="section-number-2">14</span> A Tour of the Composable Architecture: Part 3</h2>
<div class="outline-text-2" id="text-14">
<p>
Exhaustive tests with <code>TestStore</code>.
<span class="underline">Basic workflow:</span>
</p>
<ol class="org-ol">
<li>Create a TestStore
<div class="org-src-container">

<pre class="src src-swift"><span style="color: #4f97d7; font-weight: bold;">let</span> store = <span style="color: #bc6ec5; font-weight: bold;">TestStore</span><span style="color: #4f97d7;">(</span>
  initialState: <span style="color: #bc6ec5; font-weight: bold;">AppState</span><span style="color: #bc6ec5;">(</span>
    todos: <span style="color: #2d9574;">[</span>
      <span style="color: #bc6ec5; font-weight: bold;">Todo</span><span style="color: #67b11d;">(</span>
        description: <span style="color: #2d9574;">"Milk"</span>,
        id: <span style="color: #4f97d7;">UUID</span><span style="color: #b1951d;">(</span>uuidString: <span style="color: #2d9574;">"00000000-0000-0000-0000-000000000000"</span><span style="color: #b1951d;">)</span>!,
        isComplete: <span style="color: #a45bad;">false</span>
      <span style="color: #67b11d;">)</span>
    <span style="color: #2d9574;">]</span>
  <span style="color: #bc6ec5;">)</span>,
  reducer: appReducer,
  environment: <span style="color: #bc6ec5; font-weight: bold;">AppEnvironment</span><span style="color: #bc6ec5;">()</span>
<span style="color: #4f97d7;">)</span>
</pre>
</div>
</li>
<li>Create exhaustive assertions (effects that are not tested will throw an error)
<div class="org-src-container">

<pre class="src src-swift">store.<span style="color: #4f97d7;">assert</span><span style="color: #4f97d7;">(</span>
.<span style="color: #4f97d7;">send</span><span style="color: #bc6ec5;">(</span>.<span style="color: #bc6ec5; font-weight: bold;">todo</span><span style="color: #2d9574;">(</span>index: <span style="color: #a45bad;">0</span>, action: .<span style="color: #7590db;">checkboxTapped</span><span style="color: #2d9574;">)</span><span style="color: #bc6ec5;">)</span> <span style="color: #bc6ec5;">{</span>
  $0.<span style="color: #7590db;">todos</span> = <span style="color: #2d9574;">[</span>
    <span style="color: #bc6ec5; font-weight: bold;">Todo</span><span style="color: #67b11d;">(</span>
      description: <span style="color: #2d9574;">"Eggs"</span>,
      id: <span style="color: #4f97d7;">UUID</span><span style="color: #b1951d;">(</span>uuidString: <span style="color: #2d9574;">"00000000-0000-0000-0000-000000000001"</span><span style="color: #b1951d;">)</span>!,
      isComplete: <span style="color: #a45bad;">false</span>
    <span style="color: #67b11d;">)</span>,
    <span style="color: #bc6ec5; font-weight: bold;">Todo</span><span style="color: #67b11d;">(</span>
      description: <span style="color: #2d9574;">"Milk"</span>,
      id: <span style="color: #4f97d7;">UUID</span><span style="color: #b1951d;">(</span>uuidString: <span style="color: #2d9574;">"00000000-0000-0000-0000-000000000000"</span><span style="color: #b1951d;">)</span>!,
      isComplete: <span style="color: #a45bad;">true</span>
    <span style="color: #67b11d;">)</span>
  <span style="color: #2d9574;">]</span>
<span style="color: #bc6ec5;">}</span>
<span style="color: #4f97d7;">)</span>
</pre>
</div>
</li>
</ol>
<p>
Some more wisdom:
</p>
<ul class="org-ul">
<li>Inject dependencies via environment
</li>
<li>Be explicit in the assertions
</li>
<li>use an inline struct to define your cancellable id's:
<div class="org-src-container">

<pre class="src src-swift"><span style="color: #4f97d7; font-weight: bold;">case</span> .<span style="color: #bc6ec5; font-weight: bold;">todo</span><span style="color: #4f97d7;">(</span>index: _, action: .<span style="color: #7590db;">checkboxTapped</span><span style="color: #4f97d7;">)</span>:
<span style="color: #4f97d7; font-weight: bold;">struct</span> <span style="color: #bc6ec5; font-weight: bold;">CancelDelayId</span>: <span style="color: #4f97d7;">Hashable</span> <span style="color: #4f97d7;">{}</span>

<span style="color: #4f97d7; font-weight: bold;">return</span> <span style="color: #bc6ec5; font-weight: bold;">Effect</span><span style="color: #4f97d7;">(</span>value: .<span style="color: #7590db;">todoDelayCompleted</span><span style="color: #4f97d7;">)</span>
  .<span style="color: #4f97d7;">delay</span><span style="color: #4f97d7;">(</span><span style="color: #4f97d7; font-weight: bold;">for</span>: <span style="color: #a45bad;">1</span>, scheduler: environment.<span style="color: #7590db;">mainQueue</span><span style="color: #4f97d7;">)</span>
  .<span style="color: #bc6ec5; font-weight: bold;">eraseToEffect</span><span style="color: #4f97d7;">()</span>
  .<span style="color: #bc6ec5; font-weight: bold;">cancellable</span><span style="color: #4f97d7;">(</span>id: <span style="color: #bc6ec5; font-weight: bold;">CancelDelayId</span><span style="color: #bc6ec5;">()</span>, cancelInFlight: <span style="color: #a45bad;">true</span><span style="color: #4f97d7;">)</span>
</pre>
</div>
</li>
</ul>
</div>
</div>
<div id="outline-container-sec-15" class="outline-2">
<h2 id="sec-15"><span class="section-number-2">15</span> A Tour of the Composable Architecture: Part 4</h2>
<div class="outline-text-2" id="text-15">
<p>
How to test async effects?
Test helper will complain if some effects are still running.
</p>
<ul class="org-ul">
<li>don't use <code>XCTWaiter</code> and the like
</li>
<li>Inject DispatchQueue using <code>AnySchedulerOf&lt;DispatchQueue&gt;</code> and use <code>TestScheduler</code> in the tests.
You can then just <code>advance</code> your scheduler and don't have to wait.
</li>
</ul>
</div>
</div>
</div></div></div>
</body>
</html>
